<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Methodology • patter</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Methodology">
<meta property="og:description" content="patter">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">patter</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/a-methodology.html">Methodology</a>
    </li>
    <li>
      <a href="../articles/b-workflow-outline.html">Workflow outline</a>
    </li>
    <li>
      <a href="../articles/c-workflow-example.html">Example workflow</a>
    </li>
    <li>
      <a href="../articles/d-demos.html">Demos</a>
    </li>
    <li>
      <a href="../articles/e-faqs.html">FAQs</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/edwardlavender/patter/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Methodology</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/edwardlavender/patter/blob/HEAD/vignettes/a-methodology.Rmd" class="external-link"><code>vignettes/a-methodology.Rmd</code></a></small>
      <div class="hidden name"><code>a-methodology.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The <code>patter</code> package is a <code>R</code> implementation of
a forward filtering–backward sampling algorithm for passive acoustic
telemetry. The algorithm integrates observations and movement in a
process-based framework that accounts for all available information to
reconstruct movement paths and emergent patterns of space use from
detections at receivers (and/or ancillary datasets). This vignette
qualitatively outlines the methodology, providing an entry point to the
literature (Lavender et al., in prep) and the package (Lavender et al.,
in prep). See the <code>b-workflow-outline</code> and
<code>c-workflow-example</code> vignettes to learn how to implement the
methodology using <code>patter</code> (type
<code><a href="../articles/b-workflow-outline.html">vignette("b-workflow-outline", package = "patter")</a></code> and
<code><a href="../articles/c-workflow-example.html">vignette("c-workflow-example", package = "patter")</a></code>).</p>
</div>
<div class="section level2">
<h2 id="the-flapper-algorithms">The flapper algorithms<a class="anchor" aria-label="anchor" href="#the-flapper-algorithms"></a>
</h2>
<p>The forward filtering–backward sampling algorithm in
<code>patter</code> unifies (and refines) a suite of methods known as
the flapper algorithms (Lavender et al., 2023). In their original
presentation, the flapper algorithms were presented in two parts: an
acoustic-container (AC) branch and a particle-filtering (PF) branch.
AC-branch algorithms define the set of possible locations of an
individual <em>given the data at each time step</em>. The AC algorithm
handles the information from acoustic observations and the DC algorithm
handles the information from depth observations (which are often
collected alongside acoustic data). PF-branch algorithms refine
AC-branch outputs <em>given a movement model</em>. In the predecessor <a href="https://github.com/edwardlavender/flapper" class="external-link"><code>flapper</code></a>
package, AC-branch algorithms were implemented via <code>ac()</code>,
<code>dc()</code> and <code>acdc()</code> and their outputs were refined
through PF via <code><a href="https://rdrr.io/r/stats/Fdist.html" class="external-link">pf()</a></code> and <code>pf_simplify()</code>.</p>
</div>
<div class="section level2">
<h2 id="the-forward-filter-backward-sampler">The forward-filter backward-sampler<a class="anchor" aria-label="anchor" href="#the-forward-filter-backward-sampler"></a>
</h2>
<p>In <code>patter</code>, we have streamlined, enhanced and formalised
the original methodology. Our revised approach falls into the category
of forward-filtering backward-sampling algorithms that are described in
the particle filtering literature (Doucet &amp; Johansen, 2008). This
comprises a forward simulation and a backward pass. In the forward
simulation, we simulate the set of possible locations of an individual
moving forwards in time, given the data and contingent upon the past.
Each location sample is termed a ‘particle’. In <code>patter</code>,
this is achieved with a single function (<code><a href="../reference/pf_forward.html">pf_forward()</a></code>) that
integrates the functions of the AC- and PF-branch algorithms.</p>
<p>We continue to use the terms <code>acs_*</code>, <code>AC*PF</code>
and <code>*DCPF</code>:</p>
<ul>
<li>
<code>acs_*()</code> is a prefix for functions that support
likelihood calculations for acoustic data (the core of the original AC*
algorithm);</li>
<li>
<code>AC*PF</code> is the generic term for a particle filtering
algorithm that incorporates acoustic data (via a likelihood term based
on the original AC* algorithm);</li>
<li>
<code>*DCPF</code> is the generic term for a particle filtering
algorithm that incorporates depth data (via a likelihood term based on
the original DC algorithm);</li>
</ul>
<p>The forward simulation is followed by a backward pass. In the
original <code>flapper</code> implementation, the backward pass was
implemented by <code>pf_simplify()</code> and involved pruning ‘dead
ends’ from the forward simulation. If you imagine the forward simulation
as a growing fungal network between two points in space (representing
the start and end of a time series), dead ends are the side branches of
the (simulated) fungal network that fail to reach the end. The
corresponding (and much improved) routine in <code>patter</code> is
<code><a href="../reference/pf_backward_killer.html">pf_backward_killer()</a></code>.</p>
<p>There are two, related limitations with the ‘prune’ methodology. The
first is that the removal of dead ends tends to bias particle samples,
because early samples (which invariably sooner-or-later end up on a
dead-end) are more likely to get killed than later samples. This is
known as particle degeneracy. The second is that while particles are
contingent upon the past (a marginal distribution), they do not embody
information from the future (the joint distribution). In
<code>patter</code>, a backward sampling algorithm mitigates these issue
to reconstruct movement trajectories (see
<code>pf_backward_sampler()</code>).</p>
<p>See <code>NEWS</code> for a summary of the differences between
<code>flapper</code> and <code>patter</code>.</p>
</div>
<div class="section level2">
<h2 id="forward-simulation">Forward simulation<a class="anchor" aria-label="anchor" href="#forward-simulation"></a>
</h2>
<div class="section level3">
<h3 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h3>
<p>Consider a regular sequence of time steps, along which we have
collected observations (at regular or irregular intervals). In the
forward simulation, we run along the time series, collecting particle
samples (locations that are compatible with the data and properties of
movement) as we go. This works as follows:</p>
<ul>
<li>
<strong>Proposals.</strong> At each time step, propose a series of
candidate locations in which the individual could be located. In
<code>patter</code>, there are two main ways of doing this:
<ul>
<li>
<strong>Stochastic kicks.</strong> Given a previous location, we
simulate travel distances and turning angles from a movement model and
use these to ‘kick’ an individual into new locations.</li>
<li>
<strong>Directed sampling.</strong> We define the set of reachable
locations around a previous location.</li>
</ul>
</li>
<li>
<strong>Likelihood.</strong> Calculate the likelihood of the data,
given each proposal. The likelihoods of acoustic and archival data given
each proposal are resolved by the equations of the AC and DC algorithms.
For example, the AC algorithm calculates the likelihood of acoustic
observations (the presence or absence of detections at each receiver)
according a model of detection probability, given proposal
locations.</li>
<li>
<strong>Weights.</strong> Translate likelihoods into sampling
weights that encapsulate the information in the data and the movement
model. For stochastic kick proposals, sampling weights and likelihoods
are identical because the proposal locations have been generated
accounting for the movement model. For directed sampling, we need to
combine likelihoods with the probability density of movements into
reachable locations and apply numerical normalisation to define
weights.</li>
<li>
<strong>Sampling</strong>. Sample <span class="math inline">\(N\)</span> proposals, with replacement, in line
with the weights. This process effectively kills off locations that are
incompatible with the data and increases the frequency of more likely
proposals.</li>
</ul>
<p>This process continues until the end of the time series. The outcome
is a set of particle samples (marginal distributions), one for each time
step.</p>
</div>
<div class="section level3">
<h3 id="implementation">Implementation<a class="anchor" aria-label="anchor" href="#implementation"></a>
</h3>
<p>The implementation of the forward simulation in <code>patter</code>
is a four step process:</p>
<ul>
<li>
<code>pf_setup_data()</code> is used to set up a data list;</li>
<li>
<code>acs_()</code> functions set up AC* algorithm inputs (if
required);</li>
<li>
<code><a href="../reference/pf_setup_obs.html">pf_setup_obs()</a></code> is used to collate observations;</li>
<li>
<code><a href="../reference/pf_forward.html">pf_forward()</a></code> implements the forward simulation;</li>
</ul>
<p>In <code><a href="../reference/pf_forward.html">pf_forward()</a></code>, the key arguments are as follows:</p>
<ul>
<li>
<code>.obs</code> is a timeline of observations;</li>
<li>
<code>.dlist</code> is a <code>list</code> of datasets required to
calculate likelihoods;</li>
<li>
<code>.rpropose</code> is a <code>function</code> that generates
proposal locations (e.g., <code><a href="../reference/pf_propose.html">pf_rpropose_kick()</a></code>);</li>
<li>
<code>.dpropose</code> is the corresponding <code>function</code>
that calculates the density of movements into proposal locations;</li>
<li>
<code>.likelihood</code> is a <code>list</code> of functions that
evaluate the likelihood of the data given proposal locations;</li>
<li>
<code>.sample</code> is the sampling <code>function</code> used to
sample proposal locations (e.g.,
<code><a href="../reference/pf_sample.html">pf_sample_systematic()</a></code>);</li>
</ul>
<p>Most of the complexity in <code><a href="../reference/pf_forward.html">pf_forward()</a></code> is about handling
particle degeneracy and convergence. In a standard PF, we ‘kick’ the
particles into new locations, calculate their weights and sample
particles accordingly. Degenerate (invalid) particles are removed by the
filter. The benefit of this approach is that it is extremely fast (even
in <code>R</code>, since relevant operations are vectorised). However,
particle degeneracy (and convergence) can become an issue, especially
for stringent observational models, with many simulated kicks landing in
locations that are incompatible with the data.</p>
<p><code><a href="../reference/pf_forward.html">pf_forward()</a></code> implements multiple strategies to promote
convergence. Quick options are to boost the number of particles and the
number of kick attempts at each time step. If this fails, directed
sampling is implemented. Under this approach, we propose the complete
set of reachable locations and location weights are assigned from the
normalised product of proposal likelihoods and movement densities. We
then sample from the set of valid proposals, in line with the weights
(there is no filtering stage). Other tricks are also available—see
<code>?pf_forward()</code> for full details.</p>
<p><code><a href="../reference/pf_forward.html">pf_forward()</a></code> records <code>diagnostics</code> related to
particle degeneracy that can guide more efficient algorithm
implementations. See <code><a href="../reference/pf_diag.html">?pf_diag</a></code>,
<code><a href="../reference/pf_particles-class.html">?`pf_particles-class`</a></code> and the <code>d-demos</code> vignette
for further details (type
<code><a href="../articles/d-demos.html">vignette("d-demos", package = "patter")</a></code>).</p>
</div>
</div>
<div class="section level2">
<h2 id="backward-sampler">Backward sampler<a class="anchor" aria-label="anchor" href="#backward-sampler"></a>
</h2>
<p>The backward sampler is used to reconstruct the joint distribution of
particle samples through time (i.e., movement trajectories). For each
particle, this approach works as follows:</p>
<ul>
<li>Calculate the probability density of movements from that particle to
all particles at the previous time step using a movement model;</li>
<li>Sample a selected particle at the previous time step, in line with
the probability densities linking each pair of particles;</li>
<li>Repeat this process until the start of the time series;</li>
</ul>
<p>Backward sampling is implemented via
<code>pf_backward_sampler()</code> and associates. As noted above, you
can also reconstruct paths via <code><a href="../reference/pf_forward.html">pf_forward()</a></code> plus
<code><a href="../reference/pf_backward_killer.html">pf_backward_killer()</a></code> (and <code><a href="../reference/pf_path.html">pf_path()</a></code>), which is
much less computationally intensive, but subject to limitations (see
above).</p>
</div>
<div class="section level2">
<h2 id="analysis">Analysis<a class="anchor" aria-label="anchor" href="#analysis"></a>
</h2>
<p>Particle samples can be used to reconstruct movement paths and maps
of space use. Movement paths can be reconstructed in two ways:</p>
<ul>
<li>(original) <code><a href="../reference/pf_forward.html">pf_forward()</a></code> →
<code><a href="../reference/pf_backward_killer.html">pf_backward_killer()</a></code> → <code><a href="../reference/pf_path.html">pf_path()</a></code>
</li>
<li>(recommended) <code><a href="../reference/pf_forward.html">pf_forward()</a></code> →
<code>pf_backward_sampler()</code>
</li>
</ul>
<p>Patterns of space use (utilisation distributions) can be
reconstructed using standard statistical techniques (see
<code><a href="../reference/map_pou.html">map_pou()</a></code>, <code><a href="../reference/map_dens.html">map_dens()</a></code> and
<code>map_hr_*()</code> for inbuilt functions).</p>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>Doucet, A. &amp; Johansen, A. M. (2008). A tutorial on particle
filtering and smoothing: Fifteen years later. <a href="https://www.stats.ox.ac.uk/~doucet/doucet_johansen_tutorialPF2011.pdf" class="external-link uri">https://www.stats.ox.ac.uk/~doucet/doucet_johansen_tutorialPF2011.pdf</a>.</p>
<p>Lavender. E. et al. (2023). An integrative modelling framework for
passive acoustic telemetry. <em>Methods in Ecology and Evolution</em>.
<a href="https://doi.org/10.1111/2041-210X.14193" class="external-link uri">https://doi.org/10.1111/2041-210X.14193</a>.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Edward Lavender.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
