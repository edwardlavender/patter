<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Particle Filters, Smoothers and Samplers for Animal Movement Modelling • patter</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Particle Filters, Smoothers and Samplers for Animal Movement Modelling">
<meta property="og:description" content="Particle filters, smoothers and sampling algorithms for animal movement modelling, with a focus on passive acoustic telemetry systems. This methodology enables the reconstruction of movement paths and patterns of space use. The methodology unifies a suite of methods formerly known as the flapper algorithms and supersedes the {flapper} package.">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">patter</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="articles/a-methodology.html">Methodology</a>
    </li>
    <li>
      <a href="articles/b-workflow-outline.html">Workflow outline</a>
    </li>
  </ul>
</li>
<li>
  <a href="news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/edwardlavender/patter/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="contents col-md-9">

<div class="section level1">
<div class="page-header"><h1 id="patter-">
<code>patter</code> <a href="https://edwardlavender.github.io/patter/" class="external-link"><img src="reference/figures/logo.png" align="right" height="138"></a>
<a class="anchor" aria-label="anchor" href="#patter-"></a>
</h1></div>
<p><strong>Particle algorithms for animal movement modelling in <a href="https://www.r-project.org" class="external-link"><code>R</code></a></strong></p>
<!-- badges: start -->

<p><code>patter</code> provides particle filtering, smoothing and sampling algorithms for animal movement modelling, with a focus on passive acoustic telemetry systems. This wraps and enhances a fast <code>Julia</code> backend (<a href="https://edwardlavender.github.io/Patter.jl" class="external-link"><code>Patter.jl</code></a>). The methodology enables the reconstruction of movement paths and patterns of space use. <code>patter</code> unifies a suite of methods formerly known as the <a href="https://github.com/edwardlavender/flapper" class="external-link"><code>flapper</code></a> algorithms and supersedes the experimental <a href="https://github.com/edwardlavender/flapper" class="external-link"><code>flapper</code></a> package (Lavender et al., <a href="https://doi.org/10.1111/2041-210X.14193" class="external-link">2023</a>).</p>
<blockquote>
<p><strong>Note:</strong> <code>patter</code> is a new <code>R</code> package. Like all new packages, you should use it with a degree of caution. Please share feedback and issues.</p>
</blockquote>
<blockquote>
<p><strong><a href="NEWS">NEWS</a></strong> Welcome to <code>patter v.2.0.0</code>! This includes some <strong>breaking changes</strong>. For projects based on earlier versions, use <a href="https://rstudio.github.io/renv/articles/renv.html" class="external-link"><code>renv</code></a>. For future projects, <code>patter v.2.0.0</code> is recommended.</p>
</blockquote>
</div>
<div class="section level1">
<h1 id="highlights">Highlights<a class="anchor" aria-label="anchor" href="#highlights"></a>
</h1>
<p><code>patter</code> is designed to reconstruct movement paths and emergent patterns of space use from animal tracking data. A powerful, flexible, process-orientated, particle-based framework is used for this purpose. This framework unifies the <a href="https://github.com/edwardlavender/flapper" class="external-link"><code>flapper</code></a> algorithms and provides important opportunities for development, which we exploit here.</p>
<p>The essential functions are <code><a href="reference/pf_filter.html">pf_filter()</a></code> and <code>pf_smoother_*()</code>:</p>
<ul>
<li>
<strong><code><a href="reference/pf_filter.html">pf_filter()</a></code></strong> is the particle filter. This simulates the possible locations of an individual moving forwards in time, accounting for all of the data (for example, acoustic observations, depth observations and any other observations) <em>up to</em> each time point and the animal’s movement (a partial marginal distribution).</li>
<li>
<strong><code>pf_smoother_*()</code></strong> is a particle smoothing algorithm. At each time step, the smoother accounts for all of the data from both the past <em>and</em> the future (the full marginal distribution) and substantially refines maps of space use.</li>
</ul>
<p>We hope to add backward sampling algorithms to the package in due course.</p>
</div>
<div class="section level1">
<h1 id="evolution">Evolution<a class="anchor" aria-label="anchor" href="#evolution"></a>
</h1>
<p><code>patter</code> evolved from the experimental <a href="https://github.com/edwardlavender/flapper" class="external-link">flapper</a> package, but is:</p>
<ul>
<li>
<strong>More powerful</strong>, with a substantially revised methodology;</li>
<li>
<strong>Faster</strong>, with overhauled internal routines;</li>
<li>
<strong>Simpler</strong> to use and maintain;</li>
<li>
<strong>Stable</strong>, with fewer dependencies and an upgraded spatial ecosystem;</li>
<li>
<strong>Better tested</strong>, with comprehensive unit tests (in progress!);</li>
</ul>
<p>See <a href="https://github.com/edwardlavender/patter/blob/main/NEWS.md" class="external-link"><code>NEWS</code></a> for a summary of the evolution of <a href="https://github.com/edwardlavender/flapper" class="external-link"><code>flapper</code></a> to <code>patter</code>.</p>
<p>At the time of writing (May 2024), <code>patter</code> is more streamlined than <a href="https://github.com/edwardlavender/flapper" class="external-link"><code>flapper</code></a> and focuses on the implementation of fast particle-based algorithms for the reconstruction of movements and patterns of space use. Please get in touch if you would like to see additional functionality brought into <code>patter</code>.</p>
</div>
<div class="section level1">
<h1 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h1>
<blockquote>
<p><strong>Note:</strong> <code>patter</code> works Windows, MacOS and Linux (with some restrictions). On Windows, everything <em>should</em> work if you follow the instructions below. On MacOS, some additional set up (such as compiler configuration) may be required, depending on your set up. On Debian/Ubuntu, {patter} can be used but you cannot simultaneously use geospatial routines in <code>R</code> and <code>Julia</code>. Thus, you can only call <code><a href="https://rspatial.org/" class="external-link">library(terra)</a></code> or <code>terra::foo()</code> and use {patter} routines that exploit <code>terra</code> and other geospatial packages in <code>R</code> sessions that are not connected to a <code>Julia</code> session (via <code><a href="reference/julia_connect.html">julia_connect()</a></code>). We haven’t tried other Linux distributions. Package examples were written on MacOS and may not run safely on Linux without modification. Check the function documentation for supported options and share your experience. In case of issues, you should be able to use <code>Patter.jl</code> directly, which on some systems may be simpler than getting <code>R</code> and <code>Julia</code> to play together!</p>
</blockquote>
<ol style="list-style-type: decimal">
<li><p><strong>Install <a href="https://www.r-project.org" class="external-link"><code>R</code></a></strong>. This package requires <code>R</code> version ≥ 4.1 (but the most recent version is recommended). You can check your version from the <code>R</code> console using <code>R.version.string</code>.</p></li>
<li><p><strong>Install build packages.</strong> Package installation and configuration (may) require the <a href="https://github.com/r-lib/devtools" class="external-link"><code>devtools</code></a>, <a href="https://github.com/r-lib/pkgbuild" class="external-link"><code>pkgbuild</code></a> and <a href="https://github.com/rstudio/rmarkdown" class="external-link"><code>rmarkdown</code></a> packages. Install them with:</p></li>
</ol>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"devtools"</span>, <span class="st">"pkgbuild"</span>, <span class="st">"rmarkdown"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>On Linux, this step may require system libraries (see below).</p>
<ol start="3" style="list-style-type: decimal">
<li>
<strong>Install system libraries</strong>.</li>
</ol>
<ul>
<li>
<strong>On Windows</strong>, package building requires <code>RTools</code>. You can check whether <code>RTools</code> is installed with <code><a href="https://pkgbuild.r-lib.org/reference/has_rtools.html" class="external-link">pkgbuild::has_rtools()</a></code>. If <code>RTools</code> is not installed, it is necessary to download and install the appropriate version of <code>RTools</code> before proceeding by following the instructions <a href="https://cran.r-project.org/bin/windows/RTools/" class="external-link">here</a>.</li>
<li>
<strong>On MacOS</strong>, some system-specific step up (e.g., compiler configuration) may be required. Follow the steps below and address any issues as required for your system.</li>
<li>
<strong>On Linux</strong>, a suite of system libraries, including <code>GDAL</code>, <code>GEOS</code> and <code>PROJ</code>, are required. See the package <a href="DESCRIPTION">DESCRIPTION</a> for required/suggested packages and follow the instructions for your system. On Debian/Ubuntu, see <a href="https://eddelbuettel.github.io/r2u/" class="external-link"><code>r2u</code></a> or follow the instructions below to get up and running.
<details><summary><b>Click</b> for system dependency installation instructions on Ubuntu.
</summary><div class="sourceCode" id="cb2"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="fu">sudo</span> apt update</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a><span class="co"># `make` utility required to compile packages e.g., data.table</span></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a><span class="fu">sudo</span> apt install build-essential</span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a><span class="co"># Geospatial dependencies for {terra}</span></span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a><span class="fu">sudo</span> add-apt-repository ppa:ubuntugis/ubuntugis-unstable</span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a><span class="fu">sudo</span> apt install libgdal-dev libgeos-dev libproj-dev</span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a><span class="co"># `ffpmeg` and `libavfilter-dev` for {av} (suggested)</span></span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a><span class="fu">sudo</span> apt install ffmpeg</span>
<span id="cb2-12"><a href="#cb2-12" tabindex="-1"></a><span class="fu">sudo</span> apt install libavfilter-dev</span>
<span id="cb2-13"><a href="#cb2-13" tabindex="-1"></a></span>
<span id="cb2-14"><a href="#cb2-14" tabindex="-1"></a><span class="co"># `GSL` for {RcppGSL} for {Rfast} (suggested)</span></span>
<span id="cb2-15"><a href="#cb2-15" tabindex="-1"></a><span class="fu">sudo</span> apt install libgsl-dev</span>
<span id="cb2-16"><a href="#cb2-16" tabindex="-1"></a></span>
<span id="cb2-17"><a href="#cb2-17" tabindex="-1"></a><span class="co"># `gfortran` for {classInt} -&gt; {sf} (suggested)</span></span>
<span id="cb2-18"><a href="#cb2-18" tabindex="-1"></a><span class="fu">sudo</span> apt install gfortran</span>
<span id="cb2-19"><a href="#cb2-19" tabindex="-1"></a></span>
<span id="cb2-20"><a href="#cb2-20" tabindex="-1"></a><span class="co"># `units` for {units} -&gt; {sf} (suggested)</span></span>
<span id="cb2-21"><a href="#cb2-21" tabindex="-1"></a><span class="fu">sudo</span> apt install libudunits2-dev</span></code></pre></div>
</details>
</li>
</ul>
<ol start="4" style="list-style-type: decimal">
<li>
<p><strong>Install <a href="https://julialang.org" class="external-link"><code>Julia</code></a></strong>. <code>Julia</code> is high-performance programming language that <code>patter</code> uses as a backend. If you do not have <code>Julia</code> installed on your system, follow the instructions below to install <code>Julia</code>.</p>
<p><strong>A. On Windows, the easiest option is to download and install <code>Julia</code> from <a href="https://julialang.org/downloads/#long_term_support_release" class="external-link">JuliaLang</a></strong>. During installation, check <code>Add Julia to PATH</code>.</p>
<p><strong>B. Another option is to use <code>juliaup</code></strong>. Some users have found this easier on <code>MacOS</code> because you don’t have to worry about finding the right <code>Julia</code> installation for your architecture.</p>
<ul>
<li>
<p>Install the <code>juliaup</code> installer, following the instructions <a href="https://github.com/JuliaLang/juliaup" class="external-link">here</a>. For example, on <code>MacOS</code>, open the shell (Terminal) and type:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="ex">curl</span> <span class="at">-fsSL</span> https://install.julialang.org <span class="kw">|</span> <span class="fu">sh</span></span></code></pre></div>
</li>
<li>
<p>In the shell, then install <code>Julia</code> 1.10.5 via <code>juliaup</code>:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="ex">juliaup</span> add 1.10.5  </span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="ex">juliaup</span> default 1.10.5</span></code></pre></div>
</li>
</ul>
</li>
</ol>
<blockquote>
<p><strong>Note:</strong> Install a recent <code>Julia</code> version. At the time of writing (December 2024), <code>Julia</code> 1.10.5 (long-term release) is recommended, as we run most tests against that version. However, <code>Julia</code> 1.11 is now also supported by <code>JuliaCall</code> (see <a href="https://github.com/Non-Contradiction/JuliaCall/issues/234" class="external-link">here</a>). This README was last built on 2024-12-29 with Julia 1.10.5.</p>
</blockquote>
<ol start="5" style="list-style-type: decimal">
<li>
<strong>Setup JuliaCall.</strong> The next step is to set up <code>JuliaCall</code>, which provides the integration between <code>R</code> and <code>Julia</code>.</li>
</ol>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Install the {JuliaCall} package:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"JuliaCall"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Use the development version if the CRAN version is unavailable:</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"JuliaInterop/JuliaCall"</span>,</span>
<span>                         dependencies <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Run julia_setup() to set up the Julia installation </span></span>
<span><span class="co"># * This includes an installJulia argument if the above Julia installation options fail </span></span>
<span><span class="co"># * Set `JULIA_HOME` if Julia is not found (see `?julia_setup()`)</span></span>
<span><span class="co"># * Note this may take several minutes</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/JuliaInterop/JuliaCall" class="external-link">JuliaCall</a></span><span class="op">)</span></span>
<span><span class="va">julia</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/JuliaCall/man/julia_setup.html" class="external-link">julia_setup</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Validate the Julia installation:</span></span>
<span><span class="co"># * TRUE: `Julia` is working! </span></span>
<span><span class="co"># * FALSE: `Julia` is not working (see below)! </span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Logic.html" class="external-link">isTRUE</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/JuliaCall/man/julia_eval.html" class="external-link">julia_eval</a></span><span class="op">(</span><span class="st">'true'</span><span class="op">)</span>, silent <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>If <code><a href="https://rdrr.io/pkg/JuliaCall/man/julia_setup.html" class="external-link">julia_setup()</a></code> fails with <code>'Julia is not found'</code>, you should tell <code>R</code> the location of the <code>Julia</code> binary via <code>JULIA_HOME</code> (see <code>?JuliaCall::julia_setup()</code> and the <a href="https://cran.r-project.org/web/packages/JuliaCall" class="external-link"><code>JuliaCall</code></a> <a href="https://cran.r-project.org/web/packages/JuliaCall/readme/README.html" class="external-link">README</a> for troubleshooting and ways to get help).</p>
<ol start="6" style="list-style-type: decimal">
<li>
<strong>Install <a href="https://github.com/edwardlavender/patter" class="external-link"><code>patter</code></a>.</strong> To install <code>patter</code> from the <code>main</code> branch, use:</li>
</ol>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"edwardlavender/patter"</span>, </span>
<span>                         dependencies <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                         build_vignettes <span class="op">=</span> <span class="fu">rmarkdown</span><span class="fu">::</span><span class="fu"><a href="https://pkgs.rstudio.com/rmarkdown/reference/pandoc_available.html" class="external-link">pandoc_available</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>The <code>dependencies = TRUE</code> argument ensures that suggested packages are also installed, which are required for some functions and to build vignettes. This process may take several minutes. Set <code>build_vignettes = FALSE</code> for a faster installation.</p>
<p>To install <code>patter</code> from the development (<code>dev</code>) branch, if available, use:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"edwardlavender/patter@dev"</span>, </span>
<span>                         dependencies <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                         build_vignettes <span class="op">=</span> <span class="fu">rmarkdown</span><span class="fu">::</span><span class="fu"><a href="https://pkgs.rstudio.com/rmarkdown/reference/pandoc_available.html" class="external-link">pandoc_available</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>This branch may include bug fixes and new features but should be used <strong>with caution</strong>.</p>
<p>We recommend using <a href="https://rstudio.github.io/renv/articles/renv.html" class="external-link"><code>renv</code></a> (or similar) and <a href="https://r4ds.had.co.nz/workflow-projects.html" class="external-link">RStudio Projects</a> to track the version of <code>patter</code> that you use in your projects. This will ensure that your code continues to work, even if we have to make breaking changes to <code>patter</code> as the package evolves in response to user feedback.</p>
<ol start="7" style="list-style-type: decimal">
<li>
<strong>Connect to <code>Julia</code></strong>. At the start of every <code>R</code> session, you need to connect <code>R</code> to <code>Julia</code> (and <code>patter</code> to <a href="https://github.com/edwardlavender/Patter.jl" class="external-link"><code>Patter.jl</code></a>):</li>
</ol>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load &amp; attach {patter}:</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/edwardlavender/patter/" class="external-link">patter</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Option (A): Connect to `Julia`: </span></span>
<span><span class="co"># * Set JULIA_HOME if 'Julia not found'</span></span>
<span><span class="co"># * Set JULIA_PROJ to use a local Julia project (recommended)</span></span>
<span><span class="co"># * Set JULIA_NUM_THREADS to exploit multi-threading (recommended)</span></span>
<span><span class="co"># * See `julia_connect()` for guidance</span></span>
<span><span class="va">julia</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/julia_connect.html">julia_connect</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>The first time you run <code><a href="reference/julia_connect.html">julia_connect()</a></code>, it will connect to <code>Julia</code> and install (and pre-compile) <a href="https://github.com/edwardlavender/Patter.jl" class="external-link"><code>Patter.jl</code></a> and the additional <code>Julia</code> dependencies. This usually takes up to five minutes on first run but may take up to twenty minutes depending on the speed of your machine. Subsequent <code><a href="reference/julia_connect.html">julia_connect()</a></code> calls will be faster.</p>
<ol start="8" style="list-style-type: decimal">
<li>
<strong>Validate the <code>R</code>—<code>Julia</code> connection</strong>. To validate that <code>patter</code> works on your system, run:</li>
</ol>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/julia_validate.html">julia_validate</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>This should return <code>NULL</code>, invisibly, in which case you are good to go. Otherwise, the function will return an error (or <code>R</code> may crash).</p>
<ol start="9" style="list-style-type: decimal">
<li>
<strong>(optional) Run package checks</strong>. To run package checks locally, follow the instructions in <a href="dev/001-check.R">dev/001-check.R</a>. <a href="https://github.com/edwardlavender/patter/issues" class="external-link">Issue</a> reports are appreciated.</li>
</ol>
</div>
<div class="section level1">
<h1 id="functionality">Functionality<a class="anchor" aria-label="anchor" href="#functionality"></a>
</h1>
<div class="section level2">
<h2 id="vignettes">Vignettes<a class="anchor" aria-label="anchor" href="#vignettes"></a>
</h2>
<p>For an introduction to <code>patter</code>, use:</p>
<ul>
<li>
<code><a href="articles/a-methodology.html">vignette("a-methodology", package = "patter")</a></code> for a conceptual introduction to the methodology;</li>
<li>
<code><a href="articles/b-workflow-outline.html">vignette("b-workflow-outline", package = "patter")</a></code> for an overview of the workflow;</li>
</ul>
<p>For a full list of all functions, see <code><a href="https://rdrr.io/pkg/patter/man" class="external-link">help(package = 'patter')</a></code>.</p>
<p>For a glossary of key arguments, see <code>glossary</code>.</p>
</div>
<div class="section level2">
<h2 id="datasets">Datasets<a class="anchor" aria-label="anchor" href="#datasets"></a>
</h2>
<p>For example datasets from the Movement Ecology of Flapper Skate project (<code>datasets-mefs</code>), which inspired <code>patter</code>, see:</p>
<ul>
<li>
<code>dat_moorings</code> for acoustic receiver deployments;</li>
<li>
<code>dat_detections</code> for acoustic detection time series;</li>
<li>
<code>dat_archival</code> for archival (depth) time series;</li>
<li>
<code><a href="reference/datasets-mefs.html">dat_gebco()</a></code> for a bathymetry grid;</li>
</ul>
<p>To validate new datasets for use with <code>patter</code>, see <code><a href="reference/pat_setup_data.html">pat_setup_data()</a></code> and/or the <code>assemble_*()</code> function documentation.</p>
<p>For example algorithm outputs (<code>datasets-algorithms</code>), see:</p>
<ul>
<li>
<code><a href="reference/datasets-algorithms.html">dat_path()</a></code> for an example output from <code><a href="reference/sim_path_walk.html">sim_path_walk()</a></code>;</li>
<li>
<code><a href="reference/datasets-algorithms.html">dat_coa()</a></code> for an example output from <code><a href="reference/coa.html">coa()</a></code>;</li>
<li>
<code><a href="reference/datasets-algorithms.html">dat_pff()</a></code> and <code><a href="reference/datasets-algorithms.html">dat_pfb()</a></code> for an example output from <code><a href="reference/pf_filter.html">pf_filter()</a></code>;</li>
<li>
<code><a href="reference/datasets-algorithms.html">dat_tff()</a></code> for an example output from <code><a href="reference/pf_smoother_two_filter.html">pf_smoother_two_filter()</a></code>;</li>
</ul>
</div>
<div class="section level2">
<h2 id="set-up-julia">Set up <code>Julia</code>
<a class="anchor" aria-label="anchor" href="#set-up-julia"></a>
</h2>
<p>To link <code>patter</code> and the <a href="https://edwardlavender.github.io/Patter.jl" class="external-link"><code>Patter.jl</code></a> <code>Julia</code> backend, use:</p>
<ul>
<li>
<code><a href="reference/julia_connect.html">julia_connect()</a></code> to connect to <code>R</code> to <code>Julia</code>;</li>
<li>
<code><a href="reference/julia_validate.html">julia_validate()</a></code> to validate the <code>R</code>—<code>Julia</code> connection;</li>
<li>
<code><a href="reference/set_seed.html">set_seed()</a></code> to set the seed in <code>R</code> and <code>Julia</code>;</li>
<li>
<code><a href="reference/set_map.html">set_map()</a></code> to make a <code>SpatRaster</code> of the study area available in <code>Julia</code>;</li>
</ul>
<p>These functions should be run at the start of every <code>R</code> session.</p>
</div>
<div class="section level2">
<h2 id="abstract-types">Abstract Types<a class="anchor" aria-label="anchor" href="#abstract-types"></a>
</h2>
<p><code>patter</code> is based on three Abstract Types, defined in <code>Julia</code>:</p>
<ul>
<li>
<code>State</code> structures hold the state (location) of an animal at a given time step;</li>
<li>
<code>ModelMove</code> structures hold movement model, used to simulate new states;</li>
<li>
<code>ModelObs</code> structures hold observation model parameters, used to evaluate the correspondence between simulated states and observations;</li>
</ul>
</div>
<div class="section level2">
<h2 id="simulation">Simulation<a class="anchor" aria-label="anchor" href="#simulation"></a>
</h2>
<p>To simulate animal movement time series, see:</p>
<ul>
<li>
<code><a href="reference/sim_path_walk.html">sim_path_walk()</a></code> to simulate a movement path from a walk model (via <code>ModelMove</code>);</li>
<li>
<code><a href="reference/sim_array.html">sim_array()</a></code> to simulate an acoustic array;</li>
<li>
<code><a href="reference/sim_observations.html">sim_observations()</a></code> to simulate observational time series (via <code>ModelObs</code>);</li>
</ul>
<p>To evaluate model skill in reconstructing simulated patterns, see <code>skill_*()</code> functions:</p>
<ul>
<li>
<code><a href="reference/skill.html">skill_mb()</a></code> to calculate mean bias;</li>
<li>
<code><a href="reference/skill.html">skill_me()</a></code> to calculate mean error;</li>
<li>
<code><a href="reference/skill.html">skill_rmse()</a></code> to calculate root mean squared error;</li>
<li>
<code><a href="reference/skill.html">skill_R()</a></code> to calculate Spearman’s rank correlation coefficient;</li>
<li>
<code><a href="reference/skill.html">skill_d()</a></code> to calculate the index of agreement;</li>
</ul>
</div>
<div class="section level2">
<h2 id="data-exploration">Data exploration<a class="anchor" aria-label="anchor" href="#data-exploration"></a>
</h2>
<p>For help with data acquisition, processing, checking and preliminary analyses, see the <a href="https://github.com/edwardlavender/flapper" class="external-link"><code>flapper</code></a> package. This facilitates:</p>
<ul>
<li>Data preparation;</li>
<li>Spatial operations;</li>
<li>Distance calculations;</li>
<li>Movement analyses;</li>
</ul>
<p>Please submit a <a href="https://github.com/edwardlavender/patter/issues" class="external-link">feature request</a> if you would like functions from <a href="https://github.com/edwardlavender/flapper" class="external-link"><code>flapper</code></a> in <code>patter</code>.</p>
</div>
<div class="section level2">
<h2 id="algorithms">Algorithms<a class="anchor" aria-label="anchor" href="#algorithms"></a>
</h2>
<p>The main thrust of <code>patter</code> is the provision of fast, integrated modelling workflow based on particle filtering for reconstructing animal movement paths and emergent patterns of space use from observational time series (with a focus on passive acoustic telemetry systems).</p>
<p><strong>To assemble datasets for particle filtering</strong>, use <code>assemble_*()</code> functions:</p>
<ul>
<li>
<code><a href="reference/assemble.html">assemble_timeline()</a></code> assembles a timeline;</li>
<li>
<code><a href="reference/assemble.html">assemble_acoustics()</a></code> assembles an acoustic time series;</li>
<li>
<code><a href="reference/assemble.html">assemble_acoustics_containers()</a></code> assembles a corresponding time series of acoustic containers;</li>
<li>
<code><a href="reference/assemble.html">assemble_archival()</a></code> assembles an archival time series;</li>
<li>
<code><a href="reference/assemble.html">assemble_custom()</a></code> assembles custom time series;</li>
</ul>
<p>Ancillary time series should be structured in the same way for inclusion in the particle filter.</p>
<p><strong>To implement particle filtering (PF) routines</strong>, use:</p>
<ul>
<li>
<code><a href="reference/pf_filter.html">pf_filter()</a></code> to implement the particle filter;</li>
<li>
<code><a href="reference/pf_smoother_two_filter.html">pf_smoother_two_filter()</a></code> to implement the two-filter smoother;</li>
</ul>
<p>These functions return <code>pf_particles-class</code> objects.</p>
<p><strong>For convenience plotting functions</strong>, see:</p>
<ul>
<li>
<code><a href="reference/pf_plot_xy.html">pf_plot_xy()</a></code> to plot particle locations;</li>
</ul>
<p><strong>For mapping utilisation distributions</strong>, use:</p>
<ul>
<li>
<code><a href="reference/map_pou.html">map_pou()</a></code> to map probability-of-use;</li>
<li>
<code><a href="reference/map_dens.html">map_dens()</a></code> to create smooth maps using <code>spatstat</code>, plus the supporting functions:
<ul>
<li>
<code><a href="reference/map_dens.html">as.im.SpatRaster()</a></code>, to convert <code>SpatRaster</code>s to pixel images;</li>
<li>
<code><a href="reference/map_dens.html">as.owin.SpatRaster()</a></code>, to convert <code>SpatRaster</code>s to observation windows;</li>
<li>
<code><a href="reference/map_dens.html">as.owin.sf()</a></code>, to convert <code>sf</code> objects to observation windows;</li>
</ul>
</li>
<li>
<code>map_hr_*()</code> to map home ranges, specifically:
<ul>
<li>
<code><a href="reference/map_hr.html">map_hr_prop()</a></code> for a custom range;</li>
<li>
<code><a href="reference/map_hr.html">map_hr_core()</a></code> for the ‘core’ range;</li>
<li>
<code><a href="reference/map_hr.html">map_hr_home()</a></code> for the ‘home’ range;</li>
<li>
<code><a href="reference/map_hr.html">map_hr_full()</a></code> for the full range;</li>
</ul>
</li>
</ul>
</div>
<div class="section level2">
<h2 id="options">Options<a class="anchor" aria-label="anchor" href="#options"></a>
</h2>
<p>For additional options in <code>patter</code>, see:</p>
<ul>
<li>
<code>patter-progress</code> to monitor function progress;</li>
</ul>
</div>
</div>
<div class="section level1">
<h1 id="usage">Usage<a class="anchor" aria-label="anchor" href="#usage"></a>
</h1>
<div class="section level2">
<h2 id="set-up">Set up<a class="anchor" aria-label="anchor" href="#set-up"></a>
</h2>
<p>This is the basic <code>patter</code> workflow to reconstruct movement paths and patterns of space use from animal tracking data. First, we load some essential packages:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/edwardlavender/patter/" class="external-link">patter</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; This is {patter} v.1.0.1. For an overview, see `?patter`. For support, contact edward.lavender@eawag.ch.</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dtplyr.tidyverse.org" class="external-link">dtplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span>, warn.conflicts <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>patter.verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>Second, we connect <code>R</code> to <code>Julia</code> and set the seed in <code>R</code> and <code>Julia</code> to ensure reproducibility of our simulations:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/julia_connect.html">julia_connect</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/julia_validate.html">julia_validate</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/set_seed.html">set_seed</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Third, we define the properties of our study area; namely, a <code>SpatRaster</code> of our study area that defines the area within which movements are possible and the timeline over which we will model movements:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define map </span></span>
<span><span class="co"># * Use file path on Linux </span></span>
<span><span class="va">map</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/datasets-mefs.html">dat_gebco</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/set_map.html">set_map</a></span><span class="op">(</span><span class="va">map</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Define timeline </span></span>
<span><span class="va">timeline</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html" class="external-link">as.POSIXct</a></span><span class="op">(</span><span class="st">"2016-03-17 01:50:00"</span>, tz <span class="op">=</span> <span class="st">"UTC"</span><span class="op">)</span>,</span>
<span>                <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html" class="external-link">as.POSIXct</a></span><span class="op">(</span><span class="st">"2016-03-18 01:48:00"</span>, tz <span class="op">=</span> <span class="st">"UTC"</span><span class="op">)</span>, </span>
<span>                by <span class="op">=</span> <span class="st">"2 mins"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="movement">Movement<a class="anchor" aria-label="anchor" href="#movement"></a>
</h2>
<p>We will reconstruct the movements of a tagged flapper skate (<em>Dipturus intermedius</em>) within a study area off the west coast of Scotland, based on electronic tagging and tracking data. To do so, we need a model for the individual’s movements and a series of observation models that connect movements to observations. In this example, we are interested in the two-dimensional (x, y) location of our animal through time (that is, the animal’s ‘state’ is an object of type <code>StateXY</code>). The animal can move up to 750 m in two minutes, which is the resolution at which we will model movement, and we formulate a random walk model accordingly based on step lengths and headings:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define the animal's state:</span></span>
<span><span class="va">state</span>      <span class="op">&lt;-</span> <span class="st">"StateXY"</span></span>
<span></span>
<span><span class="co"># Formulate a corresponding movement model:</span></span>
<span><span class="va">mobility</span>   <span class="op">&lt;-</span> <span class="fl">750.0</span></span>
<span><span class="va">model_move</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/ModelMove.html">model_move_xy</a></span><span class="op">(</span>.mobility   <span class="op">=</span> <span class="st">"750.0"</span>, </span>
<span>                      .dbn_length <span class="op">=</span> <span class="st">"truncated(Gamma(1, 250.0), upper = 750.0)"</span>,</span>
<span>                      .dbn_heading  <span class="op">=</span> <span class="st">"Uniform(-pi, pi)"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Visualise realisations of the movement model (Windows/MacOS):</span></span>
<span><span class="va">map</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="reference/sim_path_walk.html">sim_path_walk</a></span><span class="op">(</span>.timeline <span class="op">=</span> <span class="va">timeline</span>,</span>
<span>                .state <span class="op">=</span> <span class="va">state</span>,</span>
<span>                .model_move <span class="op">=</span> <span class="va">model_move</span>, </span>
<span>                .n_path <span class="op">=</span> <span class="fl">4L</span>, .one_page <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/invisible.html" class="external-link">invisible</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-7-1.png" width="100%"></p>
</div>
<div class="section level2">
<h2 id="observations">Observations<a class="anchor" aria-label="anchor" href="#observations"></a>
</h2>
<p>We have collected acoustic and archival (depth) observations from tagged flapper skate. Let’s pull out the time series for a selected individual:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define acoustic detections</span></span>
<span><span class="va">det</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">dat_detections</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">individual_id</span> <span class="op">==</span> <span class="fl">25L</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>individual_id <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/data.table/man/as.data.table.html" class="external-link">as.data.table</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Define archival (depth) observations</span></span>
<span><span class="va">arc</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">dat_archival</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">individual_id</span> <span class="op">==</span> <span class="fl">25L</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>individual_id <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>         depth_sigma <span class="op">=</span> <span class="fl">50</span>,</span>
<span>         depth_deep_eps <span class="op">=</span> <span class="fl">50</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>obs <span class="op">=</span> <span class="va">depth</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/data.table/man/as.data.table.html" class="external-link">as.data.table</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Individual movements are connected to the observations by models of the observation process for each dataset. Without going into details, here we bundle together the observations with the parameters of the observation models:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># ModelObsAcousticLogisTrunc</span></span>
<span><span class="va">acoustics</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/assemble.html">assemble_acoustics</a></span><span class="op">(</span>.timeline <span class="op">=</span> <span class="va">timeline</span>,</span>
<span>                                .detections <span class="op">=</span> <span class="va">det</span>,</span>
<span>                                .moorings <span class="op">=</span> <span class="va">dat_moorings</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># ModelObsAcousticContainers</span></span>
<span><span class="va">containers</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/assemble.html">assemble_acoustics_containers</a></span><span class="op">(</span>.timeline <span class="op">=</span> <span class="va">timeline</span>, </span>
<span>                                            .acoustics <span class="op">=</span> <span class="va">acoustics</span>, </span>
<span>                                            .mobility <span class="op">=</span> <span class="va">mobility</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># ModelObsDepthNormalTruncSeabed</span></span>
<span><span class="va">archival</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/assemble.html">assemble_archival</a></span><span class="op">(</span>.timeline <span class="op">=</span> <span class="va">timeline</span>,</span>
<span>                              .archival <span class="op">=</span> <span class="va">arc</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Named lists of ModelObs sub-types and associated observations</span></span>
<span><span class="co"># * The container dataset is direction specific so we assemble two yobs lists</span></span>
<span><span class="va">yobs_fwd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ModelObsAcousticLogisTrunc <span class="op">=</span> <span class="va">acoustics</span>, </span>
<span>                 ModelObsAcousticContainer <span class="op">=</span> <span class="va">containers</span><span class="op">$</span><span class="va">forward</span>,</span>
<span>                 ModelObsDepthNormalTruncSeabed <span class="op">=</span> <span class="va">archival</span><span class="op">)</span></span>
<span><span class="va">yobs_bwd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ModelObsAcousticLogisTrunc <span class="op">=</span> <span class="va">acoustics</span>, </span>
<span>                 ModelObsAcousticContainer <span class="op">=</span> <span class="va">containers</span><span class="op">$</span><span class="va">backward</span>,</span>
<span>                 ModelObsDepthNormalTruncSeabed <span class="op">=</span> <span class="va">archival</span><span class="op">)</span></span></code></pre></div>
<p>Of course, you do not need acoustic and archival data to implement the algorithms (these are just the data we have collected from flapper skate)—other datasets can be used just as easily. To simulate observations instead, see <code><a href="reference/sim_observations.html">sim_observations()</a></code>.</p>
</div>
<div class="section level2">
<h2 id="particle-filter">Particle filter<a class="anchor" aria-label="anchor" href="#particle-filter"></a>
</h2>
<p>We are now in a position to run the particle filter. This runs a simulation forwards (or backwards) in time, sampling states (locations, termed ‘particles’) that are consistent with the movement model and the observations up to and including each time point. We end up with a time series (<code>data.table</code>) of particles that approximate the partial marginal distribution for the location of the animal, at each time step:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># List filter arguments</span></span>
<span><span class="va">args</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>.timeline <span class="op">=</span> <span class="va">timeline</span>,</span>
<span>             .state <span class="op">=</span> <span class="va">state</span>,</span>
<span>             .yobs <span class="op">=</span> <span class="va">yobs_fwd</span>,</span>
<span>             .model_move <span class="op">=</span> <span class="va">model_move</span>,</span>
<span>             .n_record <span class="op">=</span> <span class="fl">1000L</span>,</span>
<span>             .n_particle <span class="op">=</span> <span class="fl">2e3L</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Forward run</span></span>
<span><span class="va">fwd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">pf_filter</span>, <span class="va">args</span>, quote <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">fwd</span><span class="op">$</span><span class="va">states</span><span class="op">)</span></span>
<span><span class="co">#&gt;    path_id timestep           timestamp map_value        x       y</span></span>
<span><span class="co">#&gt;      &lt;int&gt;    &lt;int&gt;              &lt;POSc&gt;     &lt;num&gt;    &lt;num&gt;   &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:       1        1 2016-03-17 01:50:00  74.88351 709042.1 6253107</span></span>
<span><span class="co">#&gt; 2:       1        2 2016-03-17 01:52:00  42.39980 709434.1 6252826</span></span>
<span><span class="co">#&gt; 3:       1        3 2016-03-17 01:54:00  74.88351 709057.3 6253116</span></span>
<span><span class="co">#&gt; 4:       1        4 2016-03-17 01:56:00  59.76520 709130.0 6252981</span></span>
<span><span class="co">#&gt; 5:       1        5 2016-03-17 01:58:00  76.37878 709425.0 6253693</span></span>
<span><span class="co">#&gt; 6:       1        6 2016-03-17 02:00:00  50.71592 709162.2 6252838</span></span>
<span></span>
<span><span class="co"># Backward run</span></span>
<span><span class="va">args</span><span class="op">$</span><span class="va">.yobs</span>      <span class="op">&lt;-</span> <span class="va">yobs_bwd</span></span>
<span><span class="va">args</span><span class="op">$</span><span class="va">.direction</span> <span class="op">&lt;-</span> <span class="st">"backward"</span></span>
<span><span class="va">bwd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">pf_filter</span>, <span class="va">args</span>, quote <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="particle-smoother">Particle smoother<a class="anchor" aria-label="anchor" href="#particle-smoother"></a>
</h2>
<p>Particle smoothers refine the outputs from the particle filter. Smoothed particles approximate the full marginal distribution for the location of the individual at each time step (accounting for all of the data before and after each step).</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Set `vmap` for probability calculations</span></span>
<span><span class="co"># * Use file path rather on Linux </span></span>
<span><span class="fu"><a href="reference/pf_smoother_two_filter.html">set_vmap</a></span><span class="op">(</span>.map <span class="op">=</span> <span class="va">map</span>, .mobility <span class="op">=</span> <span class="va">mobility</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Run smoother </span></span>
<span><span class="va">smo</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/pf_smoother_two_filter.html">pf_smoother_two_filter</a></span><span class="op">(</span>.n_particle <span class="op">=</span> <span class="fl">750L</span>, .n_sim <span class="op">=</span> <span class="fl">100L</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="mapping">Mapping<a class="anchor" aria-label="anchor" href="#mapping"></a>
</h2>
<p>Particles can be used to reconstruct movement paths and patterns of space use. We can estimate a utilisation distribution from our particle samples as follows:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Estimate UD</span></span>
<span><span class="co"># * This must be done in a separate R session on Linux </span></span>
<span><span class="va">ud</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/map_dens.html">map_dens</a></span><span class="op">(</span>.map <span class="op">=</span> <span class="va">map</span>,</span>
<span>               .coord <span class="op">=</span> <span class="va">smo</span><span class="op">$</span><span class="va">states</span>,</span>
<span>               .sigma <span class="op">=</span> <span class="va">bw.h</span><span class="op">)</span><span class="op">$</span><span class="va">ud</span></span>
<span><span class="co">#&gt; Observation window is gridded.</span></span>
<span></span>
<span><span class="co"># Add home range</span></span>
<span><span class="fu"><a href="reference/map_hr.html">map_hr_home</a></span><span class="op">(</span><span class="va">ud</span>, .add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/mtext.html" class="external-link">mtext</a></span><span class="op">(</span>side <span class="op">=</span> <span class="fl">4</span>, <span class="st">"Probability density"</span>, line <span class="op">=</span> <span class="op">-</span><span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-12-1.png" width="100%"></p>
<p>This basic workflow is highly customisable. You have the flexibility to define species-specific movement models, include any type of observational dataset and implement system-specific observation models. See the vignettes and function examples for further details and reach out with queries.</p>
</div>
</div>
<div class="section level1">
<h1 id="resources">Resources<a class="anchor" aria-label="anchor" href="#resources"></a>
</h1>
<p><strong>For full details on the methods</strong>, see the references below.</p>
<p><strong>For further information of the <code>patter</code> package</strong>, see:</p>
<ul>
<li>
<code><a href="reference/patter.html">?patter::patter</a></code> for an overview of package functions;</li>
<li>
<code><a href="reference/pf_filter.html">?patter::pf_filter</a></code>for information on specific functions (such as <code><a href="reference/pf_filter.html">pf_filter()</a></code>);</li>
<li>
<a href="https://github.com/edwardlavender/patter-workshops" class="external-link"><code>patter-workshops</code></a> for introductory materials;</li>
</ul>
<p><strong>For further code examples</strong>, see:</p>
<ul>
<li>
<a href="https://github.com/edwardlavender/patter-demo" class="external-link"><code>patter-demo</code></a> for simple demonstrations;</li>
<li>
<a href="https://github.com/edwardlavender/patter-eval" class="external-link"><code>patter-eval</code></a> for a simulation-based workflow and analysis;</li>
<li>
<a href="https://github.com/edwardlavender/patter-flapper" class="external-link"><code>patter-flapper</code></a> for a real-world analysis on flapper skate;
<ul>
<li>
<a href="https://github.com/edwardlavender/patter-trout" class="external-link"><code>patter-trout</code></a> for a real-world analysis on lake trout;</li>
</ul>
</li>
</ul>
<p>Note that the code base in some repositories may be outdated.</p>
</div>
<div class="section level1">
<h1 id="disclaimer-and-troubleshooting">Disclaimer and troubleshooting<a class="anchor" aria-label="anchor" href="#disclaimer-and-troubleshooting"></a>
</h1>
<p><code>patter</code> is a new <code>R</code> package. All routines are experimental. Researchers interested in using the package are encouraged to get in touch while the methods and package remain at an early stage of evolution (<a href="mailto:edward.lavender@eawag.ch" class="email">edward.lavender@eawag.ch</a>).</p>
</div>
<div class="section level1">
<h1 id="citation">Citation<a class="anchor" aria-label="anchor" href="#citation"></a>
</h1>
<p>To cite <code>patter</code> in publications, please use:</p>
<ul>
<li>Lavender, E. et al. (2024). Particle algorithms for animal movement modelling in autonomous receiver networks. bioRxiv. <a href="https://doi.org/10.1101/2024.09.16.613223" class="external-link uri">https://doi.org/10.1101/2024.09.16.613223</a>.</li>
<li>Lavender, E. et al. (2024). Particle algorithms for animal tracking in <code>R</code> and <code>Julia</code>. bioRxiv. <a href="https://doi.org/10.1101/2024.07.30.605733" class="external-link uri">https://doi.org/10.1101/2024.07.30.605733</a>
</li>
<li>Lavender, E. et al. (in prep). Animal tracking for conservation with particle algorithms.</li>
</ul>
<hr>
<p>Please note that <code>patter</code> is released with a <a href="https://contributor-covenant.org/version/2/1/CODE_OF_CONDUCT.html" class="external-link">Contributor Code of Conduct</a>. By contributing to this project, you agree to abide by its terms.</p>
</div>

  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/edwardlavender/patter/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/edwardlavender/patter/issues/" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>

<div class="community">
<h2 data-toc-skip>Community</h2>
<ul class="list-unstyled">
<li><a href="CODE_OF_CONDUCT.html">Code of conduct</a></li>
</ul>
</div>

<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing patter</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Edward Lavender <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0002-8040-7489" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://www.repostatus.org/#active" class="external-link"><img src="https://www.repostatus.org/badges/latest/active.svg" alt="Project Status: Active – The project has reached a stable, usable state and is being actively developed."></a></li>
<li><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental" class="external-link"><img src="https://img.shields.io/badge/lifecycle-experimental-orange.svg" alt="Lifecycle: experimental"></a></li>
<li><a href="https://CRAN.R-project.org/package=patter" class="external-link"><img src="https://www.r-pkg.org/badges/version/patter" alt="CRAN status"></a></li>
<li><a href="https://github.com/edwardlavender/patter/actions/workflows/R-CMD-check.yaml" class="external-link"><img src="https://github.com/edwardlavender/patter/actions/workflows/R-CMD-check.yaml/badge.svg" alt="R-CMD-check"></a></li>
</ul>
</div>

  </div>
</div>


      <footer><div class="copyright">
  <p></p>
<p>Developed by Edward Lavender.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer>
</div>






  </body>
</html>
