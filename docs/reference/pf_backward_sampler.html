<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>PF: backward sampler — pf_backward_sampler • patter</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="PF: backward sampler — pf_backward_sampler"><meta property="og:description" content="This is a vectorised implementation of the backward sampling algorithm."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">patter</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/a-methodology.html">Methodology</a>
    </li>
    <li>
      <a href="../articles/b-workflow-outline.html">Workflow outline</a>
    </li>
    <li>
      <a href="../articles/c-workflow-example.html">Example workflow</a>
    </li>
    <li>
      <a href="../articles/d-demos.html">Demos</a>
    </li>
    <li>
      <a href="../articles/e-faqs.html">FAQs</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/edwardlavender/patter/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>PF: backward sampler</h1>
    <small class="dont-index">Source: <a href="https://github.com/edwardlavender/patter/blob/HEAD/R/pf_backward_sampler.R" class="external-link"><code>R/pf_backward_sampler.R</code></a></small>
    <div class="hidden name"><code>pf_backward_sampler.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This is a vectorised implementation of the backward sampling algorithm.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">pf_backward_sampler</span><span class="op">(</span></span>
<span>  <span class="va">.history</span>,</span>
<span>  .dpropose <span class="op">=</span> <span class="va">pf_dpropose</span>,</span>
<span>  .obs <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">.dlist</span>,</span>
<span>  .dargs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  .record <span class="op">=</span> <span class="fu"><a href="pf_opt.html">pf_opt_record</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  .verbose <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"patter.verbose"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>.history</dt>
<dd><p>Particle samples from the forward simulation, provided in any format accepted by <code><a href="pf_history.html">.pf_history_list()</a></code>. Particle samples must contain <code>timestep</code>, <code>cell_now</code>, <code>x_now</code> and <code>y_now</code> columns.</p></dd>


<dt>.dpropose, .obs, .dlist, .dargs</dt>
<dd><p>A <code>function</code> and associated arguments used to evaluate the probability density of movement between location pairs (see <code><a href="pf_forward.html">pf_forward()</a></code> and <code><a href="pf_propose.html">pf_dpropose()</a></code>). <code>.dpropose</code> must accept the following arguments, even if they are unused:</p><ul><li><p><code>.particles</code>, a <code><a href="https://rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table</a></code> of particle samples that contains pairs of particles from the current and previous time steps. This contains the following columns:</p><ul><li><p><code>index_now</code>,<code>index_past</code>---<code>integer</code> vectors that define sample positions in particle <code><a href="https://rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table</a></code>s for the current and previous time step;</p></li>
<li><p><code>cell_now</code>, <code>x_now</code>, <code>y_now</code>---an <code>integer</code> vector of particle (grid cell) IDs and <code>numeric</code> vectors of particle coordinates for the current time step;</p></li>
<li><p><code>cell_past</code>, <code>x_past</code>, <code>y_past</code>---as above but for the previous time step;</p></li>
</ul></li>
<li><p><code>.obs</code>, a <code><a href="https://rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table</a></code> of observations (see <code><a href="pf_forward.html">pf_forward()</a></code>);</p></li>
<li><p><code>.t</code>, an <code>integer</code> that defines the time step;</p></li>
<li><p><code>.dlist</code>, a <code>named</code> list of data and parameters required to calculate movement densities (see <code><a href="pf_forward.html">pf_forward()</a></code>);</p></li>
<li><p>(optional) Additional arguments, passed in a named <code>list</code> via <code>.dargs</code> (see <code><a href="pf_forward.html">pf_forward()</a></code>);</p></li>
</ul><p>Using these inputs, <code>.dpropose</code> must calculate the probability density of movements from each <code>cell_past</code> to <code>cell_now</code>, returning the inputted <code><a href="https://rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table</a></code> with a <code>dens</code> column. The default function uses <code>.particles</code> and <code>.dlist$spatial$lonlat</code>. It calculates Euclidean distances between particle coordinates and translates these into probabilities via <code>.dkick</code> (see <code><a href="pf_propose.html">pf_dpropose()</a></code>).</p>
<p>See <code><a href="pf_forward.html">pf_forward()</a></code> and <code><a href="pf_propose.html">pf_dpropose()</a></code> for full details on required function arguments, inputs and outputs.</p></dd>


<dt>.record</dt>
<dd><p>A named <code>list</code> of output options, from <code><a href="pf_opt.html">pf_opt_record()</a></code>.</p></dd>


<dt>.verbose</dt>
<dd><p>User output control (see <code><a href="patter-progress.html">patter-progress</a></code> for supported options).</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>The function returns a <code><a href="pf_particles-class.html">pf_particles</a></code> object.</p>
    </div>
    <div id="overview">
    <h2>Overview</h2>
    <p>The forward-filtering backward-sampling algorithm in <code><a href="patter.html">patter</a></code> is implemented via <code><a href="pf_forward.html">pf_forward()</a></code> plus <code>pf_backward_sampler()</code>. <code><a href="pf_forward.html">pf_forward()</a></code> runs a simulation forwards in time, generating location (particle) samples that are consistent with the data up to and including each time point (a marginal distribution). The backward sampler runs a simulation backwards in time. This generates a set of particle samples at each time step that embodies all information from both the past <em>and the future</em>; i.e., the full joint distribution of individual locations and data (see <code><a href="pf_backward_-times.html">pf_backward_*()</a></code>)</p>
    </div>
    <div id="pseudocode">
    <h2>Pseudocode</h2>
    <p>The backward sampler <em>begins</em> with particle samples from <code><a href="pf_forward.html">pf_forward()</a></code> for the final time step. Moving backwards in time, for time step (&gt; 1) and each particle, the algorithm acts as follows:</p><ul><li><p>Calculate the probability density of movements from that particle to all particles at the previous time step via a <code>.dpropose</code> function.</p></li>
<li><p>(In practice, this typically requires calculating the distances between particle samples and translating these into densities using the movement model);</p></li>
<li><p>Sample a selected particle at the previous time step, in line with the probability densities linking each pair of particles;</p></li>
</ul></div>
    <div id="vectorisation">
    <h2>Vectorisation</h2>
    <p>In practice, this function iterates over time steps and vectorises probability density calculations:</p><ul><li><p>At each time step, we identify all combinations of particle samples for the current and previous time step.</p></li>
<li><p>Probability densities are evaluated between particle pairs and re-sampling is implemented by particle.</p></li>
</ul><p>This approach assumes that particle combinations can be held in memory (this is reasonable for \(\leq 1000\) particles but is relatively easy to relax if required) and that likelihood evaluations are cheap. Under these circumstances, this approach is faster than more memory-efficient approaches based on the subset of unique cell combinations. It is also much cheaper than a (parallelised) particle-by-particle implementation and faster than the latter with moderate numbers (\( \lesssim 10\), depending on context) of cores. However, it is still expensive (see Costs, below).</p>
<p>The vectorised implementation returns a <code><a href="pf_particles-class.html">pf_particles</a></code> object, as in <code><a href="pf_forward.html">pf_forward()</a></code> and <code>pf_backward_sampler()</code>. Unlike a particle-by-particle implementation, we do not automatically reconstruct trajectories. <code><a href="pf_path.html">pf_path()</a></code> is required to translate particle samples into trajectories.</p>
    </div>
    <div id="costs">
    <h2>Costs</h2>
    <p>The backward sampler requires large numbers of (potentially replicate) calculations. Under default settings, calculations are implemented on-the-fly. For intermediate-sized problems, it may be more efficient to pre-compute densities, or variables required for density estimation (such as distance), between (unique) particle pairs before implementation of the backward sampler. Modify <code>.dpropose</code>  to read and match densities from objects in memory or from file onto the <code>.particles</code> <code><a href="https://rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table</a></code>. However, for big datasets, identifying and storing unique particle combinations becomes difficult and expensive and we do not currently have a better solution than on-the-fly calculations. If <code>pf_backward_sampler()</code> is prohibitively expensive, it is acceptable to use particle samples from <code><a href="pf_forward.html">pf_forward()</a></code>) and/or <code><a href="pf_backward_killer.html">pf_backward_killer()</a></code> for trajectory construction and mapping. The extent to which backward sampling refines trajectories and patterns of space use is context-specific.</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p>The forward filtering--backward sampling algorithm samples locations (particles) that represent the possible locations of an individual through time, accounting for all data and the individual's movement.</p><ul><li><p>To set up data, use <code><a href="pat_setup_data.html">pat_setup_data()</a></code>.</p></li>
<li><p><code><a href="pf_forward.html">pf_forward()</a></code> implements the forward filter:</p><ul><li><p>To set up an observations timeline, use <code><a href="pf_setup_obs.html">pf_setup_obs()</a></code>.</p></li>
<li><p>For proposal (movement) models, see <code><a href="pf_propose.html">pf_propose</a></code>.</p></li>
<li><p>For likelihood functions, to evaluate the likelihood of the data at proposal locations, see <code><a href="pf_lik.html">pf_lik</a></code>.</p></li>
<li><p>For sampling functions, to (re)sample plausible proposal locations, see <code><a href="pf_sample.html">pf_sample</a></code>.</p></li>
<li><p>For tuning parameters, see <code><a href="pf_opt.html">pf_opt</a></code>.</p></li>
</ul></li>
<li><p><code><a href="pf_backward_-times.html">pf_backward_*()</a></code> refines outputs from the forward filter:</p><ul><li><p><code><a href="pf_backward_killer.html">pf_backward_killer()</a></code> removes dead-ends;</p></li>
<li><p><code>pf_backward_sampler()</code> implements the backward sampler;</p></li>
</ul></li>
<li><p>To reconstruct movement paths from particle samples, use <code><a href="pf_path.html">pf_path()</a></code>.</p></li>
<li><p>To map emergent patterns of space use, use <code><a href="pf_coord.html">pf_coord()</a></code> plus a <code>map_*()</code> function, such as <code><a href="map_pou.html">map_pou()</a></code>, <code><a href="map_dens.html">map_dens()</a></code> and/or <code><a href="map_hr.html">map_hr</a></code><code>_()</code>.</p></li>
<li><p>For additional utilities, see supporting <code>pf_*()</code> functions, such as <code><a href="pf_plot_history.html">pf_plot_history()</a></code>, <code><a href="pf_files.html">pf_files()</a></code> and <code><a href="pf_files.html">pf_files_size()</a></code>.</p></li>
</ul></div>
    </div>
    <div id="author">
    <h2>Author</h2>
    <p>Edward Lavender</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co">#### Set up</span></span></span>
<span class="r-in"><span><span class="co"># Use precomputed function inputs &amp; particle samples from `?pf_forward()`:</span></span></span>
<span class="r-in"><span><span class="co"># * Data list (see `?pat_setup_data()` and `?pf_forward()`)</span></span></span>
<span class="r-in"><span><span class="co"># * Observations timeline (see `?pf_setup_obs()` and `?pf_forward()`)</span></span></span>
<span class="r-in"><span><span class="co"># * Particle samples (see `?pf_forward()`)</span></span></span>
<span class="r-in"><span><span class="va">obs</span>      <span class="op">&lt;-</span> <span class="fu"><a href="datasets-algorithms.html">dat_obs</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">dlist</span>    <span class="op">&lt;-</span> <span class="fu"><a href="datasets-algorithms.html">dat_dlist</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">out_pff</span>  <span class="op">&lt;-</span> <span class="fu"><a href="datasets-algorithms.html">dat_pff</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Implement `pf_backward_killer()` (for comparison)</span></span></span>
<span class="r-in"><span><span class="va">out_pfbk</span> <span class="op">&lt;-</span> <span class="fu"><a href="pf_backward_killer.html">pf_backward_killer</a></span><span class="op">(</span>.history <span class="op">=</span> <span class="va">out_pff</span>,</span></span>
<span class="r-in"><span>                               .record <span class="op">=</span> <span class="fu"><a href="pf_opt.html">pf_opt_record</a></span><span class="op">(</span>.save <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> `patter::pf_backward_killer()` called @ 2024-01-21 13:33:27... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 25: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Recording (cleaned) outputs for `.history[[25]]`... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 24: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Cleaning `.history[[23]]`... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Identifying `cell_now` (for the previous step) that match `cell_past` (for the current step)... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... Input: 100 rows in `.history[[t]]`... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... Filtering 21 dead ends (79 remain)... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... Output: 79 rows in `.history[[t - 1]]`... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Recording (cleaned) outputs for `.history[[24]]`... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 23: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Cleaning `.history[[22]]`... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Identifying `cell_now` (for the previous step) that match `cell_past` (for the current step)... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... Input: 79 rows in `.history[[t]]`... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... Filtering 40 dead ends (60 remain)... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... Output: 60 rows in `.history[[t - 1]]`... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Recording (cleaned) outputs for `.history[[23]]`... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 22: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Cleaning `.history[[21]]`... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Identifying `cell_now` (for the previous step) that match `cell_past` (for the current step)... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... Input: 60 rows in `.history[[t]]`... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... Filtering 29 dead ends (71 remain)... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... Output: 71 rows in `.history[[t - 1]]`... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Recording (cleaned) outputs for `.history[[22]]`... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 21: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Cleaning `.history[[20]]`... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Identifying `cell_now` (for the previous step) that match `cell_past` (for the current step)... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... Input: 71 rows in `.history[[t]]`... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... Filtering 64 dead ends (36 remain)... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... Output: 36 rows in `.history[[t - 1]]`... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Recording (cleaned) outputs for `.history[[21]]`... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 20: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Cleaning `.history[[19]]`... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Identifying `cell_now` (for the previous step) that match `cell_past` (for the current step)... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... Input: 36 rows in `.history[[t]]`... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... Filtering 45 dead ends (55 remain)... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... Output: 55 rows in `.history[[t - 1]]`... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Recording (cleaned) outputs for `.history[[20]]`... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 19: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Cleaning `.history[[18]]`... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Identifying `cell_now` (for the previous step) that match `cell_past` (for the current step)... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... Input: 55 rows in `.history[[t]]`... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... Filtering 53 dead ends (47 remain)... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... Output: 47 rows in `.history[[t - 1]]`... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Recording (cleaned) outputs for `.history[[19]]`... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 18: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Cleaning `.history[[17]]`... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Identifying `cell_now` (for the previous step) that match `cell_past` (for the current step)... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... Input: 47 rows in `.history[[t]]`... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... Filtering 38 dead ends (62 remain)... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... Output: 62 rows in `.history[[t - 1]]`... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Recording (cleaned) outputs for `.history[[18]]`... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 17: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Cleaning `.history[[16]]`... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Identifying `cell_now` (for the previous step) that match `cell_past` (for the current step)... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... Input: 62 rows in `.history[[t]]`... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... Filtering 34 dead ends (66 remain)... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... Output: 66 rows in `.history[[t - 1]]`... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Recording (cleaned) outputs for `.history[[17]]`... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 16: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Cleaning `.history[[15]]`... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Identifying `cell_now` (for the previous step) that match `cell_past` (for the current step)... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... Input: 66 rows in `.history[[t]]`... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... Filtering 48 dead ends (52 remain)... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... Output: 52 rows in `.history[[t - 1]]`... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Recording (cleaned) outputs for `.history[[16]]`... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 15: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Cleaning `.history[[14]]`... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Identifying `cell_now` (for the previous step) that match `cell_past` (for the current step)... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... Input: 52 rows in `.history[[t]]`... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... Filtering 48 dead ends (52 remain)... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... Output: 52 rows in `.history[[t - 1]]`... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Recording (cleaned) outputs for `.history[[15]]`... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 14: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Cleaning `.history[[13]]`... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Identifying `cell_now` (for the previous step) that match `cell_past` (for the current step)... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... Input: 52 rows in `.history[[t]]`... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... Filtering 47 dead ends (53 remain)... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... Output: 53 rows in `.history[[t - 1]]`... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Recording (cleaned) outputs for `.history[[14]]`... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 13: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Cleaning `.history[[12]]`... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Identifying `cell_now` (for the previous step) that match `cell_past` (for the current step)... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... Input: 53 rows in `.history[[t]]`... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... Filtering 33 dead ends (67 remain)... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... Output: 67 rows in `.history[[t - 1]]`... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Recording (cleaned) outputs for `.history[[13]]`... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 12: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Cleaning `.history[[11]]`... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Identifying `cell_now` (for the previous step) that match `cell_past` (for the current step)... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... Input: 67 rows in `.history[[t]]`... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... Filtering 37 dead ends (63 remain)... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... Output: 63 rows in `.history[[t - 1]]`... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Recording (cleaned) outputs for `.history[[12]]`... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 11: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Cleaning `.history[[10]]`... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Identifying `cell_now` (for the previous step) that match `cell_past` (for the current step)... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... Input: 63 rows in `.history[[t]]`... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... Filtering 46 dead ends (54 remain)... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... Output: 54 rows in `.history[[t - 1]]`... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Recording (cleaned) outputs for `.history[[11]]`... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 10: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Cleaning `.history[[9]]`... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Identifying `cell_now` (for the previous step) that match `cell_past` (for the current step)... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... Input: 54 rows in `.history[[t]]`... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... Filtering 42 dead ends (58 remain)... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... Output: 58 rows in `.history[[t - 1]]`... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Recording (cleaned) outputs for `.history[[10]]`... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 9: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Cleaning `.history[[8]]`... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Identifying `cell_now` (for the previous step) that match `cell_past` (for the current step)... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... Input: 58 rows in `.history[[t]]`... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... Filtering 29 dead ends (71 remain)... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... Output: 71 rows in `.history[[t - 1]]`... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Recording (cleaned) outputs for `.history[[9]]`... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 8: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Cleaning `.history[[7]]`... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Identifying `cell_now` (for the previous step) that match `cell_past` (for the current step)... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... Input: 71 rows in `.history[[t]]`... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... Filtering 39 dead ends (61 remain)... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... Output: 61 rows in `.history[[t - 1]]`... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Recording (cleaned) outputs for `.history[[8]]`... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 7: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Cleaning `.history[[6]]`... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Identifying `cell_now` (for the previous step) that match `cell_past` (for the current step)... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... Input: 61 rows in `.history[[t]]`... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... Filtering 40 dead ends (60 remain)... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... Output: 60 rows in `.history[[t - 1]]`... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Recording (cleaned) outputs for `.history[[7]]`... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 6: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Cleaning `.history[[5]]`... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Identifying `cell_now` (for the previous step) that match `cell_past` (for the current step)... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... Input: 60 rows in `.history[[t]]`... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... Filtering 41 dead ends (59 remain)... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... Output: 59 rows in `.history[[t - 1]]`... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Recording (cleaned) outputs for `.history[[6]]`... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 5: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Cleaning `.history[[4]]`... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Identifying `cell_now` (for the previous step) that match `cell_past` (for the current step)... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... Input: 59 rows in `.history[[t]]`... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... Filtering 55 dead ends (45 remain)... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... Output: 45 rows in `.history[[t - 1]]`... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Recording (cleaned) outputs for `.history[[5]]`... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 4: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Cleaning `.history[[3]]`... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Identifying `cell_now` (for the previous step) that match `cell_past` (for the current step)... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... Input: 45 rows in `.history[[t]]`... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... Filtering 32 dead ends (68 remain)... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... Output: 68 rows in `.history[[t - 1]]`... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Recording (cleaned) outputs for `.history[[4]]`... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 3: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Cleaning `.history[[2]]`... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Identifying `cell_now` (for the previous step) that match `cell_past` (for the current step)... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... Input: 68 rows in `.history[[t]]`... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... Filtering 32 dead ends (68 remain)... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... Output: 68 rows in `.history[[t - 1]]`... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Recording (cleaned) outputs for `.history[[3]]`... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 2: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Cleaning `.history[[1]]`... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Identifying `cell_now` (for the previous step) that match `cell_past` (for the current step)... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... Input: 68 rows in `.history[[t]]`... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... Filtering 57 dead ends (43 remain)... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... Output: 43 rows in `.history[[t - 1]]`... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Recording (cleaned) outputs for `.history[[2]]`... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 1: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Recording (cleaned) outputs for `.history[[1]]`... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> `patter::pf_backward_killer()` call ended @ 2024-01-21 13:33:27 (duration: ~0 sec(s)). </span>
<span class="r-in"><span><span class="co"># Define the number of time steps</span></span></span>
<span class="r-in"><span><span class="va">nt</span>       <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">out_pff</span><span class="op">$</span><span class="va">history</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#### Example (1): Implement function with default arguments</span></span></span>
<span class="r-in"><span><span class="fu"><a href="sim_helpers.html">ssv</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">out_pfbs</span> <span class="op">&lt;-</span> <span class="fu">pf_backward_sampler</span><span class="op">(</span>.history <span class="op">=</span> <span class="va">out_pff</span>,</span></span>
<span class="r-in"><span>                                .dlist <span class="op">=</span> <span class="va">dlist</span>,</span></span>
<span class="r-in"><span>                                .record <span class="op">=</span> <span class="fu"><a href="pf_opt.html">pf_opt_record</a></span><span class="op">(</span>.save <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> `patter::pf_backward_sampler()` called @ 2024-01-21 13:33:27... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 25: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 24: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 23: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 22: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 21: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 20: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 19: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 18: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 17: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 16: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 15: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 14: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 13: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 12: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 11: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 10: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 9: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 8: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 7: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 6: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 5: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 4: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 3: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 2: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> `patter::pf_backward_sampler()` call ended @ 2024-01-21 13:33:28 (duration: ~1 sec(s)). </span>
<span class="r-in"><span><span class="co"># The function returns a pf_particles-class object</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">out_pfbs</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         Length Class  Mode</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> history 25     -none- list</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> time     3     -none- list</span>
<span class="r-in"><span><span class="co"># Particle samples are located in the `history` element</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="va">out_pfbs</span><span class="op">$</span><span class="va">history</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    timestep cell_past x_past y_past cell_now    x_now   y_now dens</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1:        1        NA     NA     NA    38140 709442.1 6253007   NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2:        1        NA     NA     NA    37756 709042.1 6253207   NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3:        1        NA     NA     NA    38138 709242.1 6253007   NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4:        1        NA     NA     NA    37377 709142.1 6253407   NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5:        1        NA     NA     NA    37188 709242.1 6253507   NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6:        1        NA     NA     NA    37562 708642.1 6253307   NA</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="va">out_pfbs</span><span class="op">$</span><span class="va">history</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    timestep cell_past   x_past  y_past cell_now    x_now   y_now         dens</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1:        2     38140 709442.1 6253007    38138 709242.1 6253007 0.0069519667</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2:        2     37756 709042.1 6253207    37564 708842.1 6253307 0.0068705416</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3:        2     38138 709242.1 6253007    37569 709342.1 6253307 0.0018304137</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4:        2     37377 709142.1 6253407    37565 708942.1 6253307 0.0068705416</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5:        2     37188 709242.1 6253507    37567 709142.1 6253307 0.0068705416</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6:        2     37562 708642.1 6253307    37185 708942.1 6253507 0.0005980592</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="va">out_pfbs</span><span class="op">$</span><span class="va">history</span><span class="op">[[</span><span class="va">nt</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    timestep cell_past   x_past  y_past cell_now    x_now   y_now        dens</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1:       25     39661 709542.1 6252207    39279 709342.1 6252407 0.003554475</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2:       25     37940 708442.1 6253107    37371 708542.1 6253407 0.001830414</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3:       25     37373 708742.1 6253407    37371 708542.1 6253407 0.006951967</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4:       25     39661 709542.1 6252207    39279 709342.1 6252407 0.003554475</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5:       25     36807 709142.1 6253707    36426 709042.1 6253907 0.006870542</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6:       25     38901 709542.1 6252607    38712 709642.1 6252707 0.002697262</span>
<span class="r-in"><span><span class="co"># The `time` element records timing</span></span></span>
<span class="r-in"><span><span class="va">out_pfbs</span><span class="op">$</span><span class="va">time</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $start</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "2024-01-21 13:33:27 CET"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $end</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "2024-01-21 13:33:28 CET"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $duration</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Time difference of 0.3596141 secs</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#### Example (2): Use particle samples in memory or on file</span></span></span>
<span class="r-in"><span><span class="co"># Particles can be provided in any format accepted by `?.pf_history_list()`</span></span></span>
<span class="r-in"><span><span class="co"># Here, we use precomputed samples:</span></span></span>
<span class="r-in"><span><span class="fu"><a href="sim_helpers.html">ssv</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">out_pfbs_b</span> <span class="op">&lt;-</span> <span class="fu">pf_backward_sampler</span><span class="op">(</span>.history <span class="op">=</span> <span class="va">out_pff</span><span class="op">$</span><span class="va">history</span>,</span></span>
<span class="r-in"><span>                                  .dlist <span class="op">=</span> <span class="va">dlist</span>,</span></span>
<span class="r-in"><span>                                  .record <span class="op">=</span> <span class="fu"><a href="pf_opt.html">pf_opt_record</a></span><span class="op">(</span>.save <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> `patter::pf_backward_sampler()` called @ 2024-01-21 13:33:28... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 25: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 24: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 23: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 22: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 21: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 20: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 19: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 18: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 17: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 16: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 15: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 14: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 13: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 12: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 11: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 10: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 9: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 8: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 7: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 6: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 5: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 4: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 3: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 2: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> `patter::pf_backward_sampler()` call ended @ 2024-01-21 13:33:28 (duration: ~0 sec(s)). </span>
<span class="r-in"><span><span class="fu"><a href="sim_helpers.html">ssv</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">out_pfbs_c</span> <span class="op">&lt;-</span> <span class="fu">pf_backward_sampler</span><span class="op">(</span>.history <span class="op">=</span> <span class="fu"><a href="datasets-algorithms.html">dat_pff_src</a></span><span class="op">(</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                                  .dlist <span class="op">=</span> <span class="va">dlist</span>,</span></span>
<span class="r-in"><span>                                  .record <span class="op">=</span> <span class="fu"><a href="pf_opt.html">pf_opt_record</a></span><span class="op">(</span>.save <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> `patter::pf_backward_sampler()` called @ 2024-01-21 13:33:28... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 25: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 24: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 23: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 22: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 21: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 20: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 19: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 18: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 17: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 16: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 15: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 14: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 13: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 12: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 11: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 10: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 9: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 8: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 7: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 6: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 5: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 4: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 3: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 2: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> `patter::pf_backward_sampler()` call ended @ 2024-01-21 13:33:29 (duration: ~1 sec(s)). </span>
<span class="r-in"><span><span class="fu"><a href="sim_helpers.html">ssv</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">out_pfbs_d</span> <span class="op">&lt;-</span> <span class="fu">pf_backward_sampler</span><span class="op">(</span>.history <span class="op">=</span> <span class="fu"><a href="pf_files.html">pf_files</a></span><span class="op">(</span><span class="fu"><a href="datasets-algorithms.html">dat_pff_src</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                                  .dlist <span class="op">=</span> <span class="va">dlist</span>,</span></span>
<span class="r-in"><span>                                  .record <span class="op">=</span> <span class="fu"><a href="pf_opt.html">pf_opt_record</a></span><span class="op">(</span>.save <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> `patter::pf_backward_sampler()` called @ 2024-01-21 13:33:29... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 25: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 24: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 23: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 22: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 21: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 20: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 19: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 18: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 17: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 16: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 15: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 14: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 13: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 12: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 11: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 10: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 9: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 8: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 7: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 6: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 5: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 4: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 3: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 2: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> `patter::pf_backward_sampler()` call ended @ 2024-01-21 13:33:29 (duration: ~0 sec(s)). </span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="va">out_pfbs</span><span class="op">$</span><span class="va">history</span>, <span class="va">out_pfbs_b</span><span class="op">$</span><span class="va">history</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="va">out_pfbs</span><span class="op">$</span><span class="va">history</span>, <span class="va">out_pfbs_c</span><span class="op">$</span><span class="va">history</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="va">out_pfbs</span><span class="op">$</span><span class="va">history</span>, <span class="va">out_pfbs_d</span><span class="op">$</span><span class="va">history</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#### Example (3): Customise the movement model</span></span></span>
<span class="r-in"><span><span class="co"># Use .dpropose and .dargs</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#### Example (4): Write history to file (as in `pf_forward()`)</span></span></span>
<span class="r-in"><span><span class="va">con</span>        <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"patter"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">pfbs_folder</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">con</span>, <span class="st">"backward"</span>, <span class="st">"sampler"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="va">pfbs_folder</span>, recursive <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="sim_helpers.html">ssv</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">out_pfbs</span> <span class="op">&lt;-</span> <span class="fu">pf_backward_sampler</span><span class="op">(</span>.history <span class="op">=</span> <span class="va">out_pff</span>,</span></span>
<span class="r-in"><span>                                .dlist <span class="op">=</span> <span class="va">dlist</span>,</span></span>
<span class="r-in"><span>                                .record <span class="op">=</span> <span class="fu"><a href="pf_opt.html">pf_opt_record</a></span><span class="op">(</span>.save <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>                                                        .sink <span class="op">=</span> <span class="va">pfbs_folder</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> `patter::pf_backward_sampler()` called @ 2024-01-21 13:33:29... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 25: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 24: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 23: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 22: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 21: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 20: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 19: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 18: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 17: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 16: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 15: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 14: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 13: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 12: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 11: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 10: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 9: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 8: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 7: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 6: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 5: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 4: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 3: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Time step 2: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> `patter::pf_backward_sampler()` call ended @ 2024-01-21 13:33:29 (duration: ~0 sec(s)). </span>
<span class="r-in"><span><span class="fu"><a href="cl_lapply.html">cl_lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">nt</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">a</span> <span class="op">&lt;-</span> <span class="va">out_pfbs</span><span class="op">$</span><span class="va">history</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span></span></span>
<span class="r-in"><span>  <span class="va">b</span> <span class="op">&lt;-</span> <span class="fu">arrow</span><span class="fu">::</span><span class="fu"><a href="https://arrow.apache.org/docs/r/reference/read_parquet.html" class="external-link">read_parquet</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">pfbs_folder</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">i</span>, <span class="st">".parquet"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="va">a</span>, <span class="va">b</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#### Example (4): Adjust standard `patter-progress` options</span></span></span>
<span class="r-in"><span><span class="co"># See `?pf_backward_killer()` for examples</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#### Example (5): Compare particle diagnostics (e.g., degeneracy)</span></span></span>
<span class="r-in"><span><span class="co"># Extract diagnostics</span></span></span>
<span class="r-in"><span><span class="va">diag_f</span> <span class="op">&lt;-</span> <span class="fu"><a href="pf_backward_killer_diagnostics.html">pf_backward_killer_diagnostics</a></span><span class="op">(</span><span class="va">out_pff</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">diag_k</span> <span class="op">&lt;-</span> <span class="fu"><a href="pf_backward_killer_diagnostics.html">pf_backward_killer_diagnostics</a></span><span class="op">(</span><span class="va">out_pfbk</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">diag_s</span> <span class="op">&lt;-</span> <span class="fu"><a href="pf_backward_killer_diagnostics.html">pf_backward_killer_diagnostics</a></span><span class="op">(</span><span class="va">out_pfbs</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Compare the number of unique samples through time</span></span></span>
<span class="r-in"><span><span class="va">ylim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">diag_f</span><span class="op">$</span><span class="va">n_u</span>, <span class="va">diag_k</span><span class="op">$</span><span class="va">n_u</span>, <span class="va">diag_s</span><span class="op">$</span><span class="va">n_u</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">diag_f</span><span class="op">$</span><span class="va">timestep</span>, <span class="va">diag_f</span><span class="op">$</span><span class="va">n_u</span>,</span></span>
<span class="r-in"><span>     ylim <span class="op">=</span> <span class="va">ylim</span>,</span></span>
<span class="r-in"><span>     xlab <span class="op">=</span> <span class="st">"Time (steps)"</span>, ylab <span class="op">=</span> <span class="st">"Number unique samples"</span>,</span></span>
<span class="r-in"><span>     type <span class="op">=</span> <span class="st">"b"</span>, cex <span class="op">=</span> <span class="fl">0.5</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">diag_k</span><span class="op">$</span><span class="va">timestep</span>, <span class="va">diag_k</span><span class="op">$</span><span class="va">n_u</span>,</span></span>
<span class="r-in"><span>      type <span class="op">=</span> <span class="st">"b"</span>, cex <span class="op">=</span> <span class="fl">0.5</span>, col <span class="op">=</span> <span class="st">"orange"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">diag_k</span><span class="op">$</span><span class="va">timestep</span>, <span class="va">diag_s</span><span class="op">$</span><span class="va">n_u</span>,</span></span>
<span class="r-in"><span>      type <span class="op">=</span> <span class="st">"b"</span>, cex <span class="op">=</span> <span class="fl">0.5</span>, col <span class="op">=</span> <span class="st">"darkgreen"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="pf_backward_sampler-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#### Example (6): Compare maps</span></span></span>
<span class="r-in"><span><span class="va">pp</span>    <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">gebco</span> <span class="op">&lt;-</span> <span class="fu"><a href="datasets-mefs.html">dat_gebco</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="map_dens.html">map_dens</a></span><span class="op">(</span>.map <span class="op">=</span> <span class="va">gebco</span>,</span></span>
<span class="r-in"><span>         .coord <span class="op">=</span> <span class="fu"><a href="pf_coord.html">pf_coord</a></span><span class="op">(</span>.history <span class="op">=</span> <span class="va">out_pff</span>, .bathy <span class="op">=</span> <span class="va">gebco</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>         sigma <span class="op">=</span> <span class="fu">spatstat.explore</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/spatstat.explore/man/bw.diggle.html" class="external-link">bw.diggle</a></span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> `patter::map_dens()` called @ 2024-01-21 13:33:29... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Processing `.map`... </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Observation window is gridded.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Building XYM... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Defining `ppp` object... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Estimating density surface... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Scaling density surface... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> `patter::map_dens()` call ended @ 2024-01-21 13:33:30 (duration: ~1 sec(s)). </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> class       : SpatRaster </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> dimensions  : 264, 190, 1  (nrow, ncol, nlyr)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> resolution  : 100, 100  (x, y)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> extent      : 695492.1, 714492.1, 6246657, 6273057  (xmin, xmax, ymin, ymax)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> coord. ref. : WGS 84 / UTM zone 29N (EPSG:32629) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> source(s)   : memory</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> name        :         lyr.1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> min value   : -1.345780e-18 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> max value   :  2.104136e-02 </span>
<span class="r-in"><span><span class="fu"><a href="map_dens.html">map_dens</a></span><span class="op">(</span>.map <span class="op">=</span> <span class="va">gebco</span>,</span></span>
<span class="r-in"><span>         .coord <span class="op">=</span> <span class="fu"><a href="pf_coord.html">pf_coord</a></span><span class="op">(</span>.history <span class="op">=</span> <span class="va">out_pfbk</span>, .bathy <span class="op">=</span> <span class="va">gebco</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>         sigma <span class="op">=</span> <span class="fu">spatstat.explore</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/spatstat.explore/man/bw.diggle.html" class="external-link">bw.diggle</a></span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> `patter::map_dens()` called @ 2024-01-21 13:33:30... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Processing `.map`... </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Observation window is gridded.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Building XYM... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Defining `ppp` object... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Estimating density surface... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Scaling density surface... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> `patter::map_dens()` call ended @ 2024-01-21 13:33:30 (duration: ~0 sec(s)). </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> class       : SpatRaster </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> dimensions  : 264, 190, 1  (nrow, ncol, nlyr)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> resolution  : 100, 100  (x, y)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> extent      : 695492.1, 714492.1, 6246657, 6273057  (xmin, xmax, ymin, ymax)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> coord. ref. : WGS 84 / UTM zone 29N (EPSG:32629) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> source(s)   : memory</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> name        :         lyr.1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> min value   : -3.680120e-18 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> max value   :  2.751452e-02 </span>
<span class="r-in"><span><span class="fu"><a href="map_dens.html">map_dens</a></span><span class="op">(</span>.map <span class="op">=</span> <span class="va">gebco</span>,</span></span>
<span class="r-in"><span>         .coord <span class="op">=</span> <span class="fu"><a href="pf_coord.html">pf_coord</a></span><span class="op">(</span>.history <span class="op">=</span> <span class="va">out_pfbs</span>, .bathy <span class="op">=</span> <span class="va">gebco</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>         sigma <span class="op">=</span> <span class="fu">spatstat.explore</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/spatstat.explore/man/bw.diggle.html" class="external-link">bw.diggle</a></span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> `patter::map_dens()` called @ 2024-01-21 13:33:30... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Processing `.map`... </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Observation window is gridded.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Building XYM... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Defining `ppp` object... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Estimating density surface... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Scaling density surface... </span>
<span class="r-plt img"><img src="pf_backward_sampler-2.png" alt="" width="700" height="433"></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> `patter::map_dens()` call ended @ 2024-01-21 13:33:30 (duration: ~0 sec(s)). </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> class       : SpatRaster </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> dimensions  : 264, 190, 1  (nrow, ncol, nlyr)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> resolution  : 100, 100  (x, y)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> extent      : 695492.1, 714492.1, 6246657, 6273057  (xmin, xmax, ymin, ymax)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> coord. ref. : WGS 84 / UTM zone 29N (EPSG:32629) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> source(s)   : memory</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> name        :         lyr.1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> min value   : -1.455139e-18 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> max value   :  2.460211e-02 </span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span><span class="va">pp</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Clean up</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/unlink.html" class="external-link">unlink</a></span><span class="op">(</span><span class="va">con</span>, recursive <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Edward Lavender.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

