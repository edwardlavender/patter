<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>COA: centres of activity — coa • patter</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="COA: centres of activity — coa"><meta name="description" content="This function calculates centres of activity (COAs) from detections at acoustic receivers."><meta property="og:description" content="This function calculates centres of activity (COAs) from detections at acoustic receivers."><meta property="og:image" content="https://edwardlavender.github.io/patter/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">patter</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.0.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/a-methodology.html">Methodology</a></li>
    <li><a class="dropdown-item" href="../articles/b-workflow-outline.html">Workflow outline</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/edwardlavender/patter/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>COA: centres of activity</h1>
      <small class="dont-index">Source: <a href="https://github.com/edwardlavender/patter/blob/HEAD/R/coa.R" class="external-link"><code>R/coa.R</code></a></small>
      <div class="d-none name"><code>coa.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function calculates centres of activity (COAs) from detections at acoustic receivers.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">coa</span><span class="op">(</span></span>
<span>  <span class="va">.map</span>,</span>
<span>  <span class="va">.detections</span>,</span>
<span>  .moorings <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">.delta_t</span>,</span>
<span>  .split <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  .plot_weights <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  .one_page <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg--map">.map<a class="anchor" aria-label="anchor" href="#arg--map"></a></dt>
<dd><p>A <code><a href="https://rspatial.github.io/terra/reference/SpatRaster-class.html" class="external-link">terra::SpatRaster</a></code> that defines the study area (see <code><a href="glossary.html">glossary</a></code>). Here, <code>.map</code> is used to:</p><ul><li><p>Extract <code>map_value</code> at centres of activity, for consistency with other routines (such as <code><a href="pf_filter.html">pf_filter()</a></code>);</p></li>
</ul></dd>


<dt id="arg--detections-moorings">.detections, .moorings<a class="anchor" aria-label="anchor" href="#arg--detections-moorings"></a></dt>
<dd><p>Acoustic detection <a href="s"><code><a href="https://rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table::data.table</a></code></a>.</p><ul><li><p><code>.detections</code> is a <code><a href="https://rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table::data.table</a></code> of acoustic detections, with the following columns: <code>receiver_id</code> (or <code>sensor_id</code>), <code>timestamp</code> and (optionally) <code>receiver_x</code> and <code>receiver_y</code> columns;</p></li>
<li><p>(optional) <code>.moorings</code> is a <code><a href="https://rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table::data.table</a></code> of receiver coordinates, which should be provided if unavailable in <code>.detections</code>, with <code>receiver_id</code>, <code>receiver_x</code> and <code>receiver_y</code> columns;</p></li>
</ul><p>Receiver coordinates <strong>must be planar</strong>.</p></dd>


<dt id="arg--delta-t">.delta_t<a class="anchor" aria-label="anchor" href="#arg--delta-t"></a></dt>
<dd><p>The time interval over which to calculate COAs. This can be specified in any way understood by <code><a href="https://lubridate.tidyverse.org/reference/round_date.html" class="external-link">lubridate::floor_date()</a></code> (see the <code>unit</code> argument).</p></dd>


<dt id="arg--split">.split<a class="anchor" aria-label="anchor" href="#arg--split"></a></dt>
<dd><p>(optional) A <code>character</code> that defines the name of the grouping factor in <code>.detections</code> (e.g., <code>individual_id</code> for <code><a href="datasets-mefs.html">dat_detections</a></code>).</p></dd>


<dt id="arg--plot-weights-one-page">.plot_weights, ..., .one_page<a class="anchor" aria-label="anchor" href="#arg--plot-weights-one-page"></a></dt>
<dd><p>Plot arguments.</p><ul><li><p><code>.plot_weights</code> is a <code>logical</code> variable that defines whether or not to plot the frequency distribution of weights for each <code>.split</code> value (i.e., the frequency distribution of the number of detections at each receiver in each time interval, excluding time intervals without detections).</p></li>
<li><p><code>...</code> is a placeholder for arguments passed to <code><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">graphics::hist()</a></code>, excluding <code>main</code>.</p></li>
<li><p><code>.one_page</code> A <code>logical</code> variable that defines whether or not to plot all histograms on one page.</p></li>
</ul></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>The function returns a <code><a href="https://rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table::data.table</a></code> with the following columns:</p><ul><li><p><code>{.split}</code>—a <code>character</code> vector that distinguishes groups, if applicable;</p></li>
<li><p><code>timestep</code>—an <code>integer</code> vector of time steps;</p></li>
<li><p><code>timestamp</code>—a <code>POSIXt</code> vector of time stamps;</p></li>
<li><p><code>map_value</code>, <code>x</code>, <code>y</code>—the value of <code>.map</code> at COAs and their coordinates;</p></li>
</ul><p>Data are arranged by <code>.split</code> and <code>timestamp</code>.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>COAs are calculated as a weighted mean of the locations of receivers at which individuals are detected over consecutive time intervals, weighted by the frequency of detections at each of those receivers. COAs are calculated via <code><a href="https://rdrr.io/r/stats/weighted.mean.html" class="external-link">stats::weighted.mean()</a></code>, which assumes planar coordinates, for consistency with other <code><a href="patter.html">patter</a></code> routines. To handle longitude/latitude coordinates, use <code><a href="https://rdrr.io/pkg/geosphere/man/geomean.html" class="external-link">geosphere::geomean()</a></code>.</p>
<p>This function replaces <a href="https://edwardlavender.github.io/flapper/reference/coa.html" class="external-link"><code><a href="https://edwardlavender.github.io/flapper/reference/coa.html" class="external-link">flapper::coa()</a></code></a>. See  <a href="https://edwardlavender.github.io/flapper/reference/coa_setup_delta_t.html" class="external-link"><code><a href="https://edwardlavender.github.io/flapper/reference/coa_setup_delta_t.html" class="external-link">flapper::coa_setup_delta_t()</a></code></a> to evaluate alternative time internals.</p>
<p>On Linux, this function cannot be used within a <code>Julia</code> session.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index">
<ul><li><p>To derive location samples from a particle filtering algorithm, see <code><a href="pf_filter.html">pf_filter()</a></code> and associates;</p></li>
<li><p>For mapping utilisation distributions from coordinates, see <code>map_*()</code> functions (i.e., <code><a href="map_pou.html">map_pou()</a></code> and <code><a href="map_dens.html">map_dens()</a></code>);</p></li>
</ul></div>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Edward Lavender</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="patter_run.html">patter_run</a></span><span class="op">(</span>.julia <span class="op">=</span> <span class="cn">FALSE</span>, .geospatial <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co">#### Set up example</span></span></span>
<span class="r-in"><span>  <span class="va">map</span>        <span class="op">&lt;-</span> <span class="fu"><a href="datasets-mefs.html">dat_gebco</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">detections</span> <span class="op">&lt;-</span> <span class="va">dat_detections</span></span></span>
<span class="r-in"><span>  <span class="va">moorings</span>   <span class="op">&lt;-</span> <span class="va">dat_moorings</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co">#### Example (1): Calculate COAs for an example individual</span></span></span>
<span class="r-in"><span>  <span class="va">id</span>     <span class="op">&lt;-</span> <span class="va">dat_detections</span><span class="op">$</span><span class="va">individual_id</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span></span>
<span class="r-in"><span>  <span class="va">det</span>    <span class="op">&lt;-</span> <span class="va">dat_detections</span><span class="op">[</span><span class="va">individual_id</span> <span class="op">==</span> <span class="va">id</span>, <span class="op">]</span></span></span>
<span class="r-in"><span>  <span class="fu">coa</span><span class="op">(</span>.map <span class="op">=</span> <span class="va">map</span>, .detections <span class="op">=</span> <span class="va">det</span>, .moorings <span class="op">=</span> <span class="va">moorings</span>,</span></span>
<span class="r-in"><span>      .delta_t <span class="op">=</span> <span class="st">"2 hours"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co">#### Example (2): Customise the time interval via `.delta_t`</span></span></span>
<span class="r-in"><span>  <span class="fu">coa</span><span class="op">(</span>.map <span class="op">=</span> <span class="va">map</span>, .detections <span class="op">=</span> <span class="va">det</span>, .moorings <span class="op">=</span> <span class="va">moorings</span>,</span></span>
<span class="r-in"><span>      .delta_t <span class="op">=</span> <span class="st">"4 hours"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co">#### Example (3): Calculate COAs for multiple individuals via `.split`</span></span></span>
<span class="r-in"><span>  <span class="co"># Calculate COAs</span></span></span>
<span class="r-in"><span>  <span class="fu">coa</span><span class="op">(</span>.map <span class="op">=</span> <span class="va">map</span>, .detections <span class="op">=</span> <span class="va">det</span>, .moorings <span class="op">=</span> <span class="va">moorings</span>,</span></span>
<span class="r-in"><span>      .delta_t <span class="op">=</span> <span class="st">"6 hours"</span>, .split <span class="op">=</span> <span class="st">"individual_id"</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="co"># Use one page for plots via `.one_page = TRUE`</span></span></span>
<span class="r-in"><span>  <span class="fu">coa</span><span class="op">(</span>.map <span class="op">=</span> <span class="va">map</span>, .detections <span class="op">=</span> <span class="va">det</span>, .moorings <span class="op">=</span> <span class="va">moorings</span>,</span></span>
<span class="r-in"><span>      .delta_t <span class="op">=</span> <span class="st">"6 hours"</span>, .split <span class="op">=</span> <span class="st">"individual_id"</span>,</span></span>
<span class="r-in"><span>      .one_page <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="co"># Suppress plots via `.plot = FALSE`</span></span></span>
<span class="r-in"><span>  <span class="fu">coa</span><span class="op">(</span>.map <span class="op">=</span> <span class="va">map</span>, .detections <span class="op">=</span> <span class="va">det</span>, .moorings <span class="op">=</span> <span class="va">moorings</span>,</span></span>
<span class="r-in"><span>      .delta_t <span class="op">=</span> <span class="st">"6 hours"</span>, .split <span class="op">=</span> <span class="st">"individual_id"</span>,</span></span>
<span class="r-in"><span>      .one_page <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co">#### Example (4): Specify `.detections` only</span></span></span>
<span class="r-in"><span>  <span class="co"># `.moorings` is not required if `.detections` contains receiver coordinates</span></span></span>
<span class="r-in"><span>  <span class="fu">coa</span><span class="op">(</span>.map <span class="op">=</span> <span class="va">map</span>,</span></span>
<span class="r-in"><span>      .detections <span class="op">=</span></span></span>
<span class="r-in"><span>        <span class="va">detections</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>        <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">moorings</span>, by <span class="op">=</span> <span class="st">"receiver_id"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>      .delta_t <span class="op">=</span> <span class="st">"6 hours"</span>, .split <span class="op">=</span> <span class="st">"individual_id"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-plt img"><img src="coa-1.png" alt="" width="700" height="433"></span>
<span class="r-plt img"><img src="coa-2.png" alt="" width="700" height="433"></span>
<span class="r-plt img"><img src="coa-3.png" alt="" width="700" height="433"></span>
<span class="r-plt img"><img src="coa-4.png" alt="" width="700" height="433"></span>
<span class="r-plt img"><img src="coa-5.png" alt="" width="700" height="433"></span>
<span class="r-plt img"><img src="coa-6.png" alt="" width="700" height="433"></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       individual_id timestep           timestamp map_value        x       y</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>               &lt;int&gt;    &lt;int&gt;              &lt;POSc&gt;     &lt;num&gt;    &lt;num&gt;   &lt;num&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    1:            25        1 2016-03-17 00:00:00  59.76520 709120.1 6253030</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    2:            25        2 2016-03-17 06:00:00  49.72233 709398.4 6253169</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    3:            25        3 2016-03-21 18:00:00  58.17422 709242.1 6253107</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    4:            25        4 2016-03-22 00:00:00  58.17422 709242.1 6253107</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    5:            25        5 2016-03-22 06:00:00  58.17422 709242.1 6253107</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ---                                                                      </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1204:            35      402 2017-04-10 18:00:00  99.90396 709048.8 6253427</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1205:            35      403 2017-04-11 18:00:00  49.51562 706342.1 6254307</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1206:            35      404 2017-04-12 00:00:00 117.36553 707042.1 6253840</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1207:            35      405 2017-04-12 18:00:00 113.60658 708771.2 6253210</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1208:            35      406 2017-04-19 18:00:00 129.77667 707242.1 6253707</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Edward Lavender.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

