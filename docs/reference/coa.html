<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>COA: centres of activity — coa • patter</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="COA: centres of activity — coa"><meta property="og:description" content="This function calculates centres of activity (COAs) from detections at acoustic receivers."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">patter</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/a-methodology.html">Methodology</a>
    </li>
    <li>
      <a href="../articles/b-workflow-outline.html">Workflow outline</a>
    </li>
    <li>
      <a href="../articles/c-workflow-example.html">Example workflow</a>
    </li>
    <li>
      <a href="../articles/d-demos.html">Demos</a>
    </li>
    <li>
      <a href="../articles/e-faqs.html">FAQs</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/edwardlavender/patter/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>COA: centres of activity</h1>
    <small class="dont-index">Source: <a href="https://github.com/edwardlavender/patter/blob/HEAD/R/coa.R" class="external-link"><code>R/coa.R</code></a></small>
    <div class="hidden name"><code>coa.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This function calculates centres of activity (COAs) from detections at acoustic receivers.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">coa</span><span class="op">(</span></span>
<span>  <span class="va">.dlist</span>,</span>
<span>  <span class="va">.delta_t</span>,</span>
<span>  .split <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  .plot_weights <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  .one_page <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>.dlist</dt>
<dd><p>A named <code>list</code> of data and parameters from <code><a href="pat_setup_data.html">pat_setup_data()</a></code>. This function requires:</p><ul><li><p><code>.dlist$data$acoustics</code>, with the following columns: <code>receiver_id</code> and <code>timestamp</code>;</p></li>
<li><p><code>.dlist$data$moorings</code>, with the following columns: <code>receiver_id</code>, <code>receiver_x</code> and  <code>receiver_y</code>;</p></li>
<li><p><code>.dlist$pars$lonlat</code>, which specifies the coordinate format (longitude/latitude or planar);</p></li>
</ul></dd>


<dt>.delta_t</dt>
<dd><p>The time interval over which to calculate COAs. This can be specified in any way understood by <code><a href="https://rdrr.io/r/base/cut.POSIXt.html" class="external-link">cut.POSIXt()</a></code> (see the <code>breaks</code> argument).</p></dd>


<dt>.split</dt>
<dd><p>(optional) A <code>character</code> that defines the name of the grouping factor in <code>.dlist$data$acoustics</code> (e.g., <code>individual_id</code> for <code><a href="datasets-mefs.html">dat_acoustics</a></code>).</p></dd>


<dt>.plot_weights, ..., .one_page</dt>
<dd><p>Plot arguments.</p><ul><li><p><code>.plot_weights</code> is a <code>logical</code> variable that defines whether or not to plot the frequency distribution of weights for each <code>.split</code> value (i.e., the frequency distribution of the number of detections at each receiver in each time interval, excluding time intervals without detections).</p></li>
<li><p><code>...</code> is a placeholder for arguments passed to <code><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">graphics::hist()</a></code>.</p></li>
<li><p><code>.one_page</code> A <code>logical</code> variable that defines whether or not to plot all histograms on one page.</p></li>
</ul></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>The function returns a <code><a href="https://rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table</a></code> with the following columns:</p><ul><li><p><code>.split</code>---a <code>character</code> vector that distinguishes groups, if applicable;</p></li>
<li><p><code>timestamp</code>---a <code>POSIXt</code> vector of time stamps;</p></li>
<li><p><code>coa_x</code>,<code>coa_y</code>---the coordinates of the COAs;</p></li>
</ul><p>Data are arranged by <code>.split</code> and <code>timestamp</code>.</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>COAs are calculated as a weighted mean of the locations of receivers at which individuals are detected over consecutive time intervals, weighted by the frequency of detections at each of those receivers. COAs are calculated via <code><a href="https://rdrr.io/r/stats/weighted.mean.html" class="external-link">stats::weighted.mean()</a></code> (for planar coordinates) or <code><a href="https://rdrr.io/pkg/geosphere/man/geomean.html" class="external-link">geosphere::geomean()</a></code> (for longitude/latitude coordinates).</p>
<p>This function replaces <a href="https://edwardlavender.github.io/flapper/reference/coa.html" class="external-link"><code>flapper::coa()</code></a>. See  <a href="https://edwardlavender.github.io/flapper/reference/coa_setup_delta_t.html" class="external-link"><code>flapper::coa_setup_delta_t()</code></a> to evaluate alternative time internals.</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index">
<ul><li><p>To derive location samples from the forward-filter backward-sampler, see <code><a href="pf_forward.html">pf_forward()</a></code>, <code>pf_backward_sampler()</code> and <code><a href="pf_coord.html">pf_coord()</a></code>;</p></li>
<li><p>For mapping utilisation distributions from coordinates, see <code>map_*()</code> functions (i.e., <code><a href="map_pou.html">map_pou()</a></code> and <code><a href="map_dens.html">map_dens()</a></code>;</p></li>
</ul></div>
    </div>
    <div id="author">
    <h2>Author</h2>
    <p>Edward Lavender</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#### Example (1): Calculate COAs for an example individual</span></span></span>
<span class="r-in"><span><span class="va">acc</span>   <span class="op">&lt;-</span> <span class="va">dat_acoustics</span><span class="op">[</span><span class="va">individual_id</span> <span class="op">==</span> <span class="va">dat_acoustics</span><span class="op">$</span><span class="va">individual_id</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">gebco</span> <span class="op">&lt;-</span> <span class="fu"><a href="datasets-mefs.html">dat_gebco</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">dlist</span>  <span class="op">&lt;-</span> <span class="fu"><a href="pat_setup_data.html">pat_setup_data</a></span><span class="op">(</span>.acoustics <span class="op">=</span> <span class="va">acc</span>,</span></span>
<span class="r-in"><span>                        .moorings <span class="op">=</span> <span class="va">dat_moorings</span>,</span></span>
<span class="r-in"><span>                        .bathy <span class="op">=</span> <span class="va">gebco</span>,</span></span>
<span class="r-in"><span>                        .lonlat <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">coa</span><span class="op">(</span><span class="va">dlist</span>, .delta_t <span class="op">=</span> <span class="st">"2 hours"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="coa-1.png" alt="" width="700" height="433"></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                timestamp    coa_x   coa_y</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   1: 2016-03-17 01:00:00 709176.9 6253068</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   2: 2016-03-17 03:00:00 708972.9 6252945</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   3: 2016-03-17 05:00:00 709304.6 6253132</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   4: 2016-03-17 07:00:00 709396.0 6253168</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   5: 2016-03-17 09:00:00 709408.8 6253174</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  ---                                     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 758: 2017-05-31 21:00:00 702947.7 6266212</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 759: 2017-05-31 23:00:00 703028.5 6266293</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 760: 2017-06-01 01:00:00 703042.1 6266307</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 761: 2017-06-01 03:00:00 703042.1 6266307</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 762: 2017-06-01 05:00:00 703042.1 6266307</span>
<span class="r-in"><span><span class="fu">coa</span><span class="op">(</span><span class="va">dlist</span>, .delta_t <span class="op">=</span> <span class="st">"4 hours"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="coa-2.png" alt="" width="700" height="433"></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                timestamp    coa_x   coa_y</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   1: 2016-03-17 01:00:00 709048.6 6252991</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   2: 2016-03-17 05:00:00 709336.7 6253145</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   3: 2016-03-17 09:00:00 709408.8 6253174</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   4: 2016-03-21 21:00:00 709242.1 6253107</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   5: 2016-03-22 05:00:00 709242.1 6253107</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  ---                                     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 554: 2017-05-30 21:00:00 702847.0 6266057</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 555: 2017-05-31 17:00:00 702999.3 6266264</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 556: 2017-05-31 21:00:00 702971.1 6266236</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 557: 2017-06-01 01:00:00 703042.1 6266307</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 558: 2017-06-01 05:00:00 703042.1 6266307</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#### Example (2): Calculate COAs for multiple individuals via .split</span></span></span>
<span class="r-in"><span><span class="va">dlist</span> <span class="op">&lt;-</span> <span class="fu"><a href="pat_setup_data.html">pat_setup_data</a></span><span class="op">(</span>.acoustics <span class="op">=</span> <span class="va">dat_acoustics</span>,</span></span>
<span class="r-in"><span>                       .moorings <span class="op">=</span> <span class="va">dat_moorings</span>,</span></span>
<span class="r-in"><span>                       .bathy <span class="op">=</span> <span class="va">gebco</span>,</span></span>
<span class="r-in"><span>                       .lonlat <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Multiple individuals detected in acoustic data.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Acoustic time stamps should be ordered chronologically.</span>
<span class="r-in"><span><span class="fu">coa</span><span class="op">(</span><span class="va">dlist</span>, .delta_t <span class="op">=</span> <span class="st">"6 hours"</span>, .split <span class="op">=</span> <span class="st">"individual_id"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       individual_id           timestamp    coa_x   coa_y</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    1:            25 2016-03-17 01:00:00 709120.1 6253030</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    2:            25 2016-03-17 07:00:00 709398.4 6253169</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    3:            25 2016-03-21 19:00:00 709242.1 6253107</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    4:            25 2016-03-22 01:00:00 709242.1 6253107</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    5:            25 2016-03-22 07:00:00 709242.1 6253107</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ---                                                   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1216:            35 2017-04-10 05:00:00 708275.5 6252874</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1217:            35 2017-04-10 17:00:00 708772.1 6253272</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1218:            35 2017-04-11 23:00:00 707000.4 6253868</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1219:            35 2017-04-12 17:00:00 708771.2 6253210</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1220:            35 2017-04-19 23:00:00 707242.1 6253707</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#### Example (3): Use lon/lat coordinates</span></span></span>
<span class="r-in"><span><span class="va">gebco_ll</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/project.html" class="external-link">project</a></span><span class="op">(</span><span class="fu"><a href="datasets-mefs.html">dat_gebco</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"EPSG:4326"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">dlist</span> <span class="op">&lt;-</span> <span class="fu"><a href="pat_setup_data.html">pat_setup_data</a></span><span class="op">(</span>.acoustics <span class="op">=</span> <span class="va">dat_acoustics</span>,</span></span>
<span class="r-in"><span>                       .moorings <span class="op">=</span> <span class="va">dat_moorings</span>,</span></span>
<span class="r-in"><span>                       .bathy <span class="op">=</span> <span class="va">gebco_ll</span>,</span></span>
<span class="r-in"><span>                       .lonlat <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Multiple individuals detected in acoustic data.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Acoustic time stamps should be ordered chronologically.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> `.moorings` coordinates coerced onto `.bathy` grid.</span>
<span class="r-in"><span><span class="fu">coa</span><span class="op">(</span><span class="va">dlist</span>, .delta_t <span class="op">=</span> <span class="st">"6 hours"</span>, .split <span class="op">=</span> <span class="st">"individual_id"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="coa-3.png" alt="" width="700" height="433"></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       individual_id           timestamp     coa_x    coa_y</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    1:            25 2016-03-17 01:00:00 -5.612719 56.37542</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    2:            25 2016-03-17 07:00:00 -5.607875 56.37639</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    3:            25 2016-03-21 19:00:00 -5.610413 56.37602</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    4:            25 2016-03-22 01:00:00 -5.610413 56.37602</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    5:            25 2016-03-22 07:00:00 -5.610413 56.37602</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ---                                                     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1216:            35 2017-04-10 05:00:00 -5.626653 56.37486</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1217:            35 2017-04-10 17:00:00 -5.618533 56.37788</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1218:            35 2017-04-11 23:00:00 -5.647482 56.38423</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1219:            35 2017-04-12 17:00:00 -5.618795 56.37726</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1220:            35 2017-04-19 23:00:00 -5.644054 56.38298</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Edward Lavender.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

