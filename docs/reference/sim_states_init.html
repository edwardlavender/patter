<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Simulation: initial states — sim_states_init • patter</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Simulation: initial states — sim_states_init"><meta property="og:description" content="Simulate initial states for animal movement walks."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">patter</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/a-methodology.html">Methodology</a>
    </li>
    <li>
      <a href="../articles/b-workflow-outline.html">Workflow outline</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/edwardlavender/patter/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Simulation: initial states</h1>
    <small class="dont-index">Source: <a href="https://github.com/edwardlavender/patter/blob/HEAD/R/initialise-states.R" class="external-link"><code>R/initialise-states.R</code></a></small>
    <div class="hidden name"><code>sim_states_init.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Simulate initial states for animal movement walks.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">sim_states_init</span><span class="op">(</span></span>
<span>  <span class="va">.map</span>,</span>
<span>  <span class="va">.timeline</span>,</span>
<span>  <span class="va">.direction</span>,</span>
<span>  <span class="va">.datasets</span>,</span>
<span>  <span class="va">.models</span>,</span>
<span>  <span class="va">.pars</span>,</span>
<span>  <span class="va">.state</span>,</span>
<span>  <span class="va">.xinit</span>,</span>
<span>  <span class="va">.n</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">map_init</span><span class="op">(</span><span class="va">.map</span>, <span class="va">.timeline</span>, <span class="va">.direction</span>, <span class="va">.dataset</span>, <span class="va">.model</span>, <span class="va">.pars</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for default</span></span>
<span><span class="fu">map_init</span><span class="op">(</span><span class="va">.map</span>, <span class="va">.timeline</span>, <span class="va">.direction</span>, <span class="va">.dataset</span>, <span class="va">.model</span>, <span class="va">.pars</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for ModelObsAcousticLogisTrunc</span></span>
<span><span class="fu">map_init</span><span class="op">(</span><span class="va">.map</span>, <span class="va">.timeline</span>, <span class="va">.direction</span>, <span class="va">.dataset</span>, <span class="va">.model</span>, <span class="va">.pars</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for ModelObsDepthUniform</span></span>
<span><span class="fu">map_init</span><span class="op">(</span><span class="va">.map</span>, <span class="va">.timeline</span>, <span class="va">.direction</span>, <span class="va">.dataset</span>, <span class="va">.model</span>, <span class="va">.pars</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for ModelObsDepthNormalTrunc</span></span>
<span><span class="fu">map_init</span><span class="op">(</span><span class="va">.map</span>, <span class="va">.timeline</span>, <span class="va">.direction</span>, <span class="va">.dataset</span>, <span class="va">.model</span>, <span class="va">.pars</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">map_init_iter</span><span class="op">(</span><span class="va">.map</span>, <span class="va">.timeline</span>, <span class="va">.direction</span>, <span class="va">.datasets</span>, <span class="va">.models</span>, <span class="va">.pars</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">coords_init</span><span class="op">(</span><span class="va">.map</span>, <span class="va">.n</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">states_init</span><span class="op">(</span><span class="va">.state</span>, <span class="va">.coords</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for default</span></span>
<span><span class="fu">states_init</span><span class="op">(</span><span class="va">.state</span>, <span class="va">.coords</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for StateXY</span></span>
<span><span class="fu">states_init</span><span class="op">(</span><span class="va">.state</span>, <span class="va">.coords</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for StateXYZD</span></span>
<span><span class="fu">states_init</span><span class="op">(</span><span class="va">.state</span>, <span class="va">.coords</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>.map</dt>
<dd><p>A <code><a href="https://rspatial.github.io/terra/reference/SpatRaster-class.html" class="external-link">SpatRaster</a></code> that defines the study area for the simulation (see <code><a href="glossary.html">glossary</a></code>). Here, <code>.map</code> is used to:</p><ul><li><p>Sample initial coordinates, via <code>coords_init()</code>, if <code>.xinit = NULL</code>;</p></li>
</ul></dd>


<dt>.timeline, .direction, .datasets, .models, .pars</dt>
<dd><p>(optional) Additional arguments used to restrict <code>.map</code>, via <code>map_init()</code>, before sampling initial states.</p><ul><li><p><code>.timeline</code>---A sorted, <code>POSIXct</code> vector of regularly spaced time stamps that defines the timeline for the simulation;</p></li>
<li><p><code>.direction</code>---A <code>character</code> string that defines the direction of the simulation (<code>"forward"</code> or <code>"backward"</code>);</p></li>
<li><p><code>.datasets</code>---A <code>list</code> of observation datasets;</p></li>
<li><p><code>.models</code>---A <code>character</code> vector of <code><a href="ModelObs.html">ModelObs</a></code> sub-types;</p></li>
<li><p><code>.pars</code>---A named <code>list</code> of additional arguments, passed to <code>map_init()</code>;</p></li>
</ul></dd>


<dt>.state</dt>
<dd><p>A <code>character</code> that defines the <code><a href="State.html">State</a></code> sub-type. Here, <code>.state</code> is used to:</p><ul><li><p>Convert sampled coordinates to initial states, via <code>states_init()</code>, if <code>.xinit = NULL</code>;</p></li>
</ul></dd>


<dt>.xinit</dt>
<dd><p>(optional) A <code><a href="https://rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table</a></code> of initial states, with one column for each state dimension.</p></dd>


<dt>.n</dt>
<dd><p>An <code>integer</code> that defines the number of simulated states:</p><ul><li><p>If <code>.xinit = NULL</code>, <code>.n</code> specifies the number of simulated states via <code>coords_init()</code>;</p></li>
<li><p>If <code>.xinit</code> is supplied but there are not <code>.n</code> initial states, <code>.n</code> initial states are re-sampled from <code>.xinit</code> with replacement;</p></li>
</ul></dd>

</dl></div>
    <div id="details">
    <h2>Details</h2>
    <p>These internal functions support the simulation of initial states for the simulation of animal movement walks in <code><a href="sim_path_walk.html">sim_path_walk()</a></code> and <code><a href="pf_filter.html">pf_filter()</a></code>.</p>
<p>If <code>.xinit = NULL</code>, initial coordinates are sampled from <code>.map</code>.</p>
<p>The region(s) within <code>.map</code> from which initial coordinates are sampled can be optionally restricted by the provision of the observation datasets and the associated model sub-types (via <code>map_init_iter()</code>). This option does not apply to <code><a href="sim_path_walk.html">sim_path_walk()</a></code> but is used in <code><a href="pf_filter.html">pf_filter()</a></code> where observation models (here, <code>.models</code>) are supplied. In this instance, <code>map_init_iter()</code> iterates over each model and uses the <code>map_init()</code> generic to update <code>.map</code>. The following methods are implemented:</p><ul><li><p><code>map_init.default()</code>. The default methods returns <code>.map</code> unchanged.</p></li>
<li><p><code>map_init.ModelObsAcousticLogisTrunc()</code>. This method uses acoustic observations to restrict <code>.map</code> via Lavender et al.'s (<a href="https://doi.org/10.1111/2041-210X.14193" class="external-link">2023</a>) acoustic--container algorithm. The function identifies the receiver(s) that recorded detection(s) immediately before, at and following the first time step (<code>.timeline[start]</code>, where <code>start</code> is <code>1</code> if <code>.direction = "forward</code> and <code>length(.timeline)</code> otherwise). The 'container' within which the individual must be located from the perspective of each receiver is defined by the time difference and the individual's mobility (that is, the maximum moveable distance the individual could move between two time steps), which must be specified in <code>pars$mobility</code>. The intersection between all containers defines the possible locations of the individual at the first time step.</p></li>
<li><p><code>map_init.ModelObsDepthUniform()</code>. This method uses the depth observations to restrict <code>.map</code> (which should represent the bathymetry in a region). The individual must be within a region in which the observed depth at <code>.timeline[start]</code> is within a depth envelope around the bathymetric depth defined by the parameters <code>depth_shallow_eps</code> and <code>depth_deep_eps</code> (see <code><a href="ModelObs.html">ModelObs</a></code>). (If there is no observation at <code>.timeline[start]</code>, <code>.map</code> is returned unchanged.)</p></li>
<li><p><code>map_init.ModelObsDepthNormalTrunc()</code>. This method also uses depth observations to restrict <code>.map</code>. The individual must be in a location where the bathymetric depth plus the <code>depth_deep_eps</code> parameter at <code>.timeline[start]</code> is greater than or equal to the observed depth at <code>.timeline[start]</code> (see <code><a href="ModelObs.html">ModelObs</a></code>). (If there is no observation at <code>.timeline[start]</code>, <code>.map</code> is returned unchanged.)</p></li>
</ul><p>To handle custom <code><a href="ModelObs.html">ModelObs</a></code> sub-types, process <code>.map</code> beforehand or write an appropriate <code>map_init()</code> method.</p>
<p>Using <code>.map</code>, a <code><a href="https://rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table</a></code> of <code>.n</code> initial coordinates (<code>map_value</code>, <code>x</code>, <code>y</code>) is sampled using <code>coords_init()</code>. Additional state dimensions are added, as required depending on the <code>.state</code>, via the S3 generic <code>states_init()</code>. For custom <code><a href="State.html">State</a></code> sub-types, a corresponding <code>states_init()</code> method is required (or supply <code>.xinit</code> yourself).</p>
<p>If <code>.xinit()</code> is provided and <code>.n</code> initial states are provided, <code>.xinit</code> is returned unchanged. Otherwise, <code>.n</code> initial states are resampled from <code>.xinit</code>, with replacement, and returned.</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p>These functions are used to initialise simulated movement trajectories in <code><a href="sim_path_walk.html">sim_path_walk()</a></code> and <code><a href="pf_filter.html">pf_filter()</a></code>.</p></div>
    </div>
    <div id="author">
    <h2>Author</h2>
    <p>Edward Lavender</p>
    </div>

  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Edward Lavender.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

      </footer></div>

  


  

  </body></html>

