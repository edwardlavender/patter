<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>PF: map point density — as.im.SpatRaster • patter</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="PF: map point density — as.im.SpatRaster"><meta property="og:description" content="pf_map_dens() creates a smoothed density map (e.g., of particle samples)."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">patter</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/a-methodology.html">Methodology</a>
    </li>
    <li>
      <a href="../articles/b-workflow-outline.html">Workflow</a>
    </li>
    <li>
      <a href="../articles/c-workflow-example.html">A revised implementation of the `flapper` algorithms</a>
    </li>
    <li>
      <a href="../articles/d-demos.html">Demos</a>
    </li>
    <li>
      <a href="../articles/e-faqs.html">FAQs</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/edwardlavender/patter/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>PF: map point density</h1>
    <small class="dont-index">Source: <a href="https://github.com/edwardlavender/patter/blob/HEAD/R/pf_map.R" class="external-link"><code>R/pf_map.R</code></a></small>
    <div class="hidden name"><code>pf_map_dens.Rd</code></div>
    </div>

    <div class="ref-description">
    <p><code>pf_map_dens()</code> creates a smoothed density map (e.g., of particle samples).</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">as.im.SpatRaster</span><span class="op">(</span><span class="va">.xpf</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">as.owin.SpatRaster</span><span class="op">(</span><span class="va">.xpf</span>, .im <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">as.owin.sf</span><span class="op">(</span><span class="va">.poly</span>, .bbox <span class="op">=</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html" class="external-link">st_bbox</a></span><span class="op">(</span><span class="va">.poly</span><span class="op">)</span>, .invert <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">pf_map_dens</span><span class="op">(</span></span>
<span>  <span class="va">.xpf</span>,</span>
<span>  .im <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  .owin <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  .coord <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  .plot <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  .use_tryCatch <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  .verbose <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>.xpf</dt>
<dd><p>A <code><a href="https://rdrr.io/pkg/terra/man/SpatRaster-class.html" class="external-link">SpatRaster</a></code> that defines the grid for density estimation and, if <code>.coord = NULL</code>, the points (and associated weights) that are smoothed. Weights must sum to one. The coordinate reference system of <code>.xpf</code> must be planar and specified.</p></dd>


<dt>.im, .owin</dt>
<dd><p>A pixel image representation of <code>.xpf</code> (see <code>as.im.SpatRaster()</code> and <code><a href="https://rdrr.io/pkg/spatstat.geom/man/im.html" class="external-link">spatstat.geom::im()</a></code>) and an observation window (see <code>as.owin.SpatRaster()</code>, <code>as.owin.sf()</code> and <code><a href="https://rdrr.io/pkg/spatstat.geom/man/owin.html" class="external-link">spatstat.geom::owin()</a></code>). These objects may be computed automatically from <code>.xpf</code> (with rectangular or gridded observation windows used by default, depending on whether or not <code>.xpf</code> contains <code>NA</code>s), but this option can be over-ridden. For faster results, use a rectangular or polygon observation window (see <code>as.owin.sf()</code>). If <code>.coord</code> is supplied, <code>.im</code> is necessarily (re)-defined internally (see Details).</p></dd>


<dt>.poly, .bbox, .invert</dt>
<dd><p>For <code>as.owin.sf</code> to construct observation windows from <code>sf</code> objects.</p><ul><li><p><code>.poly</code> is an <code>sf</code> polygon object;</p></li>
<li><p><code>.bbox</code> is the bounding of a simple feature (see <code><a href="https://r-spatial.github.io/sf/reference/st_bbox.html" class="external-link">sf::st_bbox()</a></code>);</p></li>
<li><p><code>.invert</code> is a logical variable that defines whether or not to invert <code>.poly</code> (e.g., to turn a terrestrial polygon into an aquatic polygon);</p></li>
</ul></dd>


<dt>.coord</dt>
<dd><p>(optional) A <code><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></code>, <code><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></code> or <code><a href="https://rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table</a></code> with x and y coordinates, in columns named <code>x</code> and <code>y</code> or <code>cell_x</code> and <code>cell_y</code>. <code>x</code> and <code>y</code> columns are used preferentially. Coordinates must be planar.  A <code>timestep</code> column can also be included if there are multiple possible locations at each time step. A <code>mark</code> column can be included with coordinate weights; otherwise, equal weights are assumed (see Details). Other columns are ignored.</p></dd>


<dt>.plot</dt>
<dd><p>A <code>logical</code> variable that defines whether or not to plot the output.</p></dd>


<dt>.use_tryCatch</dt>
<dd><p>A <code>logical</code> variable that controls error handling:</p><ul><li><p>If <code>.use_tryCatch = FALSE</code>, if density estimation fails with an error, the function fails with the same error.</p></li>
<li><p>If <code>.use_tryCatch = TRUE</code>, if density estimation fails with an error, the function produces a warning with the error message and returns <code>NULL</code>.</p></li>
</ul></dd>


<dt>.verbose</dt>
<dd><p>Controls on function prompts and messages (see <code><a href="pf_forward.html">pf_forward()</a></code>.</p></dd>


<dt>...</dt>
<dd><p>Arguments passed to <code><a href="https://rdrr.io/pkg/spatstat.explore/man/density.ppp.html" class="external-link">spatstat.explore::density.ppp()</a></code>, such as <code>sigma</code> (i.e., the bandwidth).</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>The function returns a normalised <code><a href="https://rdrr.io/pkg/terra/man/SpatRaster-class.html" class="external-link">SpatRaster</a></code> (or <code>NULL</code> if <code><a href="https://rdrr.io/pkg/spatstat.explore/man/density.ppp.html" class="external-link">spatstat.explore::density.ppp()</a></code> fails and <code>.use_tryCatch = TRUE</code>).</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p><code>pf_map_dens()</code> smooths (a) a <code><a href="https://rdrr.io/pkg/terra/man/SpatRaster-class.html" class="external-link">SpatRaster</a></code> or (b) a set of inputted coordinates:</p><ul><li><p>If <code>.coords</code> is <code>NULL</code>, <code>.xpf</code> cell coordinates are used for density estimation and cell values are used as weights.</p></li>
<li><p>If coordinates are supplied, coordinates are re-expressed on <code>.xpf</code> and then used for density estimation. This option is generally faster. Equal weights are assumed unless specified. Default or supplied weights are normalised to sum to one at each time step. The total weight of each location within time steps is calculated and then these weights are aggregated by location across the whole time series and renomalised. See the internal <code><a href="dot-pf_map_weights.html">.pf_map_weights()</a></code> function for full details.</p></li>
</ul><p>Cell coordinates are converted to a <code><a href="https://rdrr.io/pkg/spatstat.geom/man/ppp.html" class="external-link">spatstat.geom::ppp()</a></code> object, which is passed, alongside the observation window (<code>.owin</code>) and an image of the weights to <code><a href="https://rdrr.io/pkg/spatstat.explore/man/density.ppp.html" class="external-link">spatstat.explore::density.ppp()</a></code> for the estimation. Weights must sum to one.</p>
<p><code>as.im.SpatRaster()</code>, <code>as.owin.SpatRaster()</code> and <code>as.owin.sf()</code> are helper functions that convert a <code><a href="https://rdrr.io/pkg/terra/man/SpatRaster-class.html" class="external-link">SpatRaster</a></code> to a pixel image and an observation window (see <code><a href="https://rdrr.io/pkg/spatstat.geom/man/owin.html" class="external-link">spatstat.geom::owin()</a></code>). <code>as.im.SpatRaster</code> is based on <code><a href="http://maptools.r-forge.r-project.org/reference/as.im.html" class="external-link">maptools::as.im.RasterLayer()</a></code>. <code>as.owin.SpatRaster()</code> either defines a rectangular window, if there are no NAs on <code>.xpf</code>, or converts <code>.xpf</code> directly to an <code>owin</code> object. Gridded observation windows, especially if high resolution, considerably slow down density estimation and may exhaust vector memory. Use rectangular windows, or convert <code>sf</code> objects to polygon windows (via <code>as.owin.sf()</code>]) if possible.</p>
<p>Coordinates and associated weights are smoothed via <code><a href="https://rdrr.io/pkg/spatstat.explore/man/density.ppp.html" class="external-link">spatstat.explore::density.ppp()</a></code> into an image. Pixel resolution and smoothing parameters such as bandwidth can be controlled via <code>...</code> arguments which are passed directly to this function. The output is translated into a gridded probability density surface (on the geometry defined by <code>.xpf</code>).</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index">
<ul><li><p>The PF (forward simulation) is implemented by <code><a href="pf_forward.html">pf_forward()</a></code>;</p></li>
<li><p>PF is supported by:</p><ul><li><p>Setup helpers, namely <code><a href="pf_files.html">pf_files()</a></code>;</p></li>
</ul></li>
<li><p>The backward pass is implemented by <code><a href="pf_backward_-times.html">pf_backward_*()</a></code>;</p></li>
<li><p>Movement paths are built from PF outputs via <code><a href="pf_path.html">pf_path()</a></code> functions:</p><ul><li><p><code><a href="pf_path.html">pf_path()</a></code> reconstructs paths;</p></li>
<li><p><code><a href="pf_path_pivot.html">pf_path_pivot()</a></code> supports path reconstruction;</p></li>
</ul></li>
<li><p>To reconstruct maps of space use, see:</p><ul><li><p><code><a href="pf_coords.html">pf_coords()</a></code> to extract particle coordinates;</p></li>
<li><p><code><a href="pf_map_pou.html">pf_map_pou()</a></code> for probability-of-use maps;</p></li>
<li><p><code>pf_map_dens()</code> for smooth utilisation distributions;</p></li>
<li><p><code><a href="get_hr.html">get_hr()</a></code> for home range estimates;</p></li>
</ul></li>
</ul></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co">#### Set up examples</span></span></span>
<span class="r-in"><span><span class="co"># Load and attach selected packages</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://dtplyr.tidyverse.org" class="external-link">dtplyr</a></span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Loading required package: dtplyr</span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span>, warn.conflicts <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Loading required package: dplyr</span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="http://spatstat.org/" class="external-link">spatstat.explore</a></span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Loading required package: spatstat.explore</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Loading required package: spatstat.data</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Loading required package: spatstat.geom</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> spatstat.geom 3.2-7</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Attaching package: ‘spatstat.geom’</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> The following objects are masked from ‘package:terra’:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     area, delaunay, is.empty, rescale, rotate, shift, where.max,</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     where.min</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> The following object is masked from ‘package:data.table’:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     shift</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Loading required package: spatstat.random</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> spatstat.random 3.2-2</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Loading required package: nlme</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Attaching package: ‘nlme’</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> The following object is masked from ‘package:dplyr’:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     collapse</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> spatstat.explore 3.2-5</span>
<span class="r-in"><span><span class="co"># Define grid</span></span></span>
<span class="r-in"><span><span class="va">gebco</span>   <span class="op">&lt;-</span> <span class="fu"><a href="datasets-mefs.html">dat_gebco</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#### Example (1): Smooth a POU SpatRaster</span></span></span>
<span class="r-in"><span><span class="co"># Estimate POU on a grid based on pre-prepared particle samples</span></span></span>
<span class="r-in"><span><span class="va">out_pfb</span> <span class="op">&lt;-</span> <span class="fu"><a href="datasets-algorithms.html">dat_pfbk</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">pou</span>     <span class="op">&lt;-</span> <span class="fu"><a href="pf_map_pou.html">pf_map_pou</a></span><span class="op">(</span>.history <span class="op">=</span> <span class="va">out_pfb</span><span class="op">$</span><span class="va">history</span>, .bathy <span class="op">=</span> <span class="va">gebco</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="pf_map_dens-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co"># Smooth POU</span></span></span>
<span class="r-in"><span><span class="va">dens_1</span>    <span class="op">&lt;-</span> <span class="fu">pf_map_dens</span><span class="op">(</span><span class="va">pou</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> `patter::pf_map_dens()` called @ 2023-12-18 15:10:14... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Processing `.xpf`... </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Observation window is gridded.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Building `ppp` object... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Using `.xpf`... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Defining `ppp` object... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Estimating density surface... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Scaling density surface... </span>
<span class="r-plt img"><img src="pf_map_dens-2.png" alt="" width="700" height="433"></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> `patter::pf_map_dens()` call ended @ 2023-12-18 15:10:14 (duration: ~0 sec(s)). </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#### Example (2): Smooth particle coordinates</span></span></span>
<span class="r-in"><span><span class="co"># This approach is equivalent to Example (1) &amp; the outputs are identical</span></span></span>
<span class="r-in"><span><span class="co"># But this implementation can be considerably faster</span></span></span>
<span class="r-in"><span><span class="va">dens_2</span> <span class="op">&lt;-</span> <span class="fu">pf_map_dens</span><span class="op">(</span><span class="va">gebco</span>, .coord <span class="op">=</span> <span class="fu"><a href="pf_coords.html">pf_coords</a></span><span class="op">(</span><span class="va">out_pfb</span><span class="op">$</span><span class="va">history</span>, <span class="va">gebco</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> `patter::pf_map_dens()` called @ 2023-12-18 15:10:14... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Processing `.xpf`... </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Observation window is gridded.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Building `ppp` object... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Using `.coord`... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Defining `ppp` object... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Estimating density surface... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Scaling density surface... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> `patter::pf_map_dens()` call ended @ 2023-12-18 15:10:14 (duration: ~0 sec(s)). </span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="va">dens_1</span>, <span class="va">dens_2</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#### Example (3): Smooth COAs</span></span></span>
<span class="r-in"><span><span class="co"># Define data list</span></span></span>
<span class="r-in"><span><span class="va">dlist</span> <span class="op">&lt;-</span> <span class="fu"><a href="pat_setup_data.html">pat_setup_data</a></span><span class="op">(</span>.acoustics <span class="op">=</span> <span class="va">dat_acoustics</span><span class="op">[</span><span class="va">individual_id</span> <span class="op">==</span> <span class="fl">25</span>, <span class="op">]</span>,</span></span>
<span class="r-in"><span>                        .moorings <span class="op">=</span> <span class="va">dat_moorings</span>,</span></span>
<span class="r-in"><span>                        .bathy <span class="op">=</span> <span class="fu"><a href="datasets-mefs.html">dat_gebco</a></span><span class="op">(</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                        .lonlat <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>`.moorings` coordinates coerced onto `.bathy` grid.</span>
<span class="r-in"><span><span class="co"># Calculate COAs</span></span></span>
<span class="r-in"><span><span class="va">out_coa</span> <span class="op">&lt;-</span> <span class="fu"><a href="coa.html">coa</a></span><span class="op">(</span><span class="va">dlist</span>, .delta_t <span class="op">=</span> <span class="st">"12 hours"</span>, .plot_weights <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">out_coa</span> <span class="op">&lt;-</span> <span class="va">out_coa</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span>x <span class="op">=</span> <span class="va">coa_x</span>, y <span class="op">=</span> <span class="va">coa_y</span><span class="op">)</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="co"># Smooth centres of activity</span></span></span>
<span class="r-in"><span><span class="va">dens_3</span> <span class="op">&lt;-</span> <span class="fu">pf_map_dens</span><span class="op">(</span><span class="va">gebco</span>, .coord <span class="op">=</span> <span class="va">out_coa</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> `patter::pf_map_dens()` called @ 2023-12-18 15:10:15... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Processing `.xpf`... </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Observation window is gridded.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Building `ppp` object... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Using `.coord`... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Defining `ppp` object... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Estimating density surface... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Scaling density surface... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> `patter::pf_map_dens()` call ended @ 2023-12-18 15:10:15 (duration: ~0 sec(s)). </span>
<span class="r-in"><span><span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">out_coa</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="pf_map_dens-3.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#### Example (4): Control smoothing parameters via `spatstat.explore::density.ppp()`</span></span></span>
<span class="r-in"><span><span class="co"># E.g. use fixed bandwidth:</span></span></span>
<span class="r-in"><span><span class="fu">pf_map_dens</span><span class="op">(</span><span class="va">pou</span>, sigma <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> `patter::pf_map_dens()` called @ 2023-12-18 15:10:15... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Processing `.xpf`... </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Observation window is gridded.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Building `ppp` object... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Using `.xpf`... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Defining `ppp` object... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Estimating density surface... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Scaling density surface... </span>
<span class="r-plt img"><img src="pf_map_dens-4.png" alt="" width="700" height="433"></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> `patter::pf_map_dens()` call ended @ 2023-12-18 15:10:15 (duration: ~0 sec(s)). </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> class       : SpatRaster </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> dimensions  : 264, 190, 1  (nrow, ncol, nlyr)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> resolution  : 100, 100  (x, y)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> extent      : 695492.1, 714492.1, 6246657, 6273057  (xmin, xmax, ymin, ymax)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> coord. ref. : WGS 84 / UTM zone 29N (EPSG:32629) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> source(s)   : memory</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> name        :         lyr.1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> min value   : -4.871511e-18 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> max value   :  2.356800e-02 </span>
<span class="r-in"><span><span class="fu">pf_map_dens</span><span class="op">(</span><span class="va">pou</span>, sigma <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> `patter::pf_map_dens()` called @ 2023-12-18 15:10:15... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Processing `.xpf`... </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Observation window is gridded.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Building `ppp` object... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Using `.xpf`... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Defining `ppp` object... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Estimating density surface... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Scaling density surface... </span>
<span class="r-plt img"><img src="pf_map_dens-5.png" alt="" width="700" height="433"></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> `patter::pf_map_dens()` call ended @ 2023-12-18 15:10:15 (duration: ~0 sec(s)). </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> class       : SpatRaster </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> dimensions  : 264, 190, 1  (nrow, ncol, nlyr)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> resolution  : 100, 100  (x, y)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> extent      : 695492.1, 714492.1, 6246657, 6273057  (xmin, xmax, ymin, ymax)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> coord. ref. : WGS 84 / UTM zone 29N (EPSG:32629) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> source(s)   : memory</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> name        :         lyr.1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> min value   : -3.769630e-18 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> max value   :  1.510748e-02 </span>
<span class="r-in"><span><span class="co"># E.g., perform automatic bandwidth selection using cross validation:</span></span></span>
<span class="r-in"><span><span class="fu">pf_map_dens</span><span class="op">(</span><span class="va">pou</span>, sigma <span class="op">=</span> <span class="va">bw.diggle</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> `patter::pf_map_dens()` called @ 2023-12-18 15:10:15... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Processing `.xpf`... </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Observation window is gridded.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Building `ppp` object... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Using `.xpf`... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Defining `ppp` object... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Estimating density surface... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Scaling density surface... </span>
<span class="r-plt img"><img src="pf_map_dens-6.png" alt="" width="700" height="433"></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> `patter::pf_map_dens()` call ended @ 2023-12-18 15:10:15 (duration: ~0 sec(s)). </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> class       : SpatRaster </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> dimensions  : 264, 190, 1  (nrow, ncol, nlyr)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> resolution  : 100, 100  (x, y)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> extent      : 695492.1, 714492.1, 6246657, 6273057  (xmin, xmax, ymin, ymax)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> coord. ref. : WGS 84 / UTM zone 29N (EPSG:32629) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> source(s)   : memory</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> name        :         lyr.1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> min value   : -3.797942e-18 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> max value   :  1.396895e-02 </span>
<span class="r-in"><span><span class="fu">pf_map_dens</span><span class="op">(</span><span class="va">pou</span>, sigma <span class="op">=</span> <span class="va">bw.scott</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> `patter::pf_map_dens()` called @ 2023-12-18 15:10:15... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Processing `.xpf`... </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Observation window is gridded.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Building `ppp` object... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Using `.xpf`... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Defining `ppp` object... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Estimating density surface... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Scaling density surface... </span>
<span class="r-plt img"><img src="pf_map_dens-7.png" alt="" width="700" height="433"></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> `patter::pf_map_dens()` call ended @ 2023-12-18 15:10:15 (duration: ~0 sec(s)). </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> class       : SpatRaster </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> dimensions  : 264, 190, 1  (nrow, ncol, nlyr)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> resolution  : 100, 100  (x, y)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> extent      : 695492.1, 714492.1, 6246657, 6273057  (xmin, xmax, ymin, ymax)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> coord. ref. : WGS 84 / UTM zone 29N (EPSG:32629) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> source(s)   : memory</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> name        :         lyr.1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> min value   : -3.285401e-18 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> max value   :  1.046399e-02 </span>
<span class="r-in"><span><span class="co"># pf_map_dens(pou, sigma = bw.CvL)  # ~12 s (slow)</span></span></span>
<span class="r-in"><span><span class="co"># pf_map_dens(pou, sigma = bw.ppl)  # ~14 s (slow)</span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Edward Lavender.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

