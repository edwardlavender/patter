<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>PF: likelihood functions — pf_lik • patter</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="PF: likelihood functions — pf_lik"><meta property="og:description" content="These are likelihood functions for the forward simulation. pf_forward() expects a named list of likelihood functions that evaluate the likelihood of each dataset given location proposals. Convenience functions are provided that calculate the likelihood of acoustic and archival data, given location proposals, as resolved by the acoustic-container and depth-contour algorithms presented by Lavender et al. (2023)."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">patter</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/a-methodology.html">Methodology</a>
    </li>
    <li>
      <a href="../articles/b-workflow-outline.html">Workflow outline</a>
    </li>
    <li>
      <a href="../articles/c-workflow-example.html">Example workflow</a>
    </li>
    <li>
      <a href="../articles/d-demos.html">Demos</a>
    </li>
    <li>
      <a href="../articles/e-faqs.html">FAQs</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/edwardlavender/patter/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>PF: likelihood functions</h1>
    <small class="dont-index">Source: <a href="https://github.com/edwardlavender/patter/blob/HEAD/R/pf_forward-likelihood.R" class="external-link"><code>R/pf_forward-likelihood.R</code></a></small>
    <div class="hidden name"><code>pf_lik.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>These are likelihood functions for the forward simulation. <code><a href="pf_forward.html">pf_forward()</a></code> expects a named <code>list</code> of likelihood functions that evaluate the likelihood of each dataset given location proposals. Convenience functions are provided that calculate the likelihood of acoustic and archival data, given location proposals, as resolved by the acoustic-container and depth-contour algorithms presented by Lavender et al. (2023).</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">acs_filter_land</span><span class="op">(</span><span class="va">.particles</span>, <span class="va">.obs</span>, <span class="va">.t</span>, <span class="va">.dlist</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">acs_filter_container</span><span class="op">(</span><span class="va">.particles</span>, <span class="va">.obs</span>, <span class="va">.t</span>, <span class="va">.dlist</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">pf_lik_ac</span><span class="op">(</span><span class="va">.particles</span>, <span class="va">.obs</span>, <span class="va">.t</span>, <span class="va">.dlist</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">pf_lik_dc</span><span class="op">(</span><span class="va">.particles</span>, <span class="va">.obs</span>, <span class="va">.t</span>, <span class="va">.dlist</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>.particles</dt>
<dd><p>A <code><a href="https://rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table</a></code> that defines proposal locations. This contains the following columns:</p><ul><li><p><code>timestep</code>---an <code>integer</code> that defines the time step;</p></li>
<li><p><code>cell_now</code>---an <code>integer</code> that defines the grid cell(s) of proposal location(s);</p></li>
<li><p><code>x_now</code>,<code>y_now</code>---<code>double</code>s that define proposal location coordinates;</p></li>
<li><p><code>lik</code>---a <code>double</code> that defines the likelihood. At each time step, this begins as a vector of <code>1</code>s <strong>that should be progressively updated by each likelihood function</strong>.</p></li>
</ul></dd>


<dt>.obs, .t</dt>
<dd><p>(optional) The <code>.obs</code> <code><a href="https://rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table</a></code> (from <code><a href="pf_forward.html">pf_forward()</a></code>) and an <code>integer</code> that defines the time step (used to index <code>.obs</code>).</p></dd>


<dt>.dlist</dt>
<dd><p>(optional) The <code>.dlist</code> <code>list</code> (from <code><a href="pf_forward.html">pf_forward()</a></code>).</p><ul><li><p>For <code>acs_filter_land()</code>, <code>.dlist</code> should contain <code>.dlist$spatial$bathy</code> and <code>.dlist$pars$spatna</code>.</p></li>
<li><p>For <code>acs_filter_container()</code>, <code>.dlist</code> should contain <code>.dlist$data$moorings</code> and <code>.dlist$pars$lonlat</code>.</p></li>
<li><p>For <code>pf_lik_ac()</code>, <code>.dlist</code> should contain <code>.dlist$algorithm$detection_overlaps</code> (from <code><a href="acs_setup_detection_overlaps.html">acs_setup_detection_overlaps()</a></code>) and <code>.dlist$algorithm$detection_kernels</code> (from <code><a href="acs_setup_detection_kernels.html">acs_setup_detection_kernels()</a></code>.</p></li>
<li><p>For <code>pf_lik_dc()</code>, <code>.dlist</code> should contain <code>.dlist$spatial$bathy</code>.</p></li>
<li><p>For custom likelihood functions, <code>.dlist</code> may require other datasets.</p></li>
</ul></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>Functions return the <code>.particle</code></p>
<p></p>
<p><code><a href="https://rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table</a></code> for valid proposal locations and updated likelihoods (in the <code>lik</code> column).</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>In <code><a href="pf_forward.html">pf_forward()</a></code>, the likelihood of the data given proposal locations is evaluated using a named <code>list</code> of user-defined functions (one for each dataset). Each function must accept a <code><a href="https://rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table</a></code> of proposal locations (<code>.particles</code>) alongside the arguments named above (even if they are ignored), evaluate the likelihood of the data and return an updated <code><a href="https://rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table</a></code> for the subset of valid proposals and <em>updated</em> likelihoods (in the <code>lik</code> column). For computational efficiency, is is desirable that functions are ordered by the extent to which they invalidate proposal locations and that each function drops invalid proposals (since this reduces the number of subsequent likelihood calculations). For faster evaluations, it might also pay to group likelihood terms under a single wrapper function (since this eliminates the need to loop over individual terms in <code><a href="pf_particle.html">.pf_lik()</a></code>).</p>
<p>The following convenience functions are provided:</p><ul><li><p><code>acs_filter_land()</code> is a binary 'habitability' (land/water) filter. This is useful when the 'stochastic kick' methodology is used to generate proposal locations in systems that include inhospitable habitats. The function calculates the likelihood (0, 1) of the 'hospitable' data given sampled particles. Location proposals in <code>NA</code> cells on the bathymetry grid (<code>.dlist$spatial$bathy</code>) are dropped.</p></li>
<li><p><code>acs_filter_container()</code> is recommended for acoustic time series. This function calculates the approximate likelihood of the next acoustic detection, given particle proposals. This is a binary filter that excludes location proposals that are incompatible with acoustic container dynamics. This is strictly optional but facilitates algorithm convergence by filtering location proposals that are inconsistent with the location of the next detection.</p></li>
<li><p><code>pf_lik_ac()</code> calculates the likelihood of acoustic data (detection or non detection at each operational receiver), given location proposals.</p></li>
<li><p><code>pf_lik_dc()</code> calculates the likelihood of archival (depth) data, given particle proposals. This is based on Lavender et al.'s (2023) depth-contour algorithm in which depth observations are considered valid in locations whose depth's lie between a shallow and deep limit (<code>.obs$depth_shallow[.t]</code> and <code>.obs$depth_deep[.t]</code>) but impossible otherwise.</p></li>
</ul><p>In <code><a href="pf_forward.html">pf_forward()</a></code>, <code>acs_filter_container()</code> and <code>pf_lik_ac()</code> effectively replace the role of <a href="https://edwardlavender.github.io/flapper/reference/ac.html" class="external-link"><code><a href="https://edwardlavender.github.io/flapper/reference/ac.html" class="external-link">flapper::ac()</a></code></a> function. <code>pf_lik_dc()</code> effectively replaces the role of <a href="https://edwardlavender.github.io/flapper/reference/dc.html" class="external-link"><code><a href="https://edwardlavender.github.io/flapper/reference/dc.html" class="external-link">flapper::dc()</a></code></a>.</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p>The forward filtering--backward sampling algorithm samples locations (particles) that represent the possible locations of an individual through time, accounting for all data and the individual's movement.</p><ul><li><p>To set up data, use <code><a href="pat_setup_data.html">pat_setup_data()</a></code>.</p></li>
<li><p><code><a href="pf_forward.html">pf_forward()</a></code> implements the forward filter:</p><ul><li><p>To set up an observations timeline, use <code><a href="pf_setup_obs.html">pf_setup_obs()</a></code>.</p></li>
<li><p>For proposal (movement) models, see <code><a href="pf_propose.html">pf_propose</a></code>.</p></li>
<li><p>For likelihood functions, to evaluate the likelihood of the data at proposal locations, see <code>pf_lik</code>.</p></li>
<li><p>For sampling functions, to (re)sample plausible proposal locations, see <code><a href="pf_sample.html">pf_sample</a></code>.</p></li>
<li><p>For tuning parameters, see <code><a href="pf_opt.html">pf_opt</a></code>.</p></li>
</ul></li>
<li><p><code><a href="pf_backward_-times.html">pf_backward_*()</a></code> refines outputs from the forward filter:</p><ul><li><p><code><a href="pf_backward_killer.html">pf_backward_killer()</a></code> removes dead-ends;</p></li>
<li><p><code><a href="pf_backward_sampler.html">pf_backward_sampler()</a></code> implements the backward sampler;</p></li>
</ul></li>
<li><p>To reconstruct movement paths from particle samples, use <code><a href="pf_path.html">pf_path()</a></code>.</p></li>
<li><p>To map emergent patterns of space use, use <code><a href="pf_coord.html">pf_coord()</a></code> plus a <code>map_*()</code> function, such as <code><a href="map_pou.html">map_pou()</a></code>, <code><a href="map_dens.html">map_dens()</a></code> and/or <code><a href="map_hr.html">map_hr</a></code><code>_()</code>.</p></li>
<li><p>For additional utilities, see supporting <code>pf_*()</code> functions, such as <code><a href="pf_plot_history.html">pf_plot_history()</a></code>, <code><a href="pf_files.html">pf_files()</a></code> and <code><a href="pf_files.html">pf_files_size()</a></code>.</p></li>
</ul></div>
    </div>
    <div id="author">
    <h2>Author</h2>
    <p>Edward Lavender</p>
    </div>

  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Edward Lavender.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

