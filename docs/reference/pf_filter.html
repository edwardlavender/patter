<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>PF: particle filter — pf_filter • patter</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="PF: particle filter — pf_filter"><meta name="description" content="This function runs the particle filter. The filter samples possible states (typically locations, termed particles) of an animal at each time point given the data up to (and including) that time point and a movement model."><meta property="og:description" content="This function runs the particle filter. The filter samples possible states (typically locations, termed particles) of an animal at each time point given the data up to (and including) that time point and a movement model."><meta property="og:image" content="https://edwardlavender.github.io/patter/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">patter</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/a-methodology.html">Methodology</a></li>
    <li><a class="dropdown-item" href="../articles/b-workflow-outline.html">Workflow outline</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/edwardlavender/patter/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>PF: particle filter</h1>
      <small class="dont-index">Source: <a href="https://github.com/edwardlavender/patter/blob/HEAD/R/particle-filter.R" class="external-link"><code>R/particle-filter.R</code></a></small>
      <div class="d-none name"><code>pf_filter.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function runs the particle filter. The filter samples possible states (typically locations, termed particles) of an animal at each time point given the data up to (and including) that time point and a movement model.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">pf_filter</span><span class="op">(</span></span>
<span>  <span class="va">.timeline</span>,</span>
<span>  .state <span class="op">=</span> <span class="st">"StateXY"</span>,</span>
<span>  .xinit <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  .model_move <span class="op">=</span> <span class="fu"><a href="ModelMove.html">model_move_xy</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  <span class="va">.yobs</span>,</span>
<span>  .n_move <span class="op">=</span> <span class="fl">100000L</span>,</span>
<span>  .n_particle <span class="op">=</span> <span class="fl">1000L</span>,</span>
<span>  .n_resample <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">.n_particle</span><span class="op">)</span>,</span>
<span>  .t_resample <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  .n_record <span class="op">=</span> <span class="fl">1000L</span>,</span>
<span>  .n_iter <span class="op">=</span> <span class="fl">1L</span>,</span>
<span>  .direction <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"forward"</span>, <span class="st">"backward"</span><span class="op">)</span>,</span>
<span>  .batch <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  .collect <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  .progress <span class="op">=</span> <span class="fu"><a href="patter-progress.html">julia_progress</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  .verbose <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"patter.verbose"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg--timeline">.timeline<a class="anchor" aria-label="anchor" href="#arg--timeline"></a></dt>
<dd><p>A <code>POSIXct</code> vector of regularly spaced time stamps that defines the timeline for the simulation. Here, <code>.timeline</code> is used to:</p><ul><li><p>Define the time steps of the simulation;</p></li>
</ul></dd>


<dt id="arg--state-xinit">.state, .xinit<a class="anchor" aria-label="anchor" href="#arg--state-xinit"></a></dt>
<dd><p>Arguments used to simulate initial states.</p><ul><li><p><code>.state</code>—A <code>character</code> that defines the <code><a href="State.html">State</a></code> sub-type;</p></li>
<li><p><code>.xinit</code>—<code>NULL</code> or a <code><a href="https://rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table::data.table</a></code> that defines the initial states for the simulation;</p></li>
</ul></dd>


<dt id="arg--model-move-n-move">.model_move, .n_move<a class="anchor" aria-label="anchor" href="#arg--model-move-n-move"></a></dt>
<dd><p>The movement model.</p><ul><li><p><code>.model_move</code>—A <code>character</code> string that defines the movement model (see <code><a href="ModelMove.html">ModelMove</a></code>);</p></li>
<li><p><code>.n_move</code>—An <code>integer</code> that defines the number of attempts to find a legal move;</p></li>
</ul></dd>


<dt id="arg--yobs">.yobs<a class="anchor" aria-label="anchor" href="#arg--yobs"></a></dt>
<dd><p>The observations. Acceptable inputs are:</p><ul><li><p>A named <code>list</code> of formatted datasets, one for each data type (see <code><a href="glossary.html">glossary</a></code>);</p></li>
<li><p>An empty <code>list</code>, to run the filter without observations;</p></li>
<li><p><code>missing</code>, if the datasets are already available in the <code>Julia</code> session (from a previous run of <code>pf_filter()</code>) and you want to re-run the filter without the penalty of re-exporting the observations;</p></li>
</ul></dd>


<dt id="arg--n-particle">.n_particle<a class="anchor" aria-label="anchor" href="#arg--n-particle"></a></dt>
<dd><p>An <code>integer</code> that defines the number of particles.</p></dd>


<dt id="arg--n-resample-t-resample">.n_resample, .t_resample<a class="anchor" aria-label="anchor" href="#arg--n-resample-t-resample"></a></dt>
<dd><p>Resampling options.</p><ul><li><p><code>.n_resample</code> is an a <code>double</code> that defines the effective sample size (ESS) at which to re-sample particles;</p></li>
<li><p><code>.t_resample</code> is <code>NULL</code> or an <code>integer</code>/<code>integer</code> vector that defines the time steps at which to resample particles, regardless of the ESS;</p></li>
</ul><p>Guidance:</p><ul><li><p>To resample at every time step, set <code>.n_resample = as.numeric(.n_particle)</code> (default) or <code>.t_resample = 1:length(.timeline)</code>;</p></li>
<li><p>To only resample at selected time steps, set <code>.t_resample</code> as required and set <code>.n_resample &gt; as.numeric(.n_particle)</code>;</p></li>
<li><p>To only resample based on ESS, set <code>.t_resample = NULL</code> and <code>.n_resample</code> as required;</p></li>
</ul></dd>


<dt id="arg--n-record">.n_record<a class="anchor" aria-label="anchor" href="#arg--n-record"></a></dt>
<dd><p>An <code>integer</code> that defines the number of recorded particles at each time step.</p></dd>


<dt id="arg--n-iter">.n_iter<a class="anchor" aria-label="anchor" href="#arg--n-iter"></a></dt>
<dd><p>An <code>integer</code> that defines the number of iterations of the filter.</p></dd>


<dt id="arg--direction">.direction<a class="anchor" aria-label="anchor" href="#arg--direction"></a></dt>
<dd><p>A <code>character</code> string that defines the direction of the filter:</p><ul><li><p><code>"forward"</code> runs the filter from <code>.timeline[1]:.timeline[length(.timeline)]</code>;</p></li>
<li><p><code>"backward"</code> runs the filter from <code>.timeline[length(.timeline)]:.timeline[1]</code>;</p></li>
</ul></dd>


<dt id="arg--batch">.batch<a class="anchor" aria-label="anchor" href="#arg--batch"></a></dt>
<dd><p>(optional) Batching controls:</p><ul><li><p>Use <code>NULL</code> to retain all particles for the whole <code>.timeline</code> (<code>.n_record</code> particles at each time step) in memory;</p></li>
<li><p>Use <code>character</code> vector of <code>.jld2</code> file paths to write particles in sequential batches to file (as <code>Julia</code> <code>Matrix{&lt;:State}</code> objects); for example:</p><ul><li><p><code>./fwd-1.jld2, ./fwd-2.jld2, ...</code> if <code>.direction = "forward"</code>;</p></li>
<li><p><code>./bwd-1.jld2, ./bwd-2.jld2, ...</code> if <code>.direction = "backward</code>;</p></li>
</ul></li>
</ul><p>If specified, <code>.batch</code> is sorted alphanumerically (in <code>Julia</code>) such that 'lower' batches (e.g., <code>./fwd-1.jld2</code>, <code>./bwd-1.jld2</code>) align with the start of the <code>.timeline</code> and 'higher' batches (e.g., <code>./fwd-3.jld2</code>, <code>./bwd-3.jld2</code>) align with the end of the <code>.timeline</code> (irrespective of <code>.direction</code>). For smoothing, the same number of batches must be used for both filter runs (see <code><a href="pf_smoother_two_filter.html">pf_smoother_two_filter()</a></code>).</p>
<p>This option is designed to reduce memory demand (especially on clusters). Larger numbers of batches reduce memory demand, but incur the speed penalty of writing particles to disk. When there are only a handful of batches, this should be negligible. For examples of this argument in action, see <code><a href="pf_smoother_two_filter.html">pf_smoother_two_filter()</a></code>.</p></dd>


<dt id="arg--collect">.collect<a class="anchor" aria-label="anchor" href="#arg--collect"></a></dt>
<dd><p>A <code>logical</code> variable that defines whether or not to collect outputs from the <code>Julia</code> session in <code>R</code>.</p></dd>


<dt id="arg--progress">.progress<a class="anchor" aria-label="anchor" href="#arg--progress"></a></dt>
<dd><p>Progress controls (see <code><a href="patter-progress.html">patter-progress</a></code> for supported options). If enabled, one progress bar is shown for each <code>.batch</code>.</p></dd>


<dt id="arg--verbose">.verbose<a class="anchor" aria-label="anchor" href="#arg--verbose"></a></dt>
<dd><p>User output control (see <code><a href="patter-progress.html">patter-progress</a></code> for supported options).</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p><a href="https://github.com/edwardlavender/Patter.jl" class="external-link"><code>Patter.particle_filter()</code></a> creates a NamedTuple in the <code>Julia</code> session (named  <code>pfwd</code> or <code>pbwd</code> depending on <code>.direction</code>). If <code>.batch = NULL</code>, the NamedTuple contains particles (<code>states</code>) ; otherwise, the <code>states</code> element is <code>nothing</code> and <code>states</code> are written to <code>.jld2</code> files (as variables named <code>xfwd</code> or <code>xbwd</code>). If <code>.collect = TRUE</code>, <code>pf_filter()</code> collects the outputs in <code>R</code> as a <code><a href="pf_particles-class.html">pf_particles</a></code> object (the <code>states</code> element is <code>NULL</code> is <code>.batch</code> is used). Otherwise, <code>invisible(NULL)</code> is returned.</p>
    </div>
    <div class="section level2">
    <h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a></h2>
    <p>The particle filter iterates over time steps, simulating states (termed 'particles') that are consistent with the preceding data and a movement model at each time step.</p>
<p>A raster map of study area must be exported to <code>Julia</code> for this function (see <code><a href="set_map.html">set_map()</a></code>).</p>
<p>The initial states for the algorithm are defined by <code>.xinit</code> or simulated via <a href="https://github.com/edwardlavender/Patter.jl" class="external-link"><code>Patter.simulate_states_init()</code></a>. The word 'state' typically means location but may include additional parameters. If the initial state of the animal is known, it should be supplied via <code>.xinit</code>. Otherwise, <a href="https://github.com/edwardlavender/Patter.jl" class="external-link"><code>Patter.simulate_states_init()</code></a> samples <code>.n_particle</code> initial coordinates from <code>.map</code> (via <a href="https://github.com/edwardlavender/Patter.jl" class="external-link"><code>Patter.coords_init()</code></a>), which are then translated into a <code>DataFrame</code> of states (that is, <code>.xinit</code>, via <a href="https://github.com/edwardlavender/Patter.jl" class="external-link"><code>Patter.states_init()</code></a>). The regions on the map from which initial coordinates are sampled can be restricted by the observations (<code>.yobs</code>) and other parameters. For automated handling of custom states and observation models at this stage, custom <code>Patter.map_init</code> and <code>Patter.states_init</code> methods are required (see the Details for <a href="https://github.com/edwardlavender/Patter.jl" class="external-link"><code>Patter.simulate_states_init()</code></a>).</p>
<p>The filter comprises three stages:</p><ol><li><p>A movement step, in which we simulate possible states (particles) for the individual (for time steps 2, ..., T).</p></li>
<li><p>A weights step, in which we calculate particle weights from the log-likelihood of the data at each particle.</p></li>
<li><p>A re-sampling step, in which we optionally re-sample valid states using the weights.</p></li>
</ol><p>The time complexity of the algorithm is \(O(TN)\).</p>
<p>The filter is implemented by the <code>Julia</code> function <a href="https://github.com/edwardlavender/Patter.jl" class="external-link"><code>Patter.particle_filter()</code></a>.</p>
<p>To multi-thread movement and likelihood evaluations, set the number of threads via <code><a href="julia_connect.html">julia_connect()</a></code>.</p>
<p>The filter record <code>.n_record</code> particles in memory at each time step. If <code>batch</code> is provided, the <code>.timeline</code> is split into <code>length(.batch)</code> batches. The filter still moves along the whole <code>.timeline</code>, but only records the particles for the current batch in memory. At the end of each batch, the particles for that batch are written to file. This reduces total memory demand.</p>
<p>See <a href="https://github.com/edwardlavender/Patter.jl" class="external-link"><code>Patter.particle_filter()</code></a> or <code>JuliaCall::julia_help("particle_filter")</code> for further information.</p>
    </div>
    <div class="section level2">
    <h2 id="algorithms">Algorithms<a class="anchor" aria-label="anchor" href="#algorithms"></a></h2>
    <p>This is highly flexible routine for the reconstruction of the possible locations of an individual through time, given the data up to that time point. By modifying the observation models, it is straightforward to implement the ACPF, DCPF and ACDCPF algorithms introduced by Lavender et al. (2023) for reconstructing animal movements in passive acoustic telemetry systems using (a) acoustic time series, (b) archival time series and (c) acoustic and archival time series. <code>pf_filter()</code> thus replaces (and enhances) the <a href="https://edwardlavender.github.io/flapper/reference/ac.html" class="external-link"><code><a href="https://edwardlavender.github.io/flapper/reference/ac.html" class="external-link">flapper::ac()</a></code></a>, <a href="https://edwardlavender.github.io/flapper/reference/dc.html" class="external-link"><code><a href="https://edwardlavender.github.io/flapper/reference/dc.html" class="external-link">flapper::dc()</a></code></a>, <a href="https://edwardlavender.github.io/flapper/reference/acdc.html" class="external-link"><code><a href="https://edwardlavender.github.io/flapper/reference/acdc.html" class="external-link">flapper::acdc()</a></code></a> and <a href="https://edwardlavender.github.io/flapper/reference/pf.html" class="external-link"><code><a href="https://edwardlavender.github.io/flapper/reference/pf.html" class="external-link">flapper::pf()</a></code></a> functions.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>Particle filters and smoothers sample states (particles) that represent the possible locations of an individual through time, accounting for all data and the individual's movement.</p><ul><li><p>To simulate artificial datasets, see <code>sim_*()</code> functions (especially <code><a href="sim_path_walk.html">sim_path_walk()</a></code>, <code><a href="sim_array.html">sim_array()</a></code> and <code><a href="sim_observations.html">sim_observations()</a></code>).</p></li>
<li><p>To assemble real-world datasets for the filter, see <code><a href="assemble.html">assemble</a></code><code>_*()</code> functions.</p></li>
<li><p><code>pf_filter()</code> runs the filter:</p><ul><li><p>For state types, see <code><a href="State.html">State</a></code>;</p></li>
<li><p>For observation models, see <code><a href="ModelObs.html">ModelObs</a></code>;</p></li>
<li><p>For movement models, see <code><a href="ModelMove.html">ModelMove</a></code>;</p></li>
</ul></li>
<li><p>To run particle smoothing, use <code><a href="pf_smoother_two_filter.html">pf_smoother_two_filter()</a></code>.</p></li>
<li><p>To map emergent patterns of space use, use a <code>map_*()</code> function (such as <code><a href="map_pou.html">map_pou()</a></code>, <code><a href="map_dens.html">map_dens()</a></code> and <code><a href="map_hr.html">map_hr()</a></code>).</p></li>
</ul></div>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Edward Lavender</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="patter_run.html">patter_run</a></span><span class="op">(</span>.julia <span class="op">=</span> <span class="cn">TRUE</span>, .geospatial <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dtplyr.tidyverse.org" class="external-link">dtplyr</a></span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span>, warn.conflicts <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://glue.tidyverse.org/" class="external-link">glue</a></span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co">#### Julia set up</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="julia_connect.html">julia_connect</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="set_seed.html">set_seed</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co">#### Define study period</span></span></span>
<span class="r-in"><span>  <span class="co"># The resolution of the timeline defines the resolution of the simulation</span></span></span>
<span class="r-in"><span>  <span class="va">timeline</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html" class="external-link">as.POSIXct</a></span><span class="op">(</span><span class="st">"2016-01-01"</span>, tz <span class="op">=</span> <span class="st">"UTC"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                  <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html" class="external-link">as.POSIXct</a></span><span class="op">(</span><span class="st">"2016-01-01 03:18:00"</span>, tz <span class="op">=</span> <span class="st">"UTC"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                  by <span class="op">=</span> <span class="st">"2 mins"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co">#### Define study area</span></span></span>
<span class="r-in"><span>  <span class="co"># `map` is a SpatRaster that defines the region within which movements are permitted</span></span></span>
<span class="r-in"><span>  <span class="co"># Here, we consider the movements of an aquatic animal in Scotland</span></span></span>
<span class="r-in"><span>  <span class="co"># ... `map` represents the bathymetry in the relevant region</span></span></span>
<span class="r-in"><span>  <span class="co"># Use `set_map()` to export the map to `Julia`</span></span></span>
<span class="r-in"><span>  <span class="va">map</span> <span class="op">&lt;-</span> <span class="fu"><a href="datasets-mefs.html">dat_gebco</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">map</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="set_map.html">set_map</a></span><span class="op">(</span><span class="va">map</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co">#### --------------------------------------------------</span></span></span>
<span class="r-in"><span>  <span class="co">#### Simulation-based workflow</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co">#### Scenario</span></span></span>
<span class="r-in"><span>  <span class="co"># We have studied the movements of flapper skate off the west coast of Scotland.</span></span></span>
<span class="r-in"><span>  <span class="co"># We have collected acoustic detections at receivers and depth time series.</span></span></span>
<span class="r-in"><span>  <span class="co"># Here, we simulate movements and acoustic/archival observations arising from movements.</span></span></span>
<span class="r-in"><span>  <span class="co"># We then apply particle filtering to the 'observations' to reconstruct</span></span></span>
<span class="r-in"><span>  <span class="co"># ... simulated movements.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co">#### Simulate an acoustic array</span></span></span>
<span class="r-in"><span>  <span class="va">moorings</span> <span class="op">&lt;-</span> <span class="fu"><a href="sim_array.html">sim_array</a></span><span class="op">(</span>.map <span class="op">=</span> <span class="va">map</span>,</span></span>
<span class="r-in"><span>                        .timeline <span class="op">=</span> <span class="va">timeline</span>,</span></span>
<span class="r-in"><span>                        .n_receiver <span class="op">=</span> <span class="fl">100L</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># `moorings` includes the following default observation model parameters</span></span></span>
<span class="r-in"><span>  <span class="co"># * These describe how detection probability declines with distance from a receiver</span></span></span>
<span class="r-in"><span>  <span class="co"># * These are the parameters of the `ModelObsAcousticLogisTrunc` observation model</span></span></span>
<span class="r-in"><span>  <span class="va">a</span> <span class="op">&lt;-</span> <span class="va">moorings</span><span class="op">$</span><span class="va">receiver_alpha</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span></span>
<span class="r-in"><span>  <span class="va">b</span> <span class="op">&lt;-</span> <span class="va">moorings</span><span class="op">$</span><span class="va">receiver_beta</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span></span>
<span class="r-in"><span>  <span class="va">g</span> <span class="op">&lt;-</span> <span class="va">moorings</span><span class="op">$</span><span class="va">receiver_gamma</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span></span>
<span class="r-in"><span>  <span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1000</span>, by <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">d</span>, <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">d</span> <span class="op">&lt;=</span> <span class="va">g</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">plogis</a></span><span class="op">(</span><span class="va">a</span> <span class="op">*</span> <span class="va">b</span> <span class="op">*</span> <span class="va">d</span><span class="op">)</span>, <span class="fl">0</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>       ylab <span class="op">=</span> <span class="st">"Detection probability"</span>,</span></span>
<span class="r-in"><span>       xlab <span class="op">=</span> <span class="st">"Distance (m)"</span>,</span></span>
<span class="r-in"><span>       type <span class="op">=</span> <span class="st">"l"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co">#### Simulate a movement path</span></span></span>
<span class="r-in"><span>  <span class="co"># Define `State` sub-type</span></span></span>
<span class="r-in"><span>  <span class="co"># &gt; We will consider the animal's movement in two-dimensions (x, y)</span></span></span>
<span class="r-in"><span>  <span class="va">state</span>    <span class="op">&lt;-</span> <span class="st">"StateXY"</span></span></span>
<span class="r-in"><span>  <span class="co"># Define the maximum moveable distance (m) between two time steps</span></span></span>
<span class="r-in"><span>  <span class="va">mobility</span> <span class="op">&lt;-</span> <span class="fl">750</span></span></span>
<span class="r-in"><span>  <span class="co"># Define the movement model</span></span></span>
<span class="r-in"><span>  <span class="co"># &gt; We consider a two-dimensional random walk</span></span></span>
<span class="r-in"><span>  <span class="va">model_move</span> <span class="op">&lt;-</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="ModelMove.html">model_move_xy</a></span><span class="op">(</span>.mobility   <span class="op">=</span> <span class="st">"750.0"</span>,</span></span>
<span class="r-in"><span>            .dbn_length <span class="op">=</span> <span class="st">"truncated(Gamma(1, 250.0), upper = 750.0)"</span>,</span></span>
<span class="r-in"><span>            .dbn_heading  <span class="op">=</span> <span class="st">"Uniform(-pi, pi)"</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="co"># Simulate a path</span></span></span>
<span class="r-in"><span>  <span class="va">paths</span> <span class="op">&lt;-</span> <span class="fu"><a href="sim_path_walk.html">sim_path_walk</a></span><span class="op">(</span>.map <span class="op">=</span> <span class="va">map</span>,</span></span>
<span class="r-in"><span>                         .timeline <span class="op">=</span> <span class="va">timeline</span>,</span></span>
<span class="r-in"><span>                         .state <span class="op">=</span> <span class="va">state</span>,</span></span>
<span class="r-in"><span>                         .model_move <span class="op">=</span> <span class="va">model_move</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co">#### Simulate observations</span></span></span>
<span class="r-in"><span>  <span class="co"># Define observation model(s)</span></span></span>
<span class="r-in"><span>  <span class="co"># * We simulate acoustic observations and depth time series</span></span></span>
<span class="r-in"><span>  <span class="co"># * Acoustic observations are simulated according to `ModelObsAcousticLogisTrunc`</span></span></span>
<span class="r-in"><span>  <span class="co"># * Depth observations are simulated according to `ModelObsDepthUniformSeabed`</span></span></span>
<span class="r-in"><span>  <span class="co"># Define a `list` of parameters for the observation models</span></span></span>
<span class="r-in"><span>  <span class="co"># (See `?ModelObs` for details)</span></span></span>
<span class="r-in"><span>  <span class="va">pars_1</span> <span class="op">&lt;-</span></span></span>
<span class="r-in"><span>    <span class="va">moorings</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span>sensor_id <span class="op">=</span> <span class="st">"receiver_id"</span>, <span class="st">"receiver_x"</span>, <span class="st">"receiver_y"</span>,</span></span>
<span class="r-in"><span>           <span class="st">"receiver_alpha"</span>, <span class="st">"receiver_beta"</span>, <span class="st">"receiver_gamma"</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/as.data.table.html" class="external-link">as.data.table</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">pars_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table</a></span><span class="op">(</span>sensor_id <span class="op">=</span> <span class="fl">1L</span>,</span></span>
<span class="r-in"><span>                       depth_shallow_eps <span class="op">=</span> <span class="fl">10</span>,</span></span>
<span class="r-in"><span>                       depth_deep_eps <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">model_obs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ModelObsAcousticLogisTrunc <span class="op">=</span> <span class="va">pars_1</span>,</span></span>
<span class="r-in"><span>                    ModelObsDepthUniformSeabed <span class="op">=</span> <span class="va">pars_2</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="co"># Simulate observational datasets</span></span></span>
<span class="r-in"><span>  <span class="va">obs</span> <span class="op">&lt;-</span> <span class="fu"><a href="sim_observations.html">sim_observations</a></span><span class="op">(</span>.timeline <span class="op">=</span> <span class="va">timeline</span>,</span></span>
<span class="r-in"><span>                          .model_obs <span class="op">=</span> <span class="va">model_obs</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">obs</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">obs</span><span class="op">$</span><span class="va">ModelObsAcousticLogisTrunc</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">obs</span><span class="op">$</span><span class="va">ModelObsDepthUniformSeabed</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="co"># Identify detections</span></span></span>
<span class="r-in"><span>  <span class="va">detections</span> <span class="op">&lt;-</span></span></span>
<span class="r-in"><span>    <span class="va">obs</span><span class="op">$</span><span class="va">ModelObsAcousticLogisTrunc</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">obs</span> <span class="op">==</span> <span class="fl">1L</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/as.data.table.html" class="external-link">as.data.table</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="co"># Collate datasets for filter</span></span></span>
<span class="r-in"><span>  <span class="co"># &gt; This requires a list of datasets, one for each data type</span></span></span>
<span class="r-in"><span>  <span class="co"># &gt; We could also include acoustic containers here for efficiency (see below)</span></span></span>
<span class="r-in"><span>  <span class="va">yobs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ModelObsAcousticLogisTrunc <span class="op">=</span> <span class="va">obs</span><span class="op">$</span><span class="va">ModelObsAcousticLogisTrunc</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>               ModelObsDepthUniformSeabed <span class="op">=</span> <span class="va">obs</span><span class="op">$</span><span class="va">ModelObsDepthUniformSeabed</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co">#### Example (1): Run the filter using the default options</span></span></span>
<span class="r-in"><span>  <span class="va">fwd</span> <span class="op">&lt;-</span> <span class="fu">pf_filter</span><span class="op">(</span>.timeline <span class="op">=</span> <span class="va">timeline</span>,</span></span>
<span class="r-in"><span>                   .state <span class="op">=</span> <span class="va">state</span>,</span></span>
<span class="r-in"><span>                   .xinit <span class="op">=</span> <span class="cn">NULL</span>,</span></span>
<span class="r-in"><span>                   .model_move <span class="op">=</span> <span class="va">model_move</span>,</span></span>
<span class="r-in"><span>                   .yobs <span class="op">=</span> <span class="va">yobs</span>,</span></span>
<span class="r-in"><span>                   .n_particle <span class="op">=</span> <span class="fl">1e4L</span>,</span></span>
<span class="r-in"><span>                   .direction <span class="op">=</span> <span class="st">"forward"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co">## Output object structure:</span></span></span>
<span class="r-in"><span>  <span class="co"># The function returns a `pf_particles` list:</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">fwd</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fwd</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="co"># `states` is a [`data.table::data.table`] of particles:</span></span></span>
<span class="r-in"><span>  <span class="va">fwd</span><span class="op">$</span><span class="va">states</span></span></span>
<span class="r-in"><span>  <span class="co"># `diagnostics` is a [`data.table::data.table`] of filter diagnostics</span></span></span>
<span class="r-in"><span>  <span class="va">fwd</span><span class="op">$</span><span class="va">diagnostics</span></span></span>
<span class="r-in"><span>  <span class="co"># fwd$callstats is a [`data.table::data.table`] of call statistics</span></span></span>
<span class="r-in"><span>  <span class="va">fwd</span><span class="op">$</span><span class="va">callstats</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co">## Map output states:</span></span></span>
<span class="r-in"><span>  <span class="co"># Map particle coordinates</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="plot_xyt.html">plot_xyt</a></span><span class="op">(</span>.map <span class="op">=</span> <span class="va">map</span>, .coord <span class="op">=</span> <span class="va">fwd</span><span class="op">$</span><span class="va">states</span>, .steps <span class="op">=</span> <span class="fl">1L</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="co"># Map a utilisation distribution</span></span></span>
<span class="r-in"><span>  <span class="co"># * Use `.sigma = spatstat.explore::bw.diggle()` for CV bandwidth estimate</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="map_dens.html">map_dens</a></span><span class="op">(</span>.map <span class="op">=</span> <span class="va">map</span>,</span></span>
<span class="r-in"><span>           .coord <span class="op">=</span> <span class="va">fwd</span><span class="op">$</span><span class="va">states</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co">## Analyse filter diagnostics</span></span></span>
<span class="r-in"><span>  <span class="co"># `maxlp` is the maximum log-posterior at each time step</span></span></span>
<span class="r-in"><span>  <span class="co"># &gt; exp(fwd$diagnostics$maxlp) = the highest likelihood score at each time step (0-1)</span></span></span>
<span class="r-in"><span>  <span class="co"># &gt; This should not be too low!</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fwd</span><span class="op">$</span><span class="va">diagnostics</span><span class="op">$</span><span class="va">timestamp</span>, <span class="va">fwd</span><span class="op">$</span><span class="va">diagnostics</span><span class="op">$</span><span class="va">maxlp</span>, type <span class="op">=</span> <span class="st">"l"</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="co"># `ess` is the effective sample size</span></span></span>
<span class="r-in"><span>  <span class="co"># &gt; For a 2D distribution,  &gt;= 500 particles at each time step should be sufficient</span></span></span>
<span class="r-in"><span>  <span class="co"># &gt; But we often have a low ESS at the moment of a detection</span></span></span>
<span class="r-in"><span>  <span class="co"># &gt; If this is too low, we can trying boosting `.n_particle`</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fwd</span><span class="op">$</span><span class="va">diagnostics</span><span class="op">$</span><span class="va">timestamp</span>, <span class="va">fwd</span><span class="op">$</span><span class="va">diagnostics</span><span class="op">$</span><span class="va">ess</span>, type <span class="op">=</span> <span class="st">"l"</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">detections</span><span class="op">$</span><span class="va">timestamp</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">detections</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>         pch <span class="op">=</span> <span class="fl">21</span>, col <span class="op">=</span> <span class="st">"red"</span>, bg <span class="op">=</span> <span class="st">"red"</span>, cex <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>h <span class="op">=</span> <span class="fl">500</span>, col <span class="op">=</span> <span class="st">"royalblue"</span>, lty <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co">#### Example (2): Customise initial states for the filter</span></span></span>
<span class="r-in"><span>  <span class="co"># Option (A): Mark the known starting location on `.map`</span></span></span>
<span class="r-in"><span>  <span class="co"># &gt; Initial states are automatically sampled from `.map`</span></span></span>
<span class="r-in"><span>  <span class="co"># &gt; We have to reset the initial map in Julia</span></span></span>
<span class="r-in"><span>  <span class="co"># &gt; Use set_map with .as_Raster = TRUE and .as_GeoArray = FALSE</span></span></span>
<span class="r-in"><span>  <span class="co"># &gt; (After the example, we reset the map for later examples)</span></span></span>
<span class="r-in"><span>  <span class="va">origin</span>       <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/setValues.html" class="external-link">setValues</a></span><span class="op">(</span><span class="va">map</span>, <span class="cn">NA</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">cell</span>         <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/xyCellFrom.html" class="external-link">cellFromXY</a></span><span class="op">(</span><span class="va">map</span>, <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">paths</span><span class="op">$</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">paths</span><span class="op">$</span><span class="va">y</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">origin</span><span class="op">[</span><span class="va">cell</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">paths</span><span class="op">$</span><span class="va">map_value</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="set_map.html">set_map</a></span><span class="op">(</span>.x <span class="op">=</span> <span class="va">origin</span>, .as_Raster <span class="op">=</span> <span class="cn">TRUE</span>, .as_GeoArray <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">fwd</span> <span class="op">&lt;-</span> <span class="fu">pf_filter</span><span class="op">(</span>.timeline <span class="op">=</span> <span class="va">timeline</span>,</span></span>
<span class="r-in"><span>                   .state <span class="op">=</span> <span class="va">state</span>,</span></span>
<span class="r-in"><span>                   .xinit <span class="op">=</span> <span class="cn">NULL</span>,</span></span>
<span class="r-in"><span>                   .yobs <span class="op">=</span> <span class="va">yobs</span>,</span></span>
<span class="r-in"><span>                   .model_move <span class="op">=</span> <span class="va">model_move</span>,</span></span>
<span class="r-in"><span>                   .n_particle <span class="op">=</span> <span class="fl">1e4L</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="set_map.html">set_map</a></span><span class="op">(</span><span class="va">map</span>, .as_Raster <span class="op">=</span> <span class="cn">TRUE</span>, .as_GeoArray <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="co"># Option (B): Specify `.xinit` manually</span></span></span>
<span class="r-in"><span>  <span class="co"># &gt; `.xinit` is resampled, as required, to generate `.n_particle` initial states</span></span></span>
<span class="r-in"><span>  <span class="va">xinit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table</a></span><span class="op">(</span>map_value <span class="op">=</span> <span class="va">paths</span><span class="op">$</span><span class="va">map_value</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, x <span class="op">=</span> <span class="va">paths</span><span class="op">$</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, y <span class="op">=</span> <span class="va">paths</span><span class="op">$</span><span class="va">y</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">fwd</span>   <span class="op">&lt;-</span> <span class="fu">pf_filter</span><span class="op">(</span>.timeline <span class="op">=</span> <span class="va">timeline</span>,</span></span>
<span class="r-in"><span>                     .state <span class="op">=</span> <span class="va">state</span>,</span></span>
<span class="r-in"><span>                     .xinit <span class="op">=</span> <span class="va">xinit</span>,</span></span>
<span class="r-in"><span>                     .yobs <span class="op">=</span> <span class="va">yobs</span>,</span></span>
<span class="r-in"><span>                     .model_move <span class="op">=</span> <span class="va">model_move</span>,</span></span>
<span class="r-in"><span>                     .n_particle <span class="op">=</span> <span class="fl">1e4L</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co">#### Example (3): Customise selected settings</span></span></span>
<span class="r-in"><span>  <span class="co"># Boost the number of particles</span></span></span>
<span class="r-in"><span>  <span class="va">fwd</span>   <span class="op">&lt;-</span> <span class="fu">pf_filter</span><span class="op">(</span>.timeline <span class="op">=</span> <span class="va">timeline</span>,</span></span>
<span class="r-in"><span>                     .state <span class="op">=</span> <span class="va">state</span>,</span></span>
<span class="r-in"><span>                     .xinit <span class="op">=</span> <span class="va">xinit</span>,</span></span>
<span class="r-in"><span>                     .yobs <span class="op">=</span> <span class="va">yobs</span>,</span></span>
<span class="r-in"><span>                     .model_move <span class="op">=</span> <span class="va">model_move</span>,</span></span>
<span class="r-in"><span>                     .n_particle <span class="op">=</span> <span class="fl">1.5e4L</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="co"># Change the threshold ESS for resampling</span></span></span>
<span class="r-in"><span>  <span class="va">fwd</span>   <span class="op">&lt;-</span> <span class="fu">pf_filter</span><span class="op">(</span>.timeline <span class="op">=</span> <span class="va">timeline</span>,</span></span>
<span class="r-in"><span>                     .state <span class="op">=</span> <span class="va">state</span>,</span></span>
<span class="r-in"><span>                     .xinit <span class="op">=</span> <span class="va">xinit</span>,</span></span>
<span class="r-in"><span>                     .yobs <span class="op">=</span> <span class="va">yobs</span>,</span></span>
<span class="r-in"><span>                     .model_move <span class="op">=</span> <span class="va">model_move</span>,</span></span>
<span class="r-in"><span>                     .n_particle <span class="op">=</span> <span class="fl">1.5e4L</span>,</span></span>
<span class="r-in"><span>                     .n_resample <span class="op">=</span> <span class="fl">1000L</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="co"># Force resampling at selected time steps</span></span></span>
<span class="r-in"><span>  <span class="co"># * Other time steps are resampled if ESS &lt; .n_resample</span></span></span>
<span class="r-in"><span>  <span class="va">fwd</span>   <span class="op">&lt;-</span> <span class="fu">pf_filter</span><span class="op">(</span>.timeline <span class="op">=</span> <span class="va">timeline</span>,</span></span>
<span class="r-in"><span>                     .state <span class="op">=</span> <span class="va">state</span>,</span></span>
<span class="r-in"><span>                     .xinit <span class="op">=</span> <span class="va">xinit</span>,</span></span>
<span class="r-in"><span>                     .yobs <span class="op">=</span> <span class="va">yobs</span>,</span></span>
<span class="r-in"><span>                     .model_move <span class="op">=</span> <span class="va">model_move</span>,</span></span>
<span class="r-in"><span>                     .t_resample <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">timeline</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">detections</span><span class="op">$</span><span class="va">timestamp</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                     .n_particle <span class="op">=</span> <span class="fl">1.5e4L</span>,</span></span>
<span class="r-in"><span>                     .n_resample <span class="op">=</span> <span class="fl">1000L</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="co"># Change the number of particles retained in memory</span></span></span>
<span class="r-in"><span>  <span class="va">fwd</span>   <span class="op">&lt;-</span> <span class="fu">pf_filter</span><span class="op">(</span>.timeline <span class="op">=</span> <span class="va">timeline</span>,</span></span>
<span class="r-in"><span>                     .state <span class="op">=</span> <span class="va">state</span>,</span></span>
<span class="r-in"><span>                     .xinit <span class="op">=</span> <span class="va">xinit</span>,</span></span>
<span class="r-in"><span>                     .yobs <span class="op">=</span> <span class="va">yobs</span>,</span></span>
<span class="r-in"><span>                     .model_move <span class="op">=</span> <span class="va">model_move</span>,</span></span>
<span class="r-in"><span>                     .n_particle <span class="op">=</span> <span class="fl">1.5e4L</span>,</span></span>
<span class="r-in"><span>                     .n_record <span class="op">=</span> <span class="fl">2000L</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co">#### Example (2): Run the filter backwards</span></span></span>
<span class="r-in"><span>  <span class="co"># (A forward and backward run is required for the two-filter smoother)</span></span></span>
<span class="r-in"><span>  <span class="va">fwd</span> <span class="op">&lt;-</span> <span class="fu">pf_filter</span><span class="op">(</span>.timeline <span class="op">=</span> <span class="va">timeline</span>,</span></span>
<span class="r-in"><span>                   .state <span class="op">=</span> <span class="va">state</span>,</span></span>
<span class="r-in"><span>                   .xinit <span class="op">=</span> <span class="cn">NULL</span>,</span></span>
<span class="r-in"><span>                   .yobs <span class="op">=</span> <span class="va">yobs</span>,</span></span>
<span class="r-in"><span>                   .model_move <span class="op">=</span> <span class="va">model_move</span>,</span></span>
<span class="r-in"><span>                   .n_particle <span class="op">=</span> <span class="fl">1e4L</span>,</span></span>
<span class="r-in"><span>                   .direction <span class="op">=</span> <span class="st">"backward"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co">#### --------------------------------------------------</span></span></span>
<span class="r-in"><span>  <span class="co">#### Real-world examples</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co">#### Assemble datasets</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># Define datasets for a selected animal</span></span></span>
<span class="r-in"><span>  <span class="co"># &gt; Here, we consider detections and depth time series from an example flapper skate</span></span></span>
<span class="r-in"><span>  <span class="va">individual_id</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span></span>
<span class="r-in"><span>  <span class="va">det</span> <span class="op">&lt;-</span> <span class="va">dat_detections</span><span class="op">[</span><span class="va">individual_id</span> <span class="op">==</span> <span class="fl">25L</span>, <span class="op">]</span><span class="op">[</span>, <span class="va">individual_id</span> <span class="op">:=</span> <span class="cn">NULL</span><span class="op">]</span></span></span>
<span class="r-in"><span>  <span class="va">arc</span> <span class="op">&lt;-</span> <span class="va">dat_archival</span><span class="op">[</span><span class="va">individual_id</span> <span class="op">==</span> <span class="fl">25L</span>, <span class="op">]</span><span class="op">[</span>, <span class="va">individual_id</span> <span class="op">:=</span> <span class="cn">NULL</span><span class="op">]</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># Define a timeline</span></span></span>
<span class="r-in"><span>  <span class="co"># * We can do this manually or use the observations to define a timeline:</span></span></span>
<span class="r-in"><span>  <span class="va">timeline</span> <span class="op">&lt;-</span> <span class="fu"><a href="assemble.html">assemble_timeline</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">det</span>, <span class="va">arc</span><span class="op">)</span>, .step <span class="op">=</span> <span class="st">"2 mins"</span>, .trim <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">timeline</span> <span class="op">&lt;-</span> <span class="va">timeline</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">1440</span><span class="op">]</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">timeline</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># Assemble a timeline of acoustic observations (0, 1) and model parameters</span></span></span>
<span class="r-in"><span>  <span class="co"># * The default acoustic observation model parameters are taken from `.moorings`</span></span></span>
<span class="r-in"><span>  <span class="va">acoustics</span> <span class="op">&lt;-</span> <span class="fu"><a href="assemble.html">assemble_acoustics</a></span><span class="op">(</span>.timeline <span class="op">=</span> <span class="va">timeline</span>,</span></span>
<span class="r-in"><span>                                  .detections <span class="op">=</span> <span class="va">det</span>,</span></span>
<span class="r-in"><span>                                  .moorings <span class="op">=</span> <span class="va">dat_moorings</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># Assemble corresponding acoustic containers</span></span></span>
<span class="r-in"><span>  <span class="co"># * This is recommended with acoustic observations</span></span></span>
<span class="r-in"><span>  <span class="co"># * Note this dataset is direction specific (see below)</span></span></span>
<span class="r-in"><span>  <span class="va">containers</span> <span class="op">&lt;-</span> <span class="fu"><a href="assemble.html">assemble_acoustics_containers</a></span><span class="op">(</span>.timeline <span class="op">=</span> <span class="va">timeline</span>,</span></span>
<span class="r-in"><span>                                              .acoustics <span class="op">=</span> <span class="va">acoustics</span>,</span></span>
<span class="r-in"><span>                                              .mobility <span class="op">=</span> <span class="va">mobility</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># Assemble a timeline of archival observations and model parameters</span></span></span>
<span class="r-in"><span>  <span class="co"># * Here, we include model parameters for `ModelObsDepthNormalTruncSeabed`</span></span></span>
<span class="r-in"><span>  <span class="va">archival</span> <span class="op">&lt;-</span> <span class="fu"><a href="assemble.html">assemble_archival</a></span><span class="op">(</span>.timeline <span class="op">=</span> <span class="va">timeline</span>,</span></span>
<span class="r-in"><span>                                .archival <span class="op">=</span></span></span>
<span class="r-in"><span>                                  <span class="va">arc</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>                                  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>obs <span class="op">=</span> <span class="va">depth</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>                                  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>depth_sigma <span class="op">=</span> <span class="fl">50</span>,</span></span>
<span class="r-in"><span>                                         depth_deep_eps <span class="op">=</span> <span class="fl">20</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># Define the .yobs list for each run of the particle filter</span></span></span>
<span class="r-in"><span>  <span class="va">yobs_fwd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ModelObsAcousticLogisTrunc     <span class="op">=</span> <span class="va">acoustics</span>,</span></span>
<span class="r-in"><span>                   ModelObsContainer              <span class="op">=</span> <span class="va">containers</span><span class="op">$</span><span class="va">forward</span>,</span></span>
<span class="r-in"><span>                   ModelObsDepthNormalTruncSeabed <span class="op">=</span> <span class="va">archival</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">yobs_bwd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ModelObsAcousticLogisTrunc     <span class="op">=</span> <span class="va">acoustics</span>,</span></span>
<span class="r-in"><span>                   ModelObsContainer              <span class="op">=</span> <span class="va">containers</span><span class="op">$</span><span class="va">backward</span>,</span></span>
<span class="r-in"><span>                   ModelObsDepthNormalTruncSeabed <span class="op">=</span> <span class="va">archival</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co">#### Visualise realisations of the movement model (the prior)</span></span></span>
<span class="r-in"><span>  <span class="co"># We will use the same movement model as in previous examples</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="sim_path_walk.html">sim_path_walk</a></span><span class="op">(</span>.map <span class="op">=</span> <span class="va">map</span>,</span></span>
<span class="r-in"><span>                .timeline <span class="op">=</span> <span class="va">timeline</span>,</span></span>
<span class="r-in"><span>                .state <span class="op">=</span> <span class="va">state</span>,</span></span>
<span class="r-in"><span>                .model_move <span class="op">=</span> <span class="va">model_move</span>,</span></span>
<span class="r-in"><span>                .n_path <span class="op">=</span> <span class="fl">10L</span>, .one_page <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co">#### Example (1): Run filter forwards</span></span></span>
<span class="r-in"><span>  <span class="va">fwd</span> <span class="op">&lt;-</span> <span class="fu">pf_filter</span><span class="op">(</span>.timeline <span class="op">=</span> <span class="va">timeline</span>,</span></span>
<span class="r-in"><span>                   .state <span class="op">=</span> <span class="va">state</span>,</span></span>
<span class="r-in"><span>                   .yobs <span class="op">=</span> <span class="va">yobs_fwd</span>,</span></span>
<span class="r-in"><span>                   .model_move <span class="op">=</span> <span class="va">model_move</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co">#### Example (2): Run the filter backwards</span></span></span>
<span class="r-in"><span>  <span class="va">bwd</span> <span class="op">&lt;-</span> <span class="fu">pf_filter</span><span class="op">(</span>.timeline <span class="op">=</span> <span class="va">timeline</span>,</span></span>
<span class="r-in"><span>                   .state <span class="op">=</span> <span class="va">state</span>,</span></span>
<span class="r-in"><span>                   .yobs <span class="op">=</span> <span class="va">yobs_bwd</span>,</span></span>
<span class="r-in"><span>                   .model_move <span class="op">=</span> <span class="va">model_move</span>,</span></span>
<span class="r-in"><span>                   .direction <span class="op">=</span> <span class="st">"backward"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co">#### --------------------------------------------------</span></span></span>
<span class="r-in"><span>  <span class="co">#### Joint inference of states and static parameters</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="patter_run.html">patter_run_expensive</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>    <span class="co"># This example shows how we can infer both states and static parameters:</span></span></span>
<span class="r-in"><span>    <span class="co"># * States are our latent locations;</span></span></span>
<span class="r-in"><span>    <span class="co"># * Static parameters are the parameters in the movement and observation models;</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>    <span class="co"># For illustration, we'll use simulated data:</span></span></span>
<span class="r-in"><span>    <span class="co"># * We consider a passive acoustic telemetry system;</span></span></span>
<span class="r-in"><span>    <span class="co"># * The movement model is a Gaussian random walk;</span></span></span>
<span class="r-in"><span>    <span class="co"># * The standard deviation of the Gaussian distribution is the 'diffusivity';</span></span></span>
<span class="r-in"><span>    <span class="co"># * The observation model is a Bernoulli model for acoustic detections/non-detections;</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>    <span class="co"># Using simulated data, we'll pretend we don't know the movement 'diffusivity':</span></span></span>
<span class="r-in"><span>    <span class="co"># * For simplicity, we'll assume we know the other parameters;</span></span></span>
<span class="r-in"><span>    <span class="co"># * We'll attempt to estimate the true diffusivity from multiple runs;</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>    <span class="co"># We show how to use the filter log-likelihood score to estimate parameters via:</span></span></span>
<span class="r-in"><span>    <span class="co"># * grid-search;</span></span></span>
<span class="r-in"><span>    <span class="co"># * maximum likelihood optimisation;</span></span></span>
<span class="r-in"><span>    <span class="co"># * Bayesian inference;</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>    <span class="co"># We recommend a simulation analysis like this before real-world analyses:</span></span></span>
<span class="r-in"><span>    <span class="co"># * Follow the example below;</span></span></span>
<span class="r-in"><span>    <span class="co"># * For your study system and species, simulate observations;</span></span></span>
<span class="r-in"><span>    <span class="co"># * Examine whether you have sufficient information to estimate parameters;</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>    <span class="co"># Beware that the log-likelihood value from the filter is 'noisy':</span></span></span>
<span class="r-in"><span>    <span class="co"># * This can create all kinds of issues with optimisation &amp; sampling;</span></span></span>
<span class="r-in"><span>    <span class="co"># * You should check the sensitivity of the results with regard to the noise;</span></span></span>
<span class="r-in"><span>    <span class="co"># * I.e., Re-run the routines a few times to check result consistency;</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>    <span class="co"># Note also that parameter estimation can be computationally expensive:</span></span></span>
<span class="r-in"><span>    <span class="co"># * We should select an appropriate inference procedure depending on filter cost;</span></span></span>
<span class="r-in"><span>    <span class="co"># * Compromises may be required;</span></span></span>
<span class="r-in"><span>    <span class="co"># * We may assume some static parameters are known;</span></span></span>
<span class="r-in"><span>    <span class="co"># * We may estimate other parameters for one or two individuals with good data;</span></span></span>
<span class="r-in"><span>    <span class="co"># * We may use best-guess parameters + sensitivity analysis;</span></span></span>
<span class="r-in"><span>    <span class="co"># * This example just provides a minimal workflow;</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>    <span class="co">#### Define study system</span></span></span>
<span class="r-in"><span>    <span class="co"># Define study timeline</span></span></span>
<span class="r-in"><span>    <span class="va">timeline</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html" class="external-link">as.POSIXct</a></span><span class="op">(</span><span class="st">"2016-01-01"</span>, tz <span class="op">=</span> <span class="st">"UTC"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                    <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html" class="external-link">as.POSIXct</a></span><span class="op">(</span><span class="st">"2016-01-01 03:18:00"</span>, tz <span class="op">=</span> <span class="st">"UTC"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                    by <span class="op">=</span> <span class="st">"2 mins"</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="co"># Define study area</span></span></span>
<span class="r-in"><span>    <span class="va">map</span>      <span class="op">&lt;-</span> <span class="fu"><a href="datasets-mefs.html">dat_gebco</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="set_map.html">set_map</a></span><span class="op">(</span><span class="va">map</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>    <span class="co">#### Simulate a movement path</span></span></span>
<span class="r-in"><span>    <span class="co"># Define movement model</span></span></span>
<span class="r-in"><span>    <span class="co"># * `theta` is the movement 'diffusivity'</span></span></span>
<span class="r-in"><span>    <span class="co"># * We will attempt to estimate this parameter</span></span></span>
<span class="r-in"><span>    <span class="va">state</span>    <span class="op">&lt;-</span> <span class="st">"StateXY"</span></span></span>
<span class="r-in"><span>    <span class="va">theta</span>    <span class="op">&lt;-</span> <span class="fl">250.0</span></span></span>
<span class="r-in"><span>    <span class="va">mobility</span> <span class="op">&lt;-</span> <span class="fl">750</span></span></span>
<span class="r-in"><span>    <span class="va">model_move</span> <span class="op">&lt;-</span></span></span>
<span class="r-in"><span>      <span class="fu"><a href="ModelMove.html">model_move_xy</a></span><span class="op">(</span>.mobility    <span class="op">=</span> <span class="va">mobility</span>,</span></span>
<span class="r-in"><span>                    .dbn_length  <span class="op">=</span> <span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html" class="external-link">glue</a></span><span class="op">(</span><span class="st">"truncated(Normal(0, {theta}),</span></span></span>
<span class="r-in"><span><span class="st">                                         lower = 0.0, upper = {mobility})"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                    .dbn_heading  <span class="op">=</span> <span class="st">"Uniform(-pi, pi)"</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="co"># Simulate a path</span></span></span>
<span class="r-in"><span>    <span class="va">path</span> <span class="op">&lt;-</span> <span class="fu"><a href="sim_path_walk.html">sim_path_walk</a></span><span class="op">(</span>.map        <span class="op">=</span> <span class="va">map</span>,</span></span>
<span class="r-in"><span>                          .timeline   <span class="op">=</span> <span class="va">timeline</span>,</span></span>
<span class="r-in"><span>                          .state      <span class="op">=</span> <span class="va">state</span>,</span></span>
<span class="r-in"><span>                          .model_move <span class="op">=</span> <span class="va">model_move</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>    <span class="co">#### Simulate observations</span></span></span>
<span class="r-in"><span>    <span class="co"># Simulate array (using default parameters)</span></span></span>
<span class="r-in"><span>    <span class="co"># * Note we simulate a dense, regular array here</span></span></span>
<span class="r-in"><span>    <span class="co"># * With real-world array designs, there may be less information available</span></span></span>
<span class="r-in"><span>    <span class="va">moorings</span> <span class="op">&lt;-</span> <span class="fu"><a href="sim_array.html">sim_array</a></span><span class="op">(</span>.map         <span class="op">=</span> <span class="va">map</span>,</span></span>
<span class="r-in"><span>                          .timeline    <span class="op">=</span> <span class="va">timeline</span>,</span></span>
<span class="r-in"><span>                          .arrangement <span class="op">=</span> <span class="st">"regular"</span>,</span></span>
<span class="r-in"><span>                          .n_receiver  <span class="op">=</span> <span class="fl">100L</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="co"># Collate observation model parameters</span></span></span>
<span class="r-in"><span>    <span class="va">model_obs</span> <span class="op">&lt;-</span> <span class="fu"><a href="ModelObs.html">model_obs_acoustic_logis_trunc</a></span><span class="op">(</span><span class="va">moorings</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="co"># Simulate observations arising from path</span></span></span>
<span class="r-in"><span>    <span class="va">obs</span> <span class="op">&lt;-</span> <span class="fu"><a href="sim_observations.html">sim_observations</a></span><span class="op">(</span>.timeline  <span class="op">=</span> <span class="va">timeline</span>,</span></span>
<span class="r-in"><span>                            .model_obs <span class="op">=</span> <span class="va">model_obs</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="va">acoustics</span> <span class="op">&lt;-</span> <span class="va">obs</span><span class="op">$</span><span class="va">ModelObsAcousticLogisTrunc</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span></span>
<span class="r-in"><span>    <span class="co"># (optional) Compute containers</span></span></span>
<span class="r-in"><span>    <span class="va">containers</span> <span class="op">&lt;-</span> <span class="fu"><a href="assemble.html">assemble_acoustics_containers</a></span><span class="op">(</span>.timeline  <span class="op">=</span> <span class="va">timeline</span>,</span></span>
<span class="r-in"><span>                                                .acoustics <span class="op">=</span> <span class="va">acoustics</span>,</span></span>
<span class="r-in"><span>                                                .mobility  <span class="op">=</span> <span class="va">mobility</span>,</span></span>
<span class="r-in"><span>                                                .map       <span class="op">=</span> <span class="va">map</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="co"># Collate observations for forward filter</span></span></span>
<span class="r-in"><span>    <span class="va">yobs_fwd</span> <span class="op">&lt;-</span></span></span>
<span class="r-in"><span>      <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ModelObsAcousticLogisTrunc <span class="op">=</span> <span class="va">obs</span><span class="op">$</span><span class="va">ModelObsAcousticLogisTrunc</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>           ModelObsContainer <span class="op">=</span> <span class="va">containers</span><span class="op">$</span><span class="va">forward</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>    <span class="co">#### Prepare to estimate the diffusivity using the observations</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>    <span class="co"># i) Visualise movement models with different standard deviations</span></span></span>
<span class="r-in"><span>    <span class="co"># &gt; This gives us a feel for how we should constrain the estimation process</span></span></span>
<span class="r-in"><span>    <span class="co"># &gt; (if we didn't know the true parameter values)</span></span></span>
<span class="r-in"><span>    <span class="va">pp</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="va">thetas</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">500</span>, by <span class="op">=</span> <span class="fl">50</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="cl_lapply.html">cl_lapply</a></span><span class="op">(</span><span class="va">thetas</span>, <span class="kw">function</span><span class="op">(</span><span class="va">theta</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>      <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="ModelMove.html">model_move_xy</a></span><span class="op">(</span>.mobility   <span class="op">=</span> <span class="va">mobility</span>,</span></span>
<span class="r-in"><span>                         .dbn_length  <span class="op">=</span> <span class="fu">glue</span><span class="fu">::</span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html" class="external-link">glue</a></span><span class="op">(</span><span class="st">"truncated(Normal(0, {theta}),</span></span></span>
<span class="r-in"><span><span class="st">                                                  lower = 0.0, upper = {mobility})"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                         .dbn_heading <span class="op">=</span> <span class="st">"Uniform(-pi, pi)"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>           .panel_length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>main <span class="op">=</span> <span class="va">theta</span>, font <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>           .panel_heading <span class="op">=</span> <span class="cn">NULL</span>,</span></span>
<span class="r-in"><span>           .par <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="op">}</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span><span class="va">pp</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>    <span class="co"># ii) Define a function that computes the log-likelihood given input parameters</span></span></span>
<span class="r-in"><span>    <span class="co"># * `theta` denotes a parameter/parameter vector</span></span></span>
<span class="r-in"><span>    <span class="co"># * (In this case, it is standard deviation in the movement model)</span></span></span>
<span class="r-in"><span>    <span class="va">pf_filter_loglik</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">theta</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>      <span class="co"># (safety check) The movement standard deviation cannot be negative</span></span></span>
<span class="r-in"><span>      <span class="kw">if</span> <span class="op">(</span><span class="va">theta</span> <span class="op">&lt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>        <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="op">-</span><span class="cn">Inf</span><span class="op">)</span></span></span>
<span class="r-in"><span>      <span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>      <span class="co"># Instantiate movement model</span></span></span>
<span class="r-in"><span>      <span class="va">model_move</span> <span class="op">&lt;-</span></span></span>
<span class="r-in"><span>        <span class="fu"><a href="ModelMove.html">model_move_xy</a></span><span class="op">(</span>.mobility   <span class="op">=</span> <span class="va">mobility</span>,</span></span>
<span class="r-in"><span>                      .dbn_length <span class="op">=</span> <span class="fu">glue</span><span class="fu">::</span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html" class="external-link">glue</a></span><span class="op">(</span><span class="st">"truncated(Normal(0, {theta}),</span></span></span>
<span class="r-in"><span><span class="st">                                                lower = 0.0, upper = {mobility})"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                      .dbn_heading  <span class="op">=</span> <span class="st">"Uniform(-pi, pi)"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>      <span class="co"># Run filter</span></span></span>
<span class="r-in"><span>      <span class="co"># * Large .n_particle reduces noise in the likelihood (&amp; filter speed)</span></span></span>
<span class="r-in"><span>      <span class="va">fwd</span> <span class="op">&lt;-</span> <span class="fu">pf_filter</span><span class="op">(</span>.timeline   <span class="op">=</span> <span class="va">timeline</span>,</span></span>
<span class="r-in"><span>                       .state      <span class="op">=</span> <span class="va">state</span>,</span></span>
<span class="r-in"><span>                       .xinit      <span class="op">=</span> <span class="cn">NULL</span>,</span></span>
<span class="r-in"><span>                       .model_move <span class="op">=</span> <span class="va">model_move</span>,</span></span>
<span class="r-in"><span>                       .yobs       <span class="op">=</span> <span class="va">yobs_fwd</span>,</span></span>
<span class="r-in"><span>                       .n_particle <span class="op">=</span> <span class="fl">1e4L</span>,</span></span>
<span class="r-in"><span>                       .direction  <span class="op">=</span> <span class="st">"forward"</span>,</span></span>
<span class="r-in"><span>                       .progress   <span class="op">=</span> <span class="fu"><a href="patter-progress.html">julia_progress</a></span><span class="op">(</span>enabled <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                       .verbose    <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>      <span class="co"># Return log-lik</span></span></span>
<span class="r-in"><span>      <span class="co"># (-Inf is returned for convergence failures)</span></span></span>
<span class="r-in"><span>      <span class="va">fwd</span><span class="op">$</span><span class="va">callstats</span><span class="op">$</span><span class="va">loglik</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>    <span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>    <span class="co">#### (A) Use grid-search optimisation (~3 s)</span></span></span>
<span class="r-in"><span>    <span class="co"># This is a good option for an initial parameter search</span></span></span>
<span class="r-in"><span>    <span class="co"># (especially when there is only one parameter to optimise)</span></span></span>
<span class="r-in"><span>    <span class="co"># i) Run a coarse grid search</span></span></span>
<span class="r-in"><span>    <span class="va">theta_grid_loglik</span> <span class="op">&lt;-</span> <span class="fu"><a href="cl_lapply.html">cl_lapply</a></span><span class="op">(</span><span class="va">thetas</span>, <span class="va">pf_filter_loglik</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="co"># ii) Check the noise around the optimum (~20 s)</span></span></span>
<span class="r-in"><span>    <span class="va">noise</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>      <span class="va">loglik</span> <span class="op">&lt;-</span> <span class="fu"><a href="cl_lapply.html">cl_lapply</a></span><span class="op">(</span><span class="va">thetas</span>, <span class="va">pf_filter_loglik</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span>      <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>iter <span class="op">=</span> <span class="va">i</span>, theta <span class="op">=</span> <span class="va">thetas</span>, loglik <span class="op">=</span> <span class="va">loglik</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="op">}</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/rbindlist.html" class="external-link">rbindlist</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="co"># iii) Visualise log-likelihood profile</span></span></span>
<span class="r-in"><span>    <span class="va">ylim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">theta_grid_loglik</span>, <span class="va">noise</span><span class="op">$</span><span class="va">loglik</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">thetas</span>, <span class="va">theta_grid_loglik</span>, type <span class="op">=</span> <span class="st">"b"</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">noise</span><span class="op">$</span><span class="va">theta</span>, <span class="va">noise</span><span class="op">$</span><span class="va">loglik</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>    <span class="co">#### (B) Use optimisation routine e.g., optim or ADMB (~10 s)</span></span></span>
<span class="r-in"><span>    <span class="co"># This may be a good option with multiple parameters</span></span></span>
<span class="r-in"><span>    <span class="co"># We need to run the optimisation a few times to check result consistency</span></span></span>
<span class="r-in"><span>    <span class="co"># Here, we only need 1-dimensional optimisation</span></span></span>
<span class="r-in"><span>    <span class="co"># (So we use method = "Brent" &amp; set the bounds on the optimisation)</span></span></span>
<span class="r-in"><span>    <span class="va">theta_optim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/optim.html" class="external-link">optim</a></span><span class="op">(</span>par <span class="op">=</span> <span class="fl">200</span>, fn <span class="op">=</span> <span class="va">pf_filter_loglik</span>,</span></span>
<span class="r-in"><span>                         method <span class="op">=</span> <span class="st">"Brent"</span>, lower <span class="op">=</span> <span class="fl">100</span>, upper <span class="op">=</span> <span class="fl">500</span>,</span></span>
<span class="r-in"><span>                         control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>fnscale <span class="op">=</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="va">theta_optim</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>    <span class="co">#### (C) Use MCMC e.g., via adaptMCMC (~30 s)</span></span></span>
<span class="r-in"><span>    <span class="co"># This is a good option for incorporating prior knowledge</span></span></span>
<span class="r-in"><span>    <span class="co"># &amp; characterising the uncertainty in theta</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>    <span class="co"># i) Define log-posterior of parameters</span></span></span>
<span class="r-in"><span>    <span class="va">pf_filter_posterior</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">theta</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>      <span class="co"># Log prior</span></span></span>
<span class="r-in"><span>      <span class="co"># (For multiple thetas, simply take the product)</span></span></span>
<span class="r-in"><span>      <span class="va">lp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">dunif</a></span><span class="op">(</span><span class="va">theta</span>, <span class="fl">100</span>, <span class="fl">500</span>, log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span>      <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/is.finite.html" class="external-link">is.finite</a></span><span class="op">(</span><span class="va">lp</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>        <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="op">-</span><span class="cn">Inf</span><span class="op">)</span></span></span>
<span class="r-in"><span>      <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span></span>
<span class="r-in"><span>        <span class="co"># Posterior = prior * likelihood</span></span></span>
<span class="r-in"><span>        <span class="va">lp</span> <span class="op">&lt;-</span> <span class="va">lp</span> <span class="op">+</span> <span class="fu">pf_filter_loglik</span><span class="op">(</span><span class="va">theta</span><span class="op">)</span></span></span>
<span class="r-in"><span>      <span class="op">}</span></span></span>
<span class="r-in"><span>      <span class="va">lp</span></span></span>
<span class="r-in"><span>    <span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>    <span class="co"># ii) Select variance of jump distribution</span></span></span>
<span class="r-in"><span>    <span class="va">sd_of_jump</span> <span class="op">&lt;-</span> <span class="fl">10</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/graphics/curve.html" class="external-link">curve</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">dnorm</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">0</span>, <span class="va">sd_of_jump</span><span class="op">)</span>, <span class="op">-</span><span class="fl">20</span>, <span class="fl">20</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>    <span class="co"># iii) Run MCMC</span></span></span>
<span class="r-in"><span>    <span class="co"># * For a real analysis, many more samples are recommended</span></span></span>
<span class="r-in"><span>    <span class="va">theta_mcmc</span> <span class="op">&lt;-</span> <span class="fu">adaptMCMC</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/adaptMCMC/man/MCMC.html" class="external-link">MCMC</a></span><span class="op">(</span><span class="va">pf_filter_posterior</span>,</span></span>
<span class="r-in"><span>                                  n <span class="op">=</span> <span class="fl">100L</span>,</span></span>
<span class="r-in"><span>                                  init <span class="op">=</span> <span class="fl">200</span>, scale <span class="op">=</span> <span class="va">sd_of_jump</span><span class="op">^</span><span class="fl">2</span>,</span></span>
<span class="r-in"><span>                                  adapt <span class="op">=</span> <span class="cn">TRUE</span>, acc.rate <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>    <span class="co"># iv) Visualise samples (log-likelihoods, histogram, MCMC chain)</span></span></span>
<span class="r-in"><span>    <span class="co"># &gt; Note the noise in the log-likelihoods due to the stochastic nature of the filter</span></span></span>
<span class="r-in"><span>    <span class="va">pp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="va">o</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">theta_mcmc</span><span class="op">$</span><span class="va">samples</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">theta_mcmc</span><span class="op">$</span><span class="va">samples</span><span class="op">[</span><span class="va">o</span><span class="op">]</span>, <span class="va">theta_mcmc</span><span class="op">$</span><span class="va">log.p</span><span class="op">[</span><span class="va">o</span><span class="op">]</span>, type <span class="op">=</span> <span class="st">"b"</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">theta_mcmc</span><span class="op">$</span><span class="va">samples</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">theta_mcmc</span><span class="op">$</span><span class="va">samples</span>, type <span class="op">=</span> <span class="st">"l"</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span><span class="va">pp</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> `Julia` already connected. Set `.socket = TRUE` to reconnect.</span>
<span class="r-plt img"><img src="pf_filter-1.png" alt="" width="700" height="433"></span>
<span class="r-plt img"><img src="pf_filter-2.png" alt="" width="700" height="433"></span>
<span class="r-plt img"><img src="pf_filter-3.png" alt="" width="700" height="433"></span>
<span class="r-plt img"><img src="pf_filter-4.png" alt="" width="700" height="433"></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> `patter::pf_filter()` called @ 2025-04-18 16:27:00... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> `patter::pf_filter_init()` called @ 2025-04-18 16:27:00... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... 16:27:00: Setting initial states... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... 16:27:03: Setting observations dictionary... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> `patter::pf_filter_init()` call ended @ 2025-04-18 16:27:03 (duration: ~3 sec(s)). </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... 16:27:03: Running filter... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #0000BB;">Message: On iteration 1 ...</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #0000BB;">Message: Running filter for batch 1 / 1 ...</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... 16:27:04: Collating outputs... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> `patter::pf_filter()` call ended @ 2025-04-18 16:27:04 (duration: ~4 sec(s)). </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   |                                                  | 0 % ~calculating  </span>
<span class="r-plt img"><img src="pf_filter-5.png" alt="" width="700" height="433"></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   |++++++++++++++++++++++++++++++++++++++++++++++++++| 100% elapsed=00s  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> `patter::map_dens()` called @ 2025-04-18 16:27:04... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... 16:27:04: Processing `.map`... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... 16:27:04: Building XYM... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... 16:27:04: Defining `ppp` object... </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Observation window is gridded.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... 16:27:04: Estimating density surface... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... 16:27:04: Scaling density surface... </span>
<span class="r-plt img"><img src="pf_filter-6.png" alt="" width="700" height="433"></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> `patter::map_dens()` call ended @ 2025-04-18 16:27:05 (duration: ~1 sec(s)). </span>
<span class="r-plt img"><img src="pf_filter-7.png" alt="" width="700" height="433"></span>
<span class="r-plt img"><img src="pf_filter-8.png" alt="" width="700" height="433"></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> `patter::pf_filter()` called @ 2025-04-18 16:27:05... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> `patter::pf_filter_init()` called @ 2025-04-18 16:27:05... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... 16:27:05: Setting initial states... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... 16:27:05: Setting observations dictionary... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> `patter::pf_filter_init()` call ended @ 2025-04-18 16:27:05 (duration: ~0 sec(s)). </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... 16:27:05: Running filter... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #0000BB;">Message: On iteration 1 ...</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #0000BB;">Message: Running filter for batch 1 / 1 ...</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... 16:27:05: Collating outputs... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> `patter::pf_filter()` call ended @ 2025-04-18 16:27:05 (duration: ~0 sec(s)). </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> `patter::pf_filter()` called @ 2025-04-18 16:27:05... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> `patter::pf_filter_init()` called @ 2025-04-18 16:27:05... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... 16:27:05: Setting initial states... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... 16:27:05: Setting observations dictionary... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> `patter::pf_filter_init()` call ended @ 2025-04-18 16:27:05 (duration: ~0 sec(s)). </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... 16:27:05: Running filter... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #0000BB;">Message: On iteration 1 ...</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #0000BB;">Message: Running filter for batch 1 / 1 ...</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... 16:27:05: Collating outputs... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> `patter::pf_filter()` call ended @ 2025-04-18 16:27:05 (duration: ~0 sec(s)). </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> `patter::pf_filter()` called @ 2025-04-18 16:27:05... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> `patter::pf_filter_init()` called @ 2025-04-18 16:27:05... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... 16:27:05: Setting initial states... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... 16:27:05: Setting observations dictionary... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> `patter::pf_filter_init()` call ended @ 2025-04-18 16:27:05 (duration: ~0 sec(s)). </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... 16:27:05: Running filter... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #0000BB;">Message: On iteration 1 ...</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #0000BB;">Message: Running filter for batch 1 / 1 ...</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... 16:27:06: Collating outputs... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> `patter::pf_filter()` call ended @ 2025-04-18 16:27:06 (duration: ~1 sec(s)). </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> `patter::pf_filter()` called @ 2025-04-18 16:27:06... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> `patter::pf_filter_init()` called @ 2025-04-18 16:27:06... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... 16:27:06: Setting initial states... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... 16:27:06: Setting observations dictionary... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> `patter::pf_filter_init()` call ended @ 2025-04-18 16:27:06 (duration: ~0 sec(s)). </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... 16:27:06: Running filter... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #0000BB;">Message: On iteration 1 ...</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #0000BB;">Message: Running filter for batch 1 / 1 ...</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... 16:27:06: Collating outputs... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> `patter::pf_filter()` call ended @ 2025-04-18 16:27:06 (duration: ~0 sec(s)). </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> `patter::pf_filter()` called @ 2025-04-18 16:27:06... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> `patter::pf_filter_init()` called @ 2025-04-18 16:27:06... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... 16:27:06: Setting initial states... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... 16:27:06: Setting observations dictionary... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> `patter::pf_filter_init()` call ended @ 2025-04-18 16:27:06 (duration: ~0 sec(s)). </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... 16:27:06: Running filter... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #0000BB;">Message: On iteration 1 ...</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #0000BB;">Message: Running filter for batch 1 / 1 ...</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... 16:27:07: Collating outputs... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> `patter::pf_filter()` call ended @ 2025-04-18 16:27:07 (duration: ~1 sec(s)). </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> `patter::pf_filter()` called @ 2025-04-18 16:27:07... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> `patter::pf_filter_init()` called @ 2025-04-18 16:27:07... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... 16:27:07: Setting initial states... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... 16:27:07: Setting observations dictionary... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> `patter::pf_filter_init()` call ended @ 2025-04-18 16:27:07 (duration: ~0 sec(s)). </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... 16:27:07: Running filter... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #0000BB;">Message: On iteration 1 ...</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #0000BB;">Message: Running filter for batch 1 / 1 ...</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... 16:27:07: Collating outputs... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> `patter::pf_filter()` call ended @ 2025-04-18 16:27:07 (duration: ~0 sec(s)). </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> `patter::pf_filter()` called @ 2025-04-18 16:27:07... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> `patter::pf_filter_init()` called @ 2025-04-18 16:27:07... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... 16:27:07: Setting initial states... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... 16:27:07: Setting observations dictionary... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> `patter::pf_filter_init()` call ended @ 2025-04-18 16:27:07 (duration: ~0 sec(s)). </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... 16:27:07: Running filter... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #0000BB;">Message: On iteration 1 ...</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #0000BB;">Message: Running filter for batch 1 / 1 ...</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... 16:27:07: Collating outputs... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> `patter::pf_filter()` call ended @ 2025-04-18 16:27:07 (duration: ~0 sec(s)). </span>
<span class="r-plt img"><img src="pf_filter-9.png" alt="" width="700" height="433"></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> `patter::pf_filter()` called @ 2025-04-18 16:27:08... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> `patter::pf_filter_init()` called @ 2025-04-18 16:27:08... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... 16:27:08: Setting initial states... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... 16:27:09: Setting observations dictionary... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> `patter::pf_filter_init()` call ended @ 2025-04-18 16:27:09 (duration: ~1 sec(s)). </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... 16:27:09: Running filter... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #0000BB;">Message: On iteration 1 ...</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #0000BB;">Message: Running filter for batch 1 / 1 ...</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... 16:27:10: Collating outputs... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> `patter::pf_filter()` call ended @ 2025-04-18 16:27:10 (duration: ~2 sec(s)). </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> `patter::pf_filter()` called @ 2025-04-18 16:27:10... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> `patter::pf_filter_init()` called @ 2025-04-18 16:27:10... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... 16:27:10: Setting initial states... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... 16:27:10: Setting observations dictionary... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> `patter::pf_filter_init()` call ended @ 2025-04-18 16:27:10 (duration: ~0 sec(s)). </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... 16:27:10: Running filter... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #0000BB;">Message: On iteration 1 ...</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #0000BB;">Message: Running filter for batch 1 / 1 ...</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... 16:27:10: Collating outputs... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> `patter::pf_filter()` call ended @ 2025-04-18 16:27:10 (duration: ~0 sec(s)). </span>
<span class="r-plt img"><img src="pf_filter-10.png" alt="" width="700" height="433"></span>
<span class="r-plt img"><img src="pf_filter-11.png" alt="" width="700" height="433"></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   |                                                  | 0 % ~calculating  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   |++++++                                            | 11% ~01s          </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   |++++++++++++                                      | 22% ~00s          </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   |+++++++++++++++++                                 | 33% ~00s          </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   |+++++++++++++++++++++++                           | 44% ~00s          </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   |++++++++++++++++++++++++++++                      | 56% ~00s          </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   |++++++++++++++++++++++++++++++++++                | 67% ~00s          </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   |+++++++++++++++++++++++++++++++++++++++           | 78% ~00s          </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   |+++++++++++++++++++++++++++++++++++++++++++++     | 89% ~00s          </span>
<span class="r-plt img"><img src="pf_filter-12.png" alt="" width="700" height="433"></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   |++++++++++++++++++++++++++++++++++++++++++++++++++| 100% elapsed=00s  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   |                                                  | 0 % ~calculating    |++++++                                            | 11% ~05s            |++++++++++++                                      | 22% ~03s            |+++++++++++++++++                                 | 33% ~02s            |+++++++++++++++++++++++                           | 44% ~01s            |++++++++++++++++++++++++++++                      | 56% ~01s            |++++++++++++++++++++++++++++++++++                | 67% ~01s            |+++++++++++++++++++++++++++++++++++++++           | 78% ~00s            |+++++++++++++++++++++++++++++++++++++++++++++     | 89% ~00s            |++++++++++++++++++++++++++++++++++++++++++++++++++| 100% elapsed=02s  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   |                                                  | 0 % ~calculating    |++++++                                            | 11% ~01s            |++++++++++++                                      | 22% ~01s            |+++++++++++++++++                                 | 33% ~01s            |+++++++++++++++++++++++                           | 44% ~01s            |++++++++++++++++++++++++++++                      | 56% ~01s            |++++++++++++++++++++++++++++++++++                | 67% ~01s            |+++++++++++++++++++++++++++++++++++++++           | 78% ~00s            |+++++++++++++++++++++++++++++++++++++++++++++     | 89% ~00s            |++++++++++++++++++++++++++++++++++++++++++++++++++| 100% elapsed=02s  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   |                                                  | 0 % ~calculating    |++++++                                            | 11% ~01s            |++++++++++++                                      | 22% ~01s            |+++++++++++++++++                                 | 33% ~01s            |+++++++++++++++++++++++                           | 44% ~01s            |++++++++++++++++++++++++++++                      | 56% ~01s            |++++++++++++++++++++++++++++++++++                | 67% ~00s            |+++++++++++++++++++++++++++++++++++++++           | 78% ~00s            |+++++++++++++++++++++++++++++++++++++++++++++     | 89% ~00s            |++++++++++++++++++++++++++++++++++++++++++++++++++| 100% elapsed=02s  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   |                                                  | 0 % ~calculating    |++++++                                            | 11% ~02s            |++++++++++++                                      | 22% ~01s            |+++++++++++++++++                                 | 33% ~01s            |+++++++++++++++++++++++                           | 44% ~01s            |++++++++++++++++++++++++++++                      | 56% ~01s            |++++++++++++++++++++++++++++++++++                | 67% ~01s            |+++++++++++++++++++++++++++++++++++++++           | 78% ~00s            |+++++++++++++++++++++++++++++++++++++++++++++     | 89% ~00s            |++++++++++++++++++++++++++++++++++++++++++++++++++| 100% elapsed=02s  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   |                                                  | 0 % ~calculating    |++++++                                            | 11% ~01s            |++++++++++++                                      | 22% ~01s            |+++++++++++++++++                                 | 33% ~01s            |+++++++++++++++++++++++                           | 44% ~01s            |++++++++++++++++++++++++++++                      | 56% ~01s            |++++++++++++++++++++++++++++++++++                | 67% ~01s            |+++++++++++++++++++++++++++++++++++++++           | 78% ~00s            |+++++++++++++++++++++++++++++++++++++++++++++     | 89% ~00s            |++++++++++++++++++++++++++++++++++++++++++++++++++| 100% elapsed=02s  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   |                                                  | 0 % ~calculating    |++++++                                            | 11% ~01s            |++++++++++++                                      | 22% ~01s            |+++++++++++++++++                                 | 33% ~01s            |+++++++++++++++++++++++                           | 44% ~01s            |++++++++++++++++++++++++++++                      | 56% ~01s            |++++++++++++++++++++++++++++++++++                | 67% ~00s            |+++++++++++++++++++++++++++++++++++++++           | 78% ~00s            |+++++++++++++++++++++++++++++++++++++++++++++     | 89% ~00s            |++++++++++++++++++++++++++++++++++++++++++++++++++| 100% elapsed=02s  </span>
<span class="r-plt img"><img src="pf_filter-13.png" alt="" width="700" height="433"></span>
<span class="r-plt img"><img src="pf_filter-14.png" alt="" width="700" height="433"></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   generate 100 samples </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   |                                                                              |                                                                      |   0%  |                                                                              |====                                                                  |   5%  |                                                                              |=======                                                               |  10%  |                                                                              |==========                                                            |  15%  |                                                                              |==============                                                        |  20%  |                                                                              |==================                                                    |  25%  |                                                                              |=====================                                                 |  30%  |                                                                              |========================                                              |  35%  |                                                                              |============================                                          |  40%  |                                                                              |================================                                      |  45%  |                                                                              |===================================                                   |  50%  |                                                                              |======================================                                |  55%  |                                                                              |==========================================                            |  60%  |                                                                              |==============================================                        |  65%  |                                                                              |=================================================                     |  70%  |                                                                              |====================================================                  |  75%  |                                                                              |========================================================              |  80%  |                                                                              |============================================================          |  85%  |                                                                              |===============================================================       |  90%  |                                                                              |==================================================================    |  95%  |                                                                              |======================================================================| 100%</span>
<span class="r-plt img"><img src="pf_filter-15.png" alt="" width="700" height="433"></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Edward Lavender.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

